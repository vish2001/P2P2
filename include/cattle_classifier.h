/**
 * Cattle Behavior Classifier - ESP32 + BMI270
 * =============================================
 * Generated: 2026-02-16 03:26
 * 
 * Models:
 *   Primary:  Decision Tree (F1=0.9254, depth=10, 163 leaves)
 *   Fallback: Logistic Regression (F1=0.9170)
 * 
 * CRITICAL: Both models were trained on StandardScaler-transformed features.
 * Features MUST be scaled (subtract mean, divide by scale) before classification.
 *
 * Features:  14 per signal x 8 signals = 112 total, 60 selected
 * Window:    5s @ 10Hz = 50 samples, 50% overlap
 * Dataset:   WASP-lab (Morales-Vargas et al. 2025)
 *
 * BMI270: +/-8g accel, +/-2000 dps gyro, 10 Hz ODR
 *   acc_ms2 = raw * (8 * 9.807 / 32768)
 *   gyr_dps = raw * (2000.0 / 32768)
 */
#ifndef CATTLE_CLASSIFIER_H
#define CATTLE_CLASSIFIER_H

#include <math.h>
#include <string.h>

/* ── Constants ──────────────────────────────────────────────── */
#define CC_NUM_CLASSES      4
#define CC_NUM_SEL_FEAT     60
#define CC_WIN_SAMPLES      50
#define CC_SAMPLING_HZ      10
#define CC_FEAT_PER_SIG     14
#define CC_NUM_SIGNALS      8
#define CC_TOTAL_FEAT       112
#define CC_VOTE_WINDOW      3

enum CattleBehavior { BEH_WALKING=0, BEH_GRAZING=1, BEH_RESTING=2, BEH_MISC=3 };
static const char* BEH_NAMES[4] = {"Walking", "Grazing", "Resting", "Misc"};

static const int CC_SEL[60] = {
    0, 1, 3, 5, 6, 7, 10, 11, 12, 14, 15, 16, 17, 18, 
    19, 20, 21, 22, 23, 26, 27, 31, 33, 34, 36, 38, 44, 45, 
    47, 48, 51, 52, 54, 57, 60, 61, 62, 63, 64, 68, 70, 71, 
    75, 76, 77, 78, 81, 82, 84, 85, 87, 88, 89, 90, 91, 92, 
    103, 104, 105, 106
};

/* Feature map:
 *   f[ 0] = feat[  0] = ax_mean
 *   f[ 1] = feat[  1] = ax_median
 *   f[ 2] = feat[  3] = ax_zcr
 *   f[ 3] = feat[  5] = ax_sum
 *   f[ 4] = feat[  6] = ax_abssum
 *   f[ 5] = feat[  7] = ax_rms
 *   f[ 6] = feat[ 10] = ax_kurt
 *   f[ 7] = feat[ 11] = ax_domfreq
 *   f[ 8] = feat[ 12] = ax_dompsd
 *   f[ 9] = feat[ 14] = ay_mean
 *   f[10] = feat[ 15] = ay_median
 *   f[11] = feat[ 16] = ay_std
 *   f[12] = feat[ 17] = ay_zcr
 *   f[13] = feat[ 18] = ay_p2p
 *   f[14] = feat[ 19] = ay_sum
 *   f[15] = feat[ 20] = ay_abssum
 *   f[16] = feat[ 21] = ay_rms
 *   f[17] = feat[ 22] = ay_aav
 *   f[18] = feat[ 23] = ay_skew
 *   f[19] = feat[ 26] = ay_dompsd
 *   f[20] = feat[ 27] = ay_avgpsd
 *   f[21] = feat[ 31] = az_zcr
 *   f[22] = feat[ 33] = az_sum
 *   f[23] = feat[ 34] = az_abssum
 *   f[24] = feat[ 36] = az_aav
 *   f[25] = feat[ 38] = az_kurt
 *   f[26] = feat[ 44] = amag_std
 *   f[27] = feat[ 45] = amag_zcr
 *   f[28] = feat[ 47] = amag_sum
 *   f[29] = feat[ 48] = amag_abssum
 *   f[30] = feat[ 51] = amag_skew
 *   f[31] = feat[ 52] = amag_kurt
 *   f[32] = feat[ 54] = amag_dompsd
 *   f[33] = feat[ 57] = gx_median
 *   f[34] = feat[ 60] = gx_p2p
 *   f[35] = feat[ 61] = gx_sum
 *   f[36] = feat[ 62] = gx_abssum
 *   f[37] = feat[ 63] = gx_rms
 *   f[38] = feat[ 64] = gx_aav
 *   f[39] = feat[ 68] = gx_dompsd
 *   f[40] = feat[ 70] = gy_mean
 *   f[41] = feat[ 71] = gy_median
 *   f[42] = feat[ 75] = gy_sum
 *   f[43] = feat[ 76] = gy_abssum
 *   f[44] = feat[ 77] = gy_rms
 *   f[45] = feat[ 78] = gy_aav
 *   f[46] = feat[ 81] = gy_domfreq
 *   f[47] = feat[ 82] = gy_dompsd
 *   f[48] = feat[ 84] = gz_mean
 *   f[49] = feat[ 85] = gz_median
 *   f[50] = feat[ 87] = gz_zcr
 *   f[51] = feat[ 88] = gz_p2p
 *   f[52] = feat[ 89] = gz_sum
 *   f[53] = feat[ 90] = gz_abssum
 *   f[54] = feat[ 91] = gz_rms
 *   f[55] = feat[ 92] = gz_aav
 *   f[56] = feat[103] = gmag_sum
 *   f[57] = feat[104] = gmag_abssum
 *   f[58] = feat[105] = gmag_rms
 *   f[59] = feat[106] = gmag_aav
 */

/* ══════════════════════════════════════════════════════════════
 * StandardScaler parameters
 * CRITICAL: Both DT and LR were trained on scaled features.
 * Apply: scaled[i] = (raw[i] - MEAN[i]) / SCALE[i]
 * ══════════════════════════════════════════════════════════════ */

static const float CC_FEAT_MEAN[60] = {
    1.11188018f, 1.11108315f, 0.47852051f, 55.59400558f, 139.92138672f, 2.97156191f, 
    0.39738041f, 2.36789560f, 15.05199909f, -0.11202764f, -0.11290148f, 0.96599799f, 
    0.48417726f, 4.66076851f, -5.60138178f, 166.50732422f, 3.49543571f, 1.10727596f, 
    -0.01243112f, 16.56206512f, 5.65810537f, 0.46961671f, -389.37655640f, 389.75903320f, 
    0.79222894f, 1.01554632f, 0.89774555f, 0.53440672f, 474.10635376f, 474.10635376f, 
    0.18199006f, 1.30026066f, 14.14763546f, 2.63328838f, 7.08739471f, 131.28750610f, 
    541.42346191f, 11.09436512f, 0.76898766f, 47.38012314f, -2.01797795f, -2.01578069f, 
    -100.89889526f, 598.23571777f, 12.14697456f, 0.63473570f, 1.05463862f, 32.54226685f, 
    -10.73253441f, -10.78923798f, 0.31796876f, 5.94650221f, -536.62670898f, 560.20581055f, 
    11.38538837f, 0.79771477f, 1118.62451172f, 1118.62451172f, 22.38132095f, 0.58415419f
};

static const float CC_FEAT_SCALE[60] = {
    2.84034562f, 2.83911061f, 0.10645045f, 142.01727295f, 67.08706665f, 1.30905151f, 
    1.95012724f, 0.97008455f, 12.24648094f, 4.01109409f, 3.97512126f, 0.90025818f, 
    0.14171757f, 4.60542583f, 200.55470276f, 112.63418579f, 2.37212396f, 1.12862682f, 
    0.71787620f, 14.53328419f, 5.49937344f, 0.11308852f, 61.70216370f, 60.61076355f, 
    0.80072194f, 3.21734166f, 0.98903990f, 0.09259874f, 10.69112682f, 10.69112682f, 
    0.78597909f, 3.41233873f, 15.83275986f, 11.92449284f, 6.02668619f, 588.34625244f, 
    276.68481445f, 5.41452646f, 0.28523317f, 58.98005676f, 13.43160057f, 13.50428772f, 
    671.58001709f, 325.55017090f, 6.36904144f, 0.25009352f, 1.31101966f, 41.28779984f, 
    6.58854437f, 6.68741131f, 0.16719882f, 4.62628651f, 329.42721558f, 290.54132080f, 
    5.73549080f, 0.27490008f, 72.77245331f, 72.77245331f, 1.45435083f, 0.12156585f
};

/* Scale selected features in-place */
static void cc_scale_features(float f[CC_NUM_SEL_FEAT]) {
    for (int i = 0; i < CC_NUM_SEL_FEAT; i++) {
        f[i] = (f[i] - CC_FEAT_MEAN[i]) / CC_FEAT_SCALE[i];
    }
}

/* ══════════════════════════════════════════════════════════════
 * Precomputed sin/cos tables for DFT
 * Eliminates ~10,000 cosf/sinf calls per window
 * Size: 25 x 50 x 2 = 2500 floats = 9.8 KB flash
 * ══════════════════════════════════════════════════════════════ */

static const float CC_COS_TABLE[25][50] = {
    { 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f,
      1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f,
      1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f,
      1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f,
      1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f},
    { 1.000000f, 0.992115f, 0.968583f, 0.929776f, 0.876307f, 0.809017f, 0.728969f, 0.637424f, 0.535827f, 0.425779f,
      0.309017f, 0.187381f, 0.062791f,-0.062791f,-0.187381f,-0.309017f,-0.425779f,-0.535827f,-0.637424f,-0.728969f,
     -0.809017f,-0.876307f,-0.929776f,-0.968583f,-0.992115f,-1.000000f,-0.992115f,-0.968583f,-0.929776f,-0.876307f,
     -0.809017f,-0.728969f,-0.637424f,-0.535827f,-0.425779f,-0.309017f,-0.187381f,-0.062791f, 0.062791f, 0.187381f,
      0.309017f, 0.425779f, 0.535827f, 0.637424f, 0.728969f, 0.809017f, 0.876307f, 0.929776f, 0.968583f, 0.992115f},
    { 1.000000f, 0.968583f, 0.876307f, 0.728969f, 0.535827f, 0.309017f, 0.062791f,-0.187381f,-0.425779f,-0.637424f,
     -0.809017f,-0.929776f,-0.992115f,-0.992115f,-0.929776f,-0.809017f,-0.637424f,-0.425779f,-0.187381f, 0.062791f,
      0.309017f, 0.535827f, 0.728969f, 0.876307f, 0.968583f, 1.000000f, 0.968583f, 0.876307f, 0.728969f, 0.535827f,
      0.309017f, 0.062791f,-0.187381f,-0.425779f,-0.637424f,-0.809017f,-0.929776f,-0.992115f,-0.992115f,-0.929776f,
     -0.809017f,-0.637424f,-0.425779f,-0.187381f, 0.062791f, 0.309017f, 0.535827f, 0.728969f, 0.876307f, 0.968583f},
    { 1.000000f, 0.929776f, 0.728969f, 0.425779f, 0.062791f,-0.309017f,-0.637424f,-0.876307f,-0.992115f,-0.968583f,
     -0.809017f,-0.535827f,-0.187381f, 0.187381f, 0.535827f, 0.809017f, 0.968583f, 0.992115f, 0.876307f, 0.637424f,
      0.309017f,-0.062791f,-0.425779f,-0.728969f,-0.929776f,-1.000000f,-0.929776f,-0.728969f,-0.425779f,-0.062791f,
      0.309017f, 0.637424f, 0.876307f, 0.992115f, 0.968583f, 0.809017f, 0.535827f, 0.187381f,-0.187381f,-0.535827f,
     -0.809017f,-0.968583f,-0.992115f,-0.876307f,-0.637424f,-0.309017f, 0.062791f, 0.425779f, 0.728969f, 0.929776f},
    { 1.000000f, 0.876307f, 0.535827f, 0.062791f,-0.425779f,-0.809017f,-0.992115f,-0.929776f,-0.637424f,-0.187381f,
      0.309017f, 0.728969f, 0.968583f, 0.968583f, 0.728969f, 0.309017f,-0.187381f,-0.637424f,-0.929776f,-0.992115f,
     -0.809017f,-0.425779f, 0.062791f, 0.535827f, 0.876307f, 1.000000f, 0.876307f, 0.535827f, 0.062791f,-0.425779f,
     -0.809017f,-0.992115f,-0.929776f,-0.637424f,-0.187381f, 0.309017f, 0.728969f, 0.968583f, 0.968583f, 0.728969f,
      0.309017f,-0.187381f,-0.637424f,-0.929776f,-0.992115f,-0.809017f,-0.425779f, 0.062791f, 0.535827f, 0.876307f},
    { 1.000000f, 0.809017f, 0.309017f,-0.309017f,-0.809017f,-1.000000f,-0.809017f,-0.309017f, 0.309017f, 0.809017f,
      1.000000f, 0.809017f, 0.309017f,-0.309017f,-0.809017f,-1.000000f,-0.809017f,-0.309017f, 0.309017f, 0.809017f,
      1.000000f, 0.809017f, 0.309017f,-0.309017f,-0.809017f,-1.000000f,-0.809017f,-0.309017f, 0.309017f, 0.809017f,
      1.000000f, 0.809017f, 0.309017f,-0.309017f,-0.809017f,-1.000000f,-0.809017f,-0.309017f, 0.309017f, 0.809017f,
      1.000000f, 0.809017f, 0.309017f,-0.309017f,-0.809017f,-1.000000f,-0.809017f,-0.309017f, 0.309017f, 0.809017f},
    { 1.000000f, 0.728969f, 0.062791f,-0.637424f,-0.992115f,-0.809017f,-0.187381f, 0.535827f, 0.968583f, 0.876307f,
      0.309017f,-0.425779f,-0.929776f,-0.929776f,-0.425779f, 0.309017f, 0.876307f, 0.968583f, 0.535827f,-0.187381f,
     -0.809017f,-0.992115f,-0.637424f, 0.062791f, 0.728969f, 1.000000f, 0.728969f, 0.062791f,-0.637424f,-0.992115f,
     -0.809017f,-0.187381f, 0.535827f, 0.968583f, 0.876307f, 0.309017f,-0.425779f,-0.929776f,-0.929776f,-0.425779f,
      0.309017f, 0.876307f, 0.968583f, 0.535827f,-0.187381f,-0.809017f,-0.992115f,-0.637424f, 0.062791f, 0.728969f},
    { 1.000000f, 0.637424f,-0.187381f,-0.876307f,-0.929776f,-0.309017f, 0.535827f, 0.992115f, 0.728969f,-0.062791f,
     -0.809017f,-0.968583f,-0.425779f, 0.425779f, 0.968583f, 0.809017f, 0.062791f,-0.728969f,-0.992115f,-0.535827f,
      0.309017f, 0.929776f, 0.876307f, 0.187381f,-0.637424f,-1.000000f,-0.637424f, 0.187381f, 0.876307f, 0.929776f,
      0.309017f,-0.535827f,-0.992115f,-0.728969f, 0.062791f, 0.809017f, 0.968583f, 0.425779f,-0.425779f,-0.968583f,
     -0.809017f,-0.062791f, 0.728969f, 0.992115f, 0.535827f,-0.309017f,-0.929776f,-0.876307f,-0.187381f, 0.637424f},
    { 1.000000f, 0.535827f,-0.425779f,-0.992115f,-0.637424f, 0.309017f, 0.968583f, 0.728969f,-0.187381f,-0.929776f,
     -0.809017f, 0.062791f, 0.876307f, 0.876307f, 0.062791f,-0.809017f,-0.929776f,-0.187381f, 0.728969f, 0.968583f,
      0.309017f,-0.637424f,-0.992115f,-0.425779f, 0.535827f, 1.000000f, 0.535827f,-0.425779f,-0.992115f,-0.637424f,
      0.309017f, 0.968583f, 0.728969f,-0.187381f,-0.929776f,-0.809017f, 0.062791f, 0.876307f, 0.876307f, 0.062791f,
     -0.809017f,-0.929776f,-0.187381f, 0.728969f, 0.968583f, 0.309017f,-0.637424f,-0.992115f,-0.425779f, 0.535827f},
    { 1.000000f, 0.425779f,-0.637424f,-0.968583f,-0.187381f, 0.809017f, 0.876307f,-0.062791f,-0.929776f,-0.728969f,
      0.309017f, 0.992115f, 0.535827f,-0.535827f,-0.992115f,-0.309017f, 0.728969f, 0.929776f, 0.062791f,-0.876307f,
     -0.809017f, 0.187381f, 0.968583f, 0.637424f,-0.425779f,-1.000000f,-0.425779f, 0.637424f, 0.968583f, 0.187381f,
     -0.809017f,-0.876307f, 0.062791f, 0.929776f, 0.728969f,-0.309017f,-0.992115f,-0.535827f, 0.535827f, 0.992115f,
      0.309017f,-0.728969f,-0.929776f,-0.062791f, 0.876307f, 0.809017f,-0.187381f,-0.968583f,-0.637424f, 0.425779f},
    { 1.000000f, 0.309017f,-0.809017f,-0.809017f, 0.309017f, 1.000000f, 0.309017f,-0.809017f,-0.809017f, 0.309017f,
      1.000000f, 0.309017f,-0.809017f,-0.809017f, 0.309017f, 1.000000f, 0.309017f,-0.809017f,-0.809017f, 0.309017f,
      1.000000f, 0.309017f,-0.809017f,-0.809017f, 0.309017f, 1.000000f, 0.309017f,-0.809017f,-0.809017f, 0.309017f,
      1.000000f, 0.309017f,-0.809017f,-0.809017f, 0.309017f, 1.000000f, 0.309017f,-0.809017f,-0.809017f, 0.309017f,
      1.000000f, 0.309017f,-0.809017f,-0.809017f, 0.309017f, 1.000000f, 0.309017f,-0.809017f,-0.809017f, 0.309017f},
    { 1.000000f, 0.187381f,-0.929776f,-0.535827f, 0.728969f, 0.809017f,-0.425779f,-0.968583f, 0.062791f, 0.992115f,
      0.309017f,-0.876307f,-0.637424f, 0.637424f, 0.876307f,-0.309017f,-0.992115f,-0.062791f, 0.968583f, 0.425779f,
     -0.809017f,-0.728969f, 0.535827f, 0.929776f,-0.187381f,-1.000000f,-0.187381f, 0.929776f, 0.535827f,-0.728969f,
     -0.809017f, 0.425779f, 0.968583f,-0.062791f,-0.992115f,-0.309017f, 0.876307f, 0.637424f,-0.637424f,-0.876307f,
      0.309017f, 0.992115f, 0.062791f,-0.968583f,-0.425779f, 0.809017f, 0.728969f,-0.535827f,-0.929776f, 0.187381f},
    { 1.000000f, 0.062791f,-0.992115f,-0.187381f, 0.968583f, 0.309017f,-0.929776f,-0.425779f, 0.876307f, 0.535827f,
     -0.809017f,-0.637424f, 0.728969f, 0.728969f,-0.637424f,-0.809017f, 0.535827f, 0.876307f,-0.425779f,-0.929776f,
      0.309017f, 0.968583f,-0.187381f,-0.992115f, 0.062791f, 1.000000f, 0.062791f,-0.992115f,-0.187381f, 0.968583f,
      0.309017f,-0.929776f,-0.425779f, 0.876307f, 0.535827f,-0.809017f,-0.637424f, 0.728969f, 0.728969f,-0.637424f,
     -0.809017f, 0.535827f, 0.876307f,-0.425779f,-0.929776f, 0.309017f, 0.968583f,-0.187381f,-0.992115f, 0.062791f},
    { 1.000000f,-0.062791f,-0.992115f, 0.187381f, 0.968583f,-0.309017f,-0.929776f, 0.425779f, 0.876307f,-0.535827f,
     -0.809017f, 0.637424f, 0.728969f,-0.728969f,-0.637424f, 0.809017f, 0.535827f,-0.876307f,-0.425779f, 0.929776f,
      0.309017f,-0.968583f,-0.187381f, 0.992115f, 0.062791f,-1.000000f, 0.062791f, 0.992115f,-0.187381f,-0.968583f,
      0.309017f, 0.929776f,-0.425779f,-0.876307f, 0.535827f, 0.809017f,-0.637424f,-0.728969f, 0.728969f, 0.637424f,
     -0.809017f,-0.535827f, 0.876307f, 0.425779f,-0.929776f,-0.309017f, 0.968583f, 0.187381f,-0.992115f,-0.062791f},
    { 1.000000f,-0.187381f,-0.929776f, 0.535827f, 0.728969f,-0.809017f,-0.425779f, 0.968583f, 0.062791f,-0.992115f,
      0.309017f, 0.876307f,-0.637424f,-0.637424f, 0.876307f, 0.309017f,-0.992115f, 0.062791f, 0.968583f,-0.425779f,
     -0.809017f, 0.728969f, 0.535827f,-0.929776f,-0.187381f, 1.000000f,-0.187381f,-0.929776f, 0.535827f, 0.728969f,
     -0.809017f,-0.425779f, 0.968583f, 0.062791f,-0.992115f, 0.309017f, 0.876307f,-0.637424f,-0.637424f, 0.876307f,
      0.309017f,-0.992115f, 0.062791f, 0.968583f,-0.425779f,-0.809017f, 0.728969f, 0.535827f,-0.929776f,-0.187381f},
    { 1.000000f,-0.309017f,-0.809017f, 0.809017f, 0.309017f,-1.000000f, 0.309017f, 0.809017f,-0.809017f,-0.309017f,
      1.000000f,-0.309017f,-0.809017f, 0.809017f, 0.309017f,-1.000000f, 0.309017f, 0.809017f,-0.809017f,-0.309017f,
      1.000000f,-0.309017f,-0.809017f, 0.809017f, 0.309017f,-1.000000f, 0.309017f, 0.809017f,-0.809017f,-0.309017f,
      1.000000f,-0.309017f,-0.809017f, 0.809017f, 0.309017f,-1.000000f, 0.309017f, 0.809017f,-0.809017f,-0.309017f,
      1.000000f,-0.309017f,-0.809017f, 0.809017f, 0.309017f,-1.000000f, 0.309017f, 0.809017f,-0.809017f,-0.309017f},
    { 1.000000f,-0.425779f,-0.637424f, 0.968583f,-0.187381f,-0.809017f, 0.876307f, 0.062791f,-0.929776f, 0.728969f,
      0.309017f,-0.992115f, 0.535827f, 0.535827f,-0.992115f, 0.309017f, 0.728969f,-0.929776f, 0.062791f, 0.876307f,
     -0.809017f,-0.187381f, 0.968583f,-0.637424f,-0.425779f, 1.000000f,-0.425779f,-0.637424f, 0.968583f,-0.187381f,
     -0.809017f, 0.876307f, 0.062791f,-0.929776f, 0.728969f, 0.309017f,-0.992115f, 0.535827f, 0.535827f,-0.992115f,
      0.309017f, 0.728969f,-0.929776f, 0.062791f, 0.876307f,-0.809017f,-0.187381f, 0.968583f,-0.637424f,-0.425779f},
    { 1.000000f,-0.535827f,-0.425779f, 0.992115f,-0.637424f,-0.309017f, 0.968583f,-0.728969f,-0.187381f, 0.929776f,
     -0.809017f,-0.062791f, 0.876307f,-0.876307f, 0.062791f, 0.809017f,-0.929776f, 0.187381f, 0.728969f,-0.968583f,
      0.309017f, 0.637424f,-0.992115f, 0.425779f, 0.535827f,-1.000000f, 0.535827f, 0.425779f,-0.992115f, 0.637424f,
      0.309017f,-0.968583f, 0.728969f, 0.187381f,-0.929776f, 0.809017f, 0.062791f,-0.876307f, 0.876307f,-0.062791f,
     -0.809017f, 0.929776f,-0.187381f,-0.728969f, 0.968583f,-0.309017f,-0.637424f, 0.992115f,-0.425779f,-0.535827f},
    { 1.000000f,-0.637424f,-0.187381f, 0.876307f,-0.929776f, 0.309017f, 0.535827f,-0.992115f, 0.728969f, 0.062791f,
     -0.809017f, 0.968583f,-0.425779f,-0.425779f, 0.968583f,-0.809017f, 0.062791f, 0.728969f,-0.992115f, 0.535827f,
      0.309017f,-0.929776f, 0.876307f,-0.187381f,-0.637424f, 1.000000f,-0.637424f,-0.187381f, 0.876307f,-0.929776f,
      0.309017f, 0.535827f,-0.992115f, 0.728969f, 0.062791f,-0.809017f, 0.968583f,-0.425779f,-0.425779f, 0.968583f,
     -0.809017f, 0.062791f, 0.728969f,-0.992115f, 0.535827f, 0.309017f,-0.929776f, 0.876307f,-0.187381f,-0.637424f},
    { 1.000000f,-0.728969f, 0.062791f, 0.637424f,-0.992115f, 0.809017f,-0.187381f,-0.535827f, 0.968583f,-0.876307f,
      0.309017f, 0.425779f,-0.929776f, 0.929776f,-0.425779f,-0.309017f, 0.876307f,-0.968583f, 0.535827f, 0.187381f,
     -0.809017f, 0.992115f,-0.637424f,-0.062791f, 0.728969f,-1.000000f, 0.728969f,-0.062791f,-0.637424f, 0.992115f,
     -0.809017f, 0.187381f, 0.535827f,-0.968583f, 0.876307f,-0.309017f,-0.425779f, 0.929776f,-0.929776f, 0.425779f,
      0.309017f,-0.876307f, 0.968583f,-0.535827f,-0.187381f, 0.809017f,-0.992115f, 0.637424f, 0.062791f,-0.728969f},
    { 1.000000f,-0.809017f, 0.309017f, 0.309017f,-0.809017f, 1.000000f,-0.809017f, 0.309017f, 0.309017f,-0.809017f,
      1.000000f,-0.809017f, 0.309017f, 0.309017f,-0.809017f, 1.000000f,-0.809017f, 0.309017f, 0.309017f,-0.809017f,
      1.000000f,-0.809017f, 0.309017f, 0.309017f,-0.809017f, 1.000000f,-0.809017f, 0.309017f, 0.309017f,-0.809017f,
      1.000000f,-0.809017f, 0.309017f, 0.309017f,-0.809017f, 1.000000f,-0.809017f, 0.309017f, 0.309017f,-0.809017f,
      1.000000f,-0.809017f, 0.309017f, 0.309017f,-0.809017f, 1.000000f,-0.809017f, 0.309017f, 0.309017f,-0.809017f},
    { 1.000000f,-0.876307f, 0.535827f,-0.062791f,-0.425779f, 0.809017f,-0.992115f, 0.929776f,-0.637424f, 0.187381f,
      0.309017f,-0.728969f, 0.968583f,-0.968583f, 0.728969f,-0.309017f,-0.187381f, 0.637424f,-0.929776f, 0.992115f,
     -0.809017f, 0.425779f, 0.062791f,-0.535827f, 0.876307f,-1.000000f, 0.876307f,-0.535827f, 0.062791f, 0.425779f,
     -0.809017f, 0.992115f,-0.929776f, 0.637424f,-0.187381f,-0.309017f, 0.728969f,-0.968583f, 0.968583f,-0.728969f,
      0.309017f, 0.187381f,-0.637424f, 0.929776f,-0.992115f, 0.809017f,-0.425779f,-0.062791f, 0.535827f,-0.876307f},
    { 1.000000f,-0.929776f, 0.728969f,-0.425779f, 0.062791f, 0.309017f,-0.637424f, 0.876307f,-0.992115f, 0.968583f,
     -0.809017f, 0.535827f,-0.187381f,-0.187381f, 0.535827f,-0.809017f, 0.968583f,-0.992115f, 0.876307f,-0.637424f,
      0.309017f, 0.062791f,-0.425779f, 0.728969f,-0.929776f, 1.000000f,-0.929776f, 0.728969f,-0.425779f, 0.062791f,
      0.309017f,-0.637424f, 0.876307f,-0.992115f, 0.968583f,-0.809017f, 0.535827f,-0.187381f,-0.187381f, 0.535827f,
     -0.809017f, 0.968583f,-0.992115f, 0.876307f,-0.637424f, 0.309017f, 0.062791f,-0.425779f, 0.728969f,-0.929776f},
    { 1.000000f,-0.968583f, 0.876307f,-0.728969f, 0.535827f,-0.309017f, 0.062791f, 0.187381f,-0.425779f, 0.637424f,
     -0.809017f, 0.929776f,-0.992115f, 0.992115f,-0.929776f, 0.809017f,-0.637424f, 0.425779f,-0.187381f,-0.062791f,
      0.309017f,-0.535827f, 0.728969f,-0.876307f, 0.968583f,-1.000000f, 0.968583f,-0.876307f, 0.728969f,-0.535827f,
      0.309017f,-0.062791f,-0.187381f, 0.425779f,-0.637424f, 0.809017f,-0.929776f, 0.992115f,-0.992115f, 0.929776f,
     -0.809017f, 0.637424f,-0.425779f, 0.187381f, 0.062791f,-0.309017f, 0.535827f,-0.728969f, 0.876307f,-0.968583f},
    { 1.000000f,-0.992115f, 0.968583f,-0.929776f, 0.876307f,-0.809017f, 0.728969f,-0.637424f, 0.535827f,-0.425779f,
      0.309017f,-0.187381f, 0.062791f, 0.062791f,-0.187381f, 0.309017f,-0.425779f, 0.535827f,-0.637424f, 0.728969f,
     -0.809017f, 0.876307f,-0.929776f, 0.968583f,-0.992115f, 1.000000f,-0.992115f, 0.968583f,-0.929776f, 0.876307f,
     -0.809017f, 0.728969f,-0.637424f, 0.535827f,-0.425779f, 0.309017f,-0.187381f, 0.062791f, 0.062791f,-0.187381f,
      0.309017f,-0.425779f, 0.535827f,-0.637424f, 0.728969f,-0.809017f, 0.876307f,-0.929776f, 0.968583f,-0.992115f}
};

static const float CC_SIN_TABLE[25][50] = {
    { 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f,
      0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f,
      0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f,
      0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f,
      0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f},
    { 0.000000f, 0.125333f, 0.248690f, 0.368125f, 0.481754f, 0.587785f, 0.684547f, 0.770513f, 0.844328f, 0.904827f,
      0.951057f, 0.982287f, 0.998027f, 0.998027f, 0.982287f, 0.951057f, 0.904827f, 0.844328f, 0.770513f, 0.684547f,
      0.587785f, 0.481754f, 0.368125f, 0.248690f, 0.125333f, 0.000000f,-0.125333f,-0.248690f,-0.368125f,-0.481754f,
     -0.587785f,-0.684547f,-0.770513f,-0.844328f,-0.904827f,-0.951057f,-0.982287f,-0.998027f,-0.998027f,-0.982287f,
     -0.951057f,-0.904827f,-0.844328f,-0.770513f,-0.684547f,-0.587785f,-0.481754f,-0.368125f,-0.248690f,-0.125333f},
    { 0.000000f, 0.248690f, 0.481754f, 0.684547f, 0.844328f, 0.951057f, 0.998027f, 0.982287f, 0.904827f, 0.770513f,
      0.587785f, 0.368125f, 0.125333f,-0.125333f,-0.368125f,-0.587785f,-0.770513f,-0.904827f,-0.982287f,-0.998027f,
     -0.951057f,-0.844328f,-0.684547f,-0.481754f,-0.248690f,-0.000000f, 0.248690f, 0.481754f, 0.684547f, 0.844328f,
      0.951057f, 0.998027f, 0.982287f, 0.904827f, 0.770513f, 0.587785f, 0.368125f, 0.125333f,-0.125333f,-0.368125f,
     -0.587785f,-0.770513f,-0.904827f,-0.982287f,-0.998027f,-0.951057f,-0.844328f,-0.684547f,-0.481754f,-0.248690f},
    { 0.000000f, 0.368125f, 0.684547f, 0.904827f, 0.998027f, 0.951057f, 0.770513f, 0.481754f, 0.125333f,-0.248690f,
     -0.587785f,-0.844328f,-0.982287f,-0.982287f,-0.844328f,-0.587785f,-0.248690f, 0.125333f, 0.481754f, 0.770513f,
      0.951057f, 0.998027f, 0.904827f, 0.684547f, 0.368125f, 0.000000f,-0.368125f,-0.684547f,-0.904827f,-0.998027f,
     -0.951057f,-0.770513f,-0.481754f,-0.125333f, 0.248690f, 0.587785f, 0.844328f, 0.982287f, 0.982287f, 0.844328f,
      0.587785f, 0.248690f,-0.125333f,-0.481754f,-0.770513f,-0.951057f,-0.998027f,-0.904827f,-0.684547f,-0.368125f},
    { 0.000000f, 0.481754f, 0.844328f, 0.998027f, 0.904827f, 0.587785f, 0.125333f,-0.368125f,-0.770513f,-0.982287f,
     -0.951057f,-0.684547f,-0.248690f, 0.248690f, 0.684547f, 0.951057f, 0.982287f, 0.770513f, 0.368125f,-0.125333f,
     -0.587785f,-0.904827f,-0.998027f,-0.844328f,-0.481754f,-0.000000f, 0.481754f, 0.844328f, 0.998027f, 0.904827f,
      0.587785f, 0.125333f,-0.368125f,-0.770513f,-0.982287f,-0.951057f,-0.684547f,-0.248690f, 0.248690f, 0.684547f,
      0.951057f, 0.982287f, 0.770513f, 0.368125f,-0.125333f,-0.587785f,-0.904827f,-0.998027f,-0.844328f,-0.481754f},
    { 0.000000f, 0.587785f, 0.951057f, 0.951057f, 0.587785f, 0.000000f,-0.587785f,-0.951057f,-0.951057f,-0.587785f,
     -0.000000f, 0.587785f, 0.951057f, 0.951057f, 0.587785f, 0.000000f,-0.587785f,-0.951057f,-0.951057f,-0.587785f,
     -0.000000f, 0.587785f, 0.951057f, 0.951057f, 0.587785f, 0.000000f,-0.587785f,-0.951057f,-0.951057f,-0.587785f,
     -0.000000f, 0.587785f, 0.951057f, 0.951057f, 0.587785f, 0.000000f,-0.587785f,-0.951057f,-0.951057f,-0.587785f,
     -0.000000f, 0.587785f, 0.951057f, 0.951057f, 0.587785f, 0.000000f,-0.587785f,-0.951057f,-0.951057f,-0.587785f},
    { 0.000000f, 0.684547f, 0.998027f, 0.770513f, 0.125333f,-0.587785f,-0.982287f,-0.844328f,-0.248690f, 0.481754f,
      0.951057f, 0.904827f, 0.368125f,-0.368125f,-0.904827f,-0.951057f,-0.481754f, 0.248690f, 0.844328f, 0.982287f,
      0.587785f,-0.125333f,-0.770513f,-0.998027f,-0.684547f,-0.000000f, 0.684547f, 0.998027f, 0.770513f, 0.125333f,
     -0.587785f,-0.982287f,-0.844328f,-0.248690f, 0.481754f, 0.951057f, 0.904827f, 0.368125f,-0.368125f,-0.904827f,
     -0.951057f,-0.481754f, 0.248690f, 0.844328f, 0.982287f, 0.587785f,-0.125333f,-0.770513f,-0.998027f,-0.684547f},
    { 0.000000f, 0.770513f, 0.982287f, 0.481754f,-0.368125f,-0.951057f,-0.844328f,-0.125333f, 0.684547f, 0.998027f,
      0.587785f,-0.248690f,-0.904827f,-0.904827f,-0.248690f, 0.587785f, 0.998027f, 0.684547f,-0.125333f,-0.844328f,
     -0.951057f,-0.368125f, 0.481754f, 0.982287f, 0.770513f, 0.000000f,-0.770513f,-0.982287f,-0.481754f, 0.368125f,
      0.951057f, 0.844328f, 0.125333f,-0.684547f,-0.998027f,-0.587785f, 0.248690f, 0.904827f, 0.904827f, 0.248690f,
     -0.587785f,-0.998027f,-0.684547f, 0.125333f, 0.844328f, 0.951057f, 0.368125f,-0.481754f,-0.982287f,-0.770513f},
    { 0.000000f, 0.844328f, 0.904827f, 0.125333f,-0.770513f,-0.951057f,-0.248690f, 0.684547f, 0.982287f, 0.368125f,
     -0.587785f,-0.998027f,-0.481754f, 0.481754f, 0.998027f, 0.587785f,-0.368125f,-0.982287f,-0.684547f, 0.248690f,
      0.951057f, 0.770513f,-0.125333f,-0.904827f,-0.844328f,-0.000000f, 0.844328f, 0.904827f, 0.125333f,-0.770513f,
     -0.951057f,-0.248690f, 0.684547f, 0.982287f, 0.368125f,-0.587785f,-0.998027f,-0.481754f, 0.481754f, 0.998027f,
      0.587785f,-0.368125f,-0.982287f,-0.684547f, 0.248690f, 0.951057f, 0.770513f,-0.125333f,-0.904827f,-0.844328f},
    { 0.000000f, 0.904827f, 0.770513f,-0.248690f,-0.982287f,-0.587785f, 0.481754f, 0.998027f, 0.368125f,-0.684547f,
     -0.951057f,-0.125333f, 0.844328f, 0.844328f,-0.125333f,-0.951057f,-0.684547f, 0.368125f, 0.998027f, 0.481754f,
     -0.587785f,-0.982287f,-0.248690f, 0.770513f, 0.904827f, 0.000000f,-0.904827f,-0.770513f, 0.248690f, 0.982287f,
      0.587785f,-0.481754f,-0.998027f,-0.368125f, 0.684547f, 0.951057f, 0.125333f,-0.844328f,-0.844328f, 0.125333f,
      0.951057f, 0.684547f,-0.368125f,-0.998027f,-0.481754f, 0.587785f, 0.982287f, 0.248690f,-0.770513f,-0.904827f},
    { 0.000000f, 0.951057f, 0.587785f,-0.587785f,-0.951057f,-0.000000f, 0.951057f, 0.587785f,-0.587785f,-0.951057f,
     -0.000000f, 0.951057f, 0.587785f,-0.587785f,-0.951057f,-0.000000f, 0.951057f, 0.587785f,-0.587785f,-0.951057f,
     -0.000000f, 0.951057f, 0.587785f,-0.587785f,-0.951057f,-0.000000f, 0.951057f, 0.587785f,-0.587785f,-0.951057f,
     -0.000000f, 0.951057f, 0.587785f,-0.587785f,-0.951057f,-0.000000f, 0.951057f, 0.587785f,-0.587785f,-0.951057f,
     -0.000000f, 0.951057f, 0.587785f,-0.587785f,-0.951057f,-0.000000f, 0.951057f, 0.587785f,-0.587785f,-0.951057f},
    { 0.000000f, 0.982287f, 0.368125f,-0.844328f,-0.684547f, 0.587785f, 0.904827f,-0.248690f,-0.998027f,-0.125333f,
      0.951057f, 0.481754f,-0.770513f,-0.770513f, 0.481754f, 0.951057f,-0.125333f,-0.998027f,-0.248690f, 0.904827f,
      0.587785f,-0.684547f,-0.844328f, 0.368125f, 0.982287f, 0.000000f,-0.982287f,-0.368125f, 0.844328f, 0.684547f,
     -0.587785f,-0.904827f, 0.248690f, 0.998027f, 0.125333f,-0.951057f,-0.481754f, 0.770513f, 0.770513f,-0.481754f,
     -0.951057f, 0.125333f, 0.998027f, 0.248690f,-0.904827f,-0.587785f, 0.684547f, 0.844328f,-0.368125f,-0.982287f},
    { 0.000000f, 0.998027f, 0.125333f,-0.982287f,-0.248690f, 0.951057f, 0.368125f,-0.904827f,-0.481754f, 0.844328f,
      0.587785f,-0.770513f,-0.684547f, 0.684547f, 0.770513f,-0.587785f,-0.844328f, 0.481754f, 0.904827f,-0.368125f,
     -0.951057f, 0.248690f, 0.982287f,-0.125333f,-0.998027f,-0.000000f, 0.998027f, 0.125333f,-0.982287f,-0.248690f,
      0.951057f, 0.368125f,-0.904827f,-0.481754f, 0.844328f, 0.587785f,-0.770513f,-0.684547f, 0.684547f, 0.770513f,
     -0.587785f,-0.844328f, 0.481754f, 0.904827f,-0.368125f,-0.951057f, 0.248690f, 0.982287f,-0.125333f,-0.998027f},
    { 0.000000f, 0.998027f,-0.125333f,-0.982287f, 0.248690f, 0.951057f,-0.368125f,-0.904827f, 0.481754f, 0.844328f,
     -0.587785f,-0.770513f, 0.684547f, 0.684547f,-0.770513f,-0.587785f, 0.844328f, 0.481754f,-0.904827f,-0.368125f,
      0.951057f, 0.248690f,-0.982287f,-0.125333f, 0.998027f,-0.000000f,-0.998027f, 0.125333f, 0.982287f,-0.248690f,
     -0.951057f, 0.368125f, 0.904827f,-0.481754f,-0.844328f, 0.587785f, 0.770513f,-0.684547f,-0.684547f, 0.770513f,
      0.587785f,-0.844328f,-0.481754f, 0.904827f, 0.368125f,-0.951057f,-0.248690f, 0.982287f, 0.125333f,-0.998027f},
    { 0.000000f, 0.982287f,-0.368125f,-0.844328f, 0.684547f, 0.587785f,-0.904827f,-0.248690f, 0.998027f,-0.125333f,
     -0.951057f, 0.481754f, 0.770513f,-0.770513f,-0.481754f, 0.951057f, 0.125333f,-0.998027f, 0.248690f, 0.904827f,
     -0.587785f,-0.684547f, 0.844328f, 0.368125f,-0.982287f,-0.000000f, 0.982287f,-0.368125f,-0.844328f, 0.684547f,
      0.587785f,-0.904827f,-0.248690f, 0.998027f,-0.125333f,-0.951057f, 0.481754f, 0.770513f,-0.770513f,-0.481754f,
      0.951057f, 0.125333f,-0.998027f, 0.248690f, 0.904827f,-0.587785f,-0.684547f, 0.844328f, 0.368125f,-0.982287f},
    { 0.000000f, 0.951057f,-0.587785f,-0.587785f, 0.951057f, 0.000000f,-0.951057f, 0.587785f, 0.587785f,-0.951057f,
     -0.000000f, 0.951057f,-0.587785f,-0.587785f, 0.951057f, 0.000000f,-0.951057f, 0.587785f, 0.587785f,-0.951057f,
     -0.000000f, 0.951057f,-0.587785f,-0.587785f, 0.951057f, 0.000000f,-0.951057f, 0.587785f, 0.587785f,-0.951057f,
     -0.000000f, 0.951057f,-0.587785f,-0.587785f, 0.951057f,-0.000000f,-0.951057f, 0.587785f, 0.587785f,-0.951057f,
     -0.000000f, 0.951057f,-0.587785f,-0.587785f, 0.951057f, 0.000000f,-0.951057f, 0.587785f, 0.587785f,-0.951057f},
    { 0.000000f, 0.904827f,-0.770513f,-0.248690f, 0.982287f,-0.587785f,-0.481754f, 0.998027f,-0.368125f,-0.684547f,
      0.951057f,-0.125333f,-0.844328f, 0.844328f, 0.125333f,-0.951057f, 0.684547f, 0.368125f,-0.998027f, 0.481754f,
      0.587785f,-0.982287f, 0.248690f, 0.770513f,-0.904827f,-0.000000f, 0.904827f,-0.770513f,-0.248690f, 0.982287f,
     -0.587785f,-0.481754f, 0.998027f,-0.368125f,-0.684547f, 0.951057f,-0.125333f,-0.844328f, 0.844328f, 0.125333f,
     -0.951057f, 0.684547f, 0.368125f,-0.998027f, 0.481754f, 0.587785f,-0.982287f, 0.248690f, 0.770513f,-0.904827f},
    { 0.000000f, 0.844328f,-0.904827f, 0.125333f, 0.770513f,-0.951057f, 0.248690f, 0.684547f,-0.982287f, 0.368125f,
      0.587785f,-0.998027f, 0.481754f, 0.481754f,-0.998027f, 0.587785f, 0.368125f,-0.982287f, 0.684547f, 0.248690f,
     -0.951057f, 0.770513f, 0.125333f,-0.904827f, 0.844328f,-0.000000f,-0.844328f, 0.904827f,-0.125333f,-0.770513f,
      0.951057f,-0.248690f,-0.684547f, 0.982287f,-0.368125f,-0.587785f, 0.998027f,-0.481754f,-0.481754f, 0.998027f,
     -0.587785f,-0.368125f, 0.982287f,-0.684547f,-0.248690f, 0.951057f,-0.770513f,-0.125333f, 0.904827f,-0.844328f},
    { 0.000000f, 0.770513f,-0.982287f, 0.481754f, 0.368125f,-0.951057f, 0.844328f,-0.125333f,-0.684547f, 0.998027f,
     -0.587785f,-0.248690f, 0.904827f,-0.904827f, 0.248690f, 0.587785f,-0.998027f, 0.684547f, 0.125333f,-0.844328f,
      0.951057f,-0.368125f,-0.481754f, 0.982287f,-0.770513f,-0.000000f, 0.770513f,-0.982287f, 0.481754f, 0.368125f,
     -0.951057f, 0.844328f,-0.125333f,-0.684547f, 0.998027f,-0.587785f,-0.248690f, 0.904827f,-0.904827f, 0.248690f,
      0.587785f,-0.998027f, 0.684547f, 0.125333f,-0.844328f, 0.951057f,-0.368125f,-0.481754f, 0.982287f,-0.770513f},
    { 0.000000f, 0.684547f,-0.998027f, 0.770513f,-0.125333f,-0.587785f, 0.982287f,-0.844328f, 0.248690f, 0.481754f,
     -0.951057f, 0.904827f,-0.368125f,-0.368125f, 0.904827f,-0.951057f, 0.481754f, 0.248690f,-0.844328f, 0.982287f,
     -0.587785f,-0.125333f, 0.770513f,-0.998027f, 0.684547f, 0.000000f,-0.684547f, 0.998027f,-0.770513f, 0.125333f,
      0.587785f,-0.982287f, 0.844328f,-0.248690f,-0.481754f, 0.951057f,-0.904827f, 0.368125f, 0.368125f,-0.904827f,
      0.951057f,-0.481754f,-0.248690f, 0.844328f,-0.982287f, 0.587785f, 0.125333f,-0.770513f, 0.998027f,-0.684547f},
    { 0.000000f, 0.587785f,-0.951057f, 0.951057f,-0.587785f,-0.000000f, 0.587785f,-0.951057f, 0.951057f,-0.587785f,
     -0.000000f, 0.587785f,-0.951057f, 0.951057f,-0.587785f,-0.000000f, 0.587785f,-0.951057f, 0.951057f,-0.587785f,
     -0.000000f, 0.587785f,-0.951057f, 0.951057f,-0.587785f,-0.000000f, 0.587785f,-0.951057f, 0.951057f,-0.587785f,
     -0.000000f, 0.587785f,-0.951057f, 0.951057f,-0.587785f,-0.000000f, 0.587785f,-0.951057f, 0.951057f,-0.587785f,
     -0.000000f, 0.587785f,-0.951057f, 0.951057f,-0.587785f,-0.000000f, 0.587785f,-0.951057f, 0.951057f,-0.587785f},
    { 0.000000f, 0.481754f,-0.844328f, 0.998027f,-0.904827f, 0.587785f,-0.125333f,-0.368125f, 0.770513f,-0.982287f,
      0.951057f,-0.684547f, 0.248690f, 0.248690f,-0.684547f, 0.951057f,-0.982287f, 0.770513f,-0.368125f,-0.125333f,
      0.587785f,-0.904827f, 0.998027f,-0.844328f, 0.481754f,-0.000000f,-0.481754f, 0.844328f,-0.998027f, 0.904827f,
     -0.587785f, 0.125333f, 0.368125f,-0.770513f, 0.982287f,-0.951057f, 0.684547f,-0.248690f,-0.248690f, 0.684547f,
     -0.951057f, 0.982287f,-0.770513f, 0.368125f, 0.125333f,-0.587785f, 0.904827f,-0.998027f, 0.844328f,-0.481754f},
    { 0.000000f, 0.368125f,-0.684547f, 0.904827f,-0.998027f, 0.951057f,-0.770513f, 0.481754f,-0.125333f,-0.248690f,
      0.587785f,-0.844328f, 0.982287f,-0.982287f, 0.844328f,-0.587785f, 0.248690f, 0.125333f,-0.481754f, 0.770513f,
     -0.951057f, 0.998027f,-0.904827f, 0.684547f,-0.368125f,-0.000000f, 0.368125f,-0.684547f, 0.904827f,-0.998027f,
      0.951057f,-0.770513f, 0.481754f,-0.125333f,-0.248690f, 0.587785f,-0.844328f, 0.982287f,-0.982287f, 0.844328f,
     -0.587785f, 0.248690f, 0.125333f,-0.481754f, 0.770513f,-0.951057f, 0.998027f,-0.904827f, 0.684547f,-0.368125f},
    { 0.000000f, 0.248690f,-0.481754f, 0.684547f,-0.844328f, 0.951057f,-0.998027f, 0.982287f,-0.904827f, 0.770513f,
     -0.587785f, 0.368125f,-0.125333f,-0.125333f, 0.368125f,-0.587785f, 0.770513f,-0.904827f, 0.982287f,-0.998027f,
      0.951057f,-0.844328f, 0.684547f,-0.481754f, 0.248690f, 0.000000f,-0.248690f, 0.481754f,-0.684547f, 0.844328f,
     -0.951057f, 0.998027f,-0.982287f, 0.904827f,-0.770513f, 0.587785f,-0.368125f, 0.125333f, 0.125333f,-0.368125f,
      0.587785f,-0.770513f, 0.904827f,-0.982287f, 0.998027f,-0.951057f, 0.844328f,-0.684547f, 0.481754f,-0.248690f},
    { 0.000000f, 0.125333f,-0.248690f, 0.368125f,-0.481754f, 0.587785f,-0.684547f, 0.770513f,-0.844328f, 0.904827f,
     -0.951057f, 0.982287f,-0.998027f, 0.998027f,-0.982287f, 0.951057f,-0.904827f, 0.844328f,-0.770513f, 0.684547f,
     -0.587785f, 0.481754f,-0.368125f, 0.248690f,-0.125333f,-0.000000f, 0.125333f,-0.248690f, 0.368125f,-0.481754f,
      0.587785f,-0.684547f, 0.770513f,-0.844328f, 0.904827f,-0.951057f, 0.982287f,-0.998027f, 0.998027f,-0.982287f,
      0.951057f,-0.904827f, 0.844328f,-0.770513f, 0.684547f,-0.587785f, 0.481754f,-0.368125f, 0.248690f,-0.125333f}
};

/* ══════════════════════════════════════════════════════════════
 * Feature Extraction — 14 features per signal
 * DFT uses precomputed lookup tables (NO cosf/sinf calls)
 * ══════════════════════════════════════════════════════════════ */

static void cc_feat14(const float* x, int n, float fs, float out[14]) {
    int i, k;
    float sum = 0, abssum = 0, sqsum = 0;
    float mn = x[0], mx = x[0];

    for (i = 0; i < n; i++) {
        sum += x[i];
        abssum += fabsf(x[i]);
        sqsum += x[i] * x[i];
        if (x[i] < mn) mn = x[i];
        if (x[i] > mx) mx = x[i];
    }
    float mean = sum / n;
    float rms = sqrtf(sqsum / n);

    float var = 0;
    for (i = 0; i < n; i++) {
        float d = x[i] - mean;
        var += d * d;
    }
    var /= n;
    float sd = sqrtf(var);

    /* Median via insertion sort */
    float tmp[50];
    memcpy(tmp, x, n * sizeof(float));
    for (i = 1; i < n; i++) {
        float key = tmp[i];
        int j = i - 1;
        while (j >= 0 && tmp[j] > key) {
            tmp[j + 1] = tmp[j];
            j--;
        }
        tmp[j + 1] = key;
    }
    float med = (n % 2) ? tmp[n/2] : (tmp[n/2-1] + tmp[n/2]) * 0.5f;

    int zc = 0;
    for (i = 1; i < n; i++) {
        float a = x[i-1] - mean;
        float b = x[i] - mean;
        if ((a > 0 && b < 0) || (a < 0 && b > 0)) zc++;
    }

    float aav = 0;
    for (i = 1; i < n; i++) aav += fabsf(x[i] - x[i-1]);
    aav /= (n - 1);

    float sk = 0, ku = 0;
    if (sd > 1e-10f) {
        for (i = 0; i < n; i++) {
            float z = (x[i] - mean) / sd;
            float z2 = z * z;
            sk += z2 * z;
            ku += z2 * z2;
        }
        sk /= n;
        ku = ku / n - 3.0f;
    }

    /* DFT with lookup tables */
    float centered[50];
    for (i = 0; i < n; i++) centered[i] = x[i] - mean;

    int half = n / 2;
    float max_spec = 0;
    int max_k = 1;
    float sum_spec = 0;

    for (k = 1; k < half; k++) {
        float re = 0, im = 0;
        for (i = 0; i < n; i++) {
            re += centered[i] * CC_COS_TABLE[k][i];
            im -= centered[i] * CC_SIN_TABLE[k][i];
        }
        float mag = sqrtf(re * re + im * im);
        sum_spec += mag;
        if (mag > max_spec) {
            max_spec = mag;
            max_k = k;
        }
    }

    out[0]  = mean;
    out[1]  = med;
    out[2]  = sd;
    out[3]  = (float)zc / n;
    out[4]  = mx - mn;
    out[5]  = sum;
    out[6]  = abssum;
    out[7]  = rms;
    out[8]  = aav;
    out[9]  = sk;
    out[10] = ku;
    out[11] = (float)max_k * fs / n;
    out[12] = max_spec;
    out[13] = (half > 1) ? sum_spec / (half - 1) : 0;
}

static void cc_extract_all(
    const float ax[], const float ay[], const float az[],
    const float gx[], const float gy[], const float gz[],
    int n, float fs, float feat[112])
{
    int i;
    float amag[50], gmag[50];
    for (i = 0; i < n; i++) {
        amag[i] = sqrtf(ax[i]*ax[i] + ay[i]*ay[i] + az[i]*az[i]);
        gmag[i] = sqrtf(gx[i]*gx[i] + gy[i]*gy[i] + gz[i]*gz[i]);
    }
    const float* sig[8] = {ax, ay, az, amag, gx, gy, gz, gmag};
    for (i = 0; i < 8; i++) {
        cc_feat14(sig[i], n, fs, &feat[i * 14]);
    }
}

static void cc_select_features(const float all[112], float sel_out[CC_NUM_SEL_FEAT]) {
    for (int i = 0; i < CC_NUM_SEL_FEAT; i++) {
        sel_out[i] = all[CC_SEL[i]];
    }
}

/* ══════════════════════════════════════════════════════════════
 * Decision Tree Classifier (F1=0.9254)
 * INPUT: SCALED features (zero-mean, unit-variance)
 * ══════════════════════════════════════════════════════════════ */

static int cc_classify_dt(const float f[CC_NUM_SEL_FEAT]) {
    if (f[32] <= -0.303303f) { /* amag_dompsd */
        if (f[54] <= 0.726066f) { /* gz_rms */
            if (f[4] <= -0.855388f) { /* ax_abssum */
                if (f[33] <= 0.572532f) { /* gx_median */
                    if (f[1] <= -0.398096f) { /* ax_median */
                        if (f[57] <= -0.664258f) { /* gmag_abssum */
                            if (f[14] <= 0.768870f) { /* ay_sum */
                                return 3; /* Misc */
                            } else {
                                if (f[15] <= 0.743415f) { /* ay_abssum */
                                    return 2; /* Resting */
                                } else {
                                    return 1; /* Grazing */
                                }
                            }
                        } else {
                            if (f[12] <= -0.664542f) { /* ay_zcr */
                                if (f[48] <= -0.152095f) { /* gz_mean */
                                    if (f[25] <= -0.089314f) { /* az_kurt */
                                        return 2; /* Resting */
                                    } else {
                                        return 0; /* Walking */
                                    }
                                } else {
                                    if (f[24] <= -0.749936f) { /* az_aav */
                                        return 3; /* Misc */
                                    } else {
                                        return 3; /* Misc */
                                    }
                                }
                            } else {
                                if (f[42] <= -1.030828f) { /* gy_sum */
                                    if (f[34] <= -0.198700f) { /* gx_p2p */
                                        return 0; /* Walking */
                                    } else {
                                        return 3; /* Misc */
                                    }
                                } else {
                                    return 0; /* Walking */
                                }
                            }
                        }
                    } else {
                        if (f[42] <= -1.092901f) { /* gy_sum */
                            if (f[36] <= -0.337329f) { /* gx_abssum */
                                return 2; /* Resting */
                            } else {
                                return 0; /* Walking */
                            }
                        } else {
                            if (f[18] <= -1.482070f) { /* ay_skew */
                                return 2; /* Resting */
                            } else {
                                if (f[25] <= 2.551491f) { /* az_kurt */
                                    return 3; /* Misc */
                                } else {
                                    return 2; /* Resting */
                                }
                            }
                        }
                    }
                } else {
                    if (f[59] <= -1.617913f) { /* gmag_aav */
                        return 2; /* Resting */
                    } else {
                        if (f[3] <= -0.284775f) { /* ax_sum */
                            return 3; /* Misc */
                        } else {
                            if (f[59] <= -0.554669f) { /* gmag_aav */
                                return 2; /* Resting */
                            } else {
                                return 3; /* Misc */
                            }
                        }
                    }
                }
            } else {
                if (f[2] <= -0.455804f) { /* ax_zcr */
                    if (f[1] <= -1.518871f) { /* ax_median */
                        if (f[9] <= 0.517449f) { /* ay_mean */
                            if (f[58] <= -0.064110f) { /* gmag_rms */
                                return 2; /* Resting */
                            } else {
                                if (f[17] <= -0.679322f) { /* ay_aav */
                                    if (f[18] <= -1.119834f) { /* ay_skew */
                                        return 3; /* Misc */
                                    } else {
                                        return 3; /* Misc */
                                    }
                                } else {
                                    return 2; /* Resting */
                                }
                            }
                        } else {
                            return 3; /* Misc */
                        }
                    } else {
                        if (f[44] <= 0.703517f) { /* gy_rms */
                            if (f[24] <= -0.930688f) { /* az_aav */
                                return 2; /* Resting */
                            } else {
                                if (f[17] <= -0.704086f) { /* ay_aav */
                                    if (f[24] <= -0.857949f) { /* az_aav */
                                        if (f[7] <= -2.131665f) { /* ax_domfreq */
                                            return 3; /* Misc */
                                        } else {
                                            return 2; /* Resting */
                                        }
                                    } else {
                                        if (f[38] <= -0.145665f) { /* gx_aav */
                                            return 3; /* Misc */
                                        } else {
                                            return 3; /* Misc */
                                        }
                                    }
                                } else {
                                    if (f[17] <= -0.305087f) { /* ay_aav */
                                        if (f[45] <= -0.366447f) { /* gy_aav */
                                            return 2; /* Resting */
                                        } else {
                                            return 3; /* Misc */
                                        }
                                    } else {
                                        if (f[26] <= -0.322935f) { /* amag_std */
                                            return 1; /* Grazing */
                                        } else {
                                            return 0; /* Walking */
                                        }
                                    }
                                }
                            }
                        } else {
                            if (f[28] <= 0.073723f) { /* amag_sum */
                                return 2; /* Resting */
                            } else {
                                if (f[38] <= 1.002860f) { /* gx_aav */
                                    return 0; /* Walking */
                                } else {
                                    return 0; /* Walking */
                                }
                            }
                        }
                    }
                } else {
                    if (f[47] <= -0.333595f) { /* gy_dompsd */
                        if (f[17] <= -0.753961f) { /* ay_aav */
                            if (f[5] <= 0.815935f) { /* ax_rms */
                                if (f[58] <= -0.428215f) { /* gmag_rms */
                                    if (f[29] <= -0.353841f) { /* amag_abssum */
                                        if (f[24] <= -0.843425f) { /* az_aav */
                                            return 2; /* Resting */
                                        } else {
                                            return 3; /* Misc */
                                        }
                                    } else {
                                        if (f[15] <= 0.110334f) { /* ay_abssum */
                                            return 3; /* Misc */
                                        } else {
                                            return 2; /* Resting */
                                        }
                                    }
                                } else {
                                    if (f[2] <= -0.267923f) { /* ax_zcr */
                                        return 2; /* Resting */
                                    } else {
                                        return 2; /* Resting */
                                    }
                                }
                            } else {
                                if (f[4] <= 1.601317f) { /* ax_abssum */
                                    if (f[11] <= -0.824957f) { /* ay_std */
                                        return 3; /* Misc */
                                    } else {
                                        if (f[33] <= -0.000736f) { /* gx_median */
                                            return 3; /* Misc */
                                        } else {
                                            return 2; /* Resting */
                                        }
                                    }
                                } else {
                                    if (f[45] <= -1.038836f) { /* gy_aav */
                                        return 2; /* Resting */
                                    } else {
                                        return 2; /* Resting */
                                    }
                                }
                            }
                        } else {
                            if (f[39] <= -0.169206f) { /* gx_dompsd */
                                if (f[40] <= -1.493922f) { /* gy_mean */
                                    return 2; /* Resting */
                                } else {
                                    return 2; /* Resting */
                                }
                            } else {
                                if (f[17] <= -0.670317f) { /* ay_aav */
                                    if (f[25] <= -0.102392f) { /* az_kurt */
                                        return 2; /* Resting */
                                    } else {
                                        return 3; /* Misc */
                                    }
                                } else {
                                    if (f[26] <= -0.719967f) { /* amag_std */
                                        return 2; /* Resting */
                                    } else {
                                        return 2; /* Resting */
                                    }
                                }
                            }
                        }
                    } else {
                        if (f[35] <= 0.741793f) { /* gx_sum */
                            if (f[42] <= -0.330075f) { /* gy_sum */
                                if (f[47] <= 0.562779f) { /* gy_dompsd */
                                    if (f[27] <= -1.127518f) { /* amag_zcr */
                                        return 2; /* Resting */
                                    } else {
                                        return 2; /* Resting */
                                    }
                                } else {
                                    if (f[38] <= 0.889320f) { /* gx_aav */
                                        return 3; /* Misc */
                                    } else {
                                        return 1; /* Grazing */
                                    }
                                }
                            } else {
                                if (f[9] <= -0.627198f) { /* ay_mean */
                                    return 3; /* Misc */
                                } else {
                                    return 3; /* Misc */
                                }
                            }
                        } else {
                            if (f[17] <= -0.767209f) { /* ay_aav */
                                if (f[19] <= -0.779239f) { /* ay_dompsd */
                                    return 3; /* Misc */
                                } else {
                                    return 2; /* Resting */
                                }
                            } else {
                                if (f[44] <= -0.983943f) { /* gy_rms */
                                    return 1; /* Grazing */
                                } else {
                                    return 2; /* Resting */
                                }
                            }
                        }
                    }
                }
            }
        } else {
            if (f[3] <= 0.346532f) { /* ax_sum */
                if (f[35] <= 0.493750f) { /* gx_sum */
                    if (f[41] <= -0.066545f) { /* gy_median */
                        if (f[14] <= -0.080638f) { /* ay_sum */
                            if (f[0] <= 0.068795f) { /* ax_mean */
                                return 0; /* Walking */
                            } else {
                                return 3; /* Misc */
                            }
                        } else {
                            if (f[16] <= -0.350605f) { /* ay_rms */
                                if (f[21] <= -2.649400f) { /* az_zcr */
                                    return 2; /* Resting */
                                } else {
                                    return 2; /* Resting */
                                }
                            } else {
                                if (f[49] <= -0.855454f) { /* gz_median */
                                    return 0; /* Walking */
                                } else {
                                    return 1; /* Grazing */
                                }
                            }
                        }
                    } else {
                        if (f[17] <= -0.600354f) { /* ay_aav */
                            return 3; /* Misc */
                        } else {
                            if (f[55] <= -0.133297f) { /* gz_aav */
                                if (f[37] <= -0.620562f) { /* gx_rms */
                                    return 2; /* Resting */
                                } else {
                                    return 1; /* Grazing */
                                }
                            } else {
                                return 0; /* Walking */
                            }
                        }
                    }
                } else {
                    if (f[10] <= -0.171567f) { /* ay_median */
                        if (f[1] <= 0.353306f) { /* ax_median */
                            if (f[33] <= 0.280780f) { /* gx_median */
                                return 3; /* Misc */
                            } else {
                                return 3; /* Misc */
                            }
                        } else {
                            return 1; /* Grazing */
                        }
                    } else {
                        if (f[42] <= 0.588888f) { /* gy_sum */
                            if (f[9] <= 0.326292f) { /* ay_mean */
                                return 0; /* Walking */
                            } else {
                                if (f[34] <= 0.859623f) { /* gx_p2p */
                                    return 1; /* Grazing */
                                } else {
                                    return 3; /* Misc */
                                }
                            }
                        } else {
                            return 2; /* Resting */
                        }
                    }
                }
            } else {
                if (f[11] <= -1.012952f) { /* ay_std */
                    return 2; /* Resting */
                } else {
                    if (f[23] <= -0.801236f) { /* az_abssum */
                        return 1; /* Grazing */
                    } else {
                        if (f[41] <= -0.820203f) { /* gy_median */
                            if (f[29] <= -0.435809f) { /* amag_abssum */
                                return 2; /* Resting */
                            } else {
                                return 3; /* Misc */
                            }
                        } else {
                            return 3; /* Misc */
                        }
                    }
                }
            }
        }
    } else {
        if (f[23] <= -0.291020f) { /* az_abssum */
            if (f[24] <= 0.078278f) { /* az_aav */
                if (f[49] <= -1.174894f) { /* gz_median */
                    if (f[0] <= -1.164551f) { /* ax_mean */
                        if (f[51] <= 2.177821f) { /* gz_p2p */
                            return 3; /* Misc */
                        } else {
                            return 1; /* Grazing */
                        }
                    } else {
                        if (f[25] <= -0.574404f) { /* az_kurt */
                            return 1; /* Grazing */
                        } else {
                            return 1; /* Grazing */
                        }
                    }
                } else {
                    if (f[22] <= 0.612689f) { /* az_sum */
                        if (f[19] <= -0.093029f) { /* ay_dompsd */
                            if (f[55] <= 0.134038f) { /* gz_aav */
                                return 2; /* Resting */
                            } else {
                                return 1; /* Grazing */
                            }
                        } else {
                            if (f[10] <= -1.409933f) { /* ay_median */
                                return 1; /* Grazing */
                            } else {
                                if (f[56] <= -0.924518f) { /* gmag_sum */
                                    return 1; /* Grazing */
                                } else {
                                    return 0; /* Walking */
                                }
                            }
                        }
                    } else {
                        if (f[33] <= -1.758931f) { /* gx_median */
                            if (f[53] <= -0.768747f) { /* gz_abssum */
                                return 2; /* Resting */
                            } else {
                                return 1; /* Grazing */
                            }
                        } else {
                            if (f[24] <= -0.322282f) { /* az_aav */
                                return 1; /* Grazing */
                            } else {
                                return 1; /* Grazing */
                            }
                        }
                    }
                }
            } else {
                if (f[12] <= -0.382290f) { /* ay_zcr */
                    if (f[22] <= 0.802828f) { /* az_sum */
                        if (f[0] <= -1.051629f) { /* ax_mean */
                            if (f[40] <= 0.078716f) { /* gy_mean */
                                if (f[5] <= 2.820906f) { /* ax_rms */
                                    return 2; /* Resting */
                                } else {
                                    return 3; /* Misc */
                                }
                            } else {
                                return 0; /* Walking */
                            }
                        } else {
                            if (f[29] <= 1.394648f) { /* amag_abssum */
                                return 1; /* Grazing */
                            } else {
                                return 3; /* Misc */
                            }
                        }
                    } else {
                        if (f[21] <= -2.118842f) { /* az_zcr */
                            if (f[59] <= 0.994739f) { /* gmag_aav */
                                if (f[26] <= 2.096799f) { /* amag_std */
                                    return 1; /* Grazing */
                                } else {
                                    return 3; /* Misc */
                                }
                            } else {
                                return 2; /* Resting */
                            }
                        } else {
                            return 1; /* Grazing */
                        }
                    }
                } else {
                    if (f[32] <= 0.079802f) { /* amag_dompsd */
                        if (f[44] <= -1.552448f) { /* gy_rms */
                            return 3; /* Misc */
                        } else {
                            return 1; /* Grazing */
                        }
                    } else {
                        if (f[23] <= -3.045778f) { /* az_abssum */
                            return 2; /* Resting */
                        } else {
                            return 1; /* Grazing */
                        }
                    }
                }
            }
        } else {
            if (f[12] <= 0.323338f) { /* ay_zcr */
                if (f[31] <= 0.296390f) { /* amag_kurt */
                    if (f[28] <= 2.805380f) { /* amag_sum */
                        if (f[28] <= -0.863401f) { /* amag_sum */
                            if (f[17] <= 0.025768f) { /* ay_aav */
                                if (f[45] <= -0.476027f) { /* gy_aav */
                                    return 2; /* Resting */
                                } else {
                                    return 3; /* Misc */
                                }
                            } else {
                                return 1; /* Grazing */
                            }
                        } else {
                            if (f[22] <= -0.132114f) { /* az_sum */
                                if (f[31] <= -0.465872f) { /* amag_kurt */
                                    return 0; /* Walking */
                                } else {
                                    if (f[56] <= -1.495087f) { /* gmag_sum */
                                        if (f[21] <= -1.146153f) { /* az_zcr */
                                            return 3; /* Misc */
                                        } else {
                                            return 0; /* Walking */
                                        }
                                    } else {
                                        if (f[39] <= 1.024878f) { /* gx_dompsd */
                                            return 0; /* Walking */
                                        } else {
                                            return 0; /* Walking */
                                        }
                                    }
                                }
                            } else {
                                if (f[1] <= -0.942882f) { /* ax_median */
                                    if (f[52] <= -1.484419f) { /* gz_sum */
                                        return 2; /* Resting */
                                    } else {
                                        return 0; /* Walking */
                                    }
                                } else {
                                    if (f[7] <= -0.276157f) { /* ax_domfreq */
                                        if (f[2] <= -1.395208f) { /* ax_zcr */
                                            return 3; /* Misc */
                                        } else {
                                            return 0; /* Walking */
                                        }
                                    } else {
                                        if (f[7] <= 0.342346f) { /* ax_domfreq */
                                            return 1; /* Grazing */
                                        } else {
                                            return 0; /* Walking */
                                        }
                                    }
                                }
                            }
                        }
                    } else {
                        if (f[30] <= -0.156877f) { /* amag_skew */
                            return 3; /* Misc */
                        } else {
                            return 3; /* Misc */
                        }
                    }
                } else {
                    if (f[39] <= 0.994942f) { /* gx_dompsd */
                        if (f[32] <= -0.178138f) { /* amag_dompsd */
                            if (f[45] <= -0.505911f) { /* gy_aav */
                                return 2; /* Resting */
                            } else {
                                return 3; /* Misc */
                            }
                        } else {
                            if (f[2] <= -2.146731f) { /* ax_zcr */
                                if (f[32] <= 0.229594f) { /* amag_dompsd */
                                    return 2; /* Resting */
                                } else {
                                    return 3; /* Misc */
                                }
                            } else {
                                if (f[26] <= 0.194063f) { /* amag_std */
                                    if (f[16] <= -0.377005f) { /* ay_rms */
                                        if (f[32] <= 0.338879f) { /* amag_dompsd */
                                            return 3; /* Misc */
                                        } else {
                                            return 0; /* Walking */
                                        }
                                    } else {
                                        if (f[53] <= -1.054237f) { /* gz_abssum */
                                            return 3; /* Misc */
                                        } else {
                                            return 0; /* Walking */
                                        }
                                    }
                                } else {
                                    if (f[9] <= -1.137012f) { /* ay_mean */
                                        return 1; /* Grazing */
                                    } else {
                                        if (f[13] <= 3.204241f) { /* ay_p2p */
                                            return 0; /* Walking */
                                        } else {
                                            return 1; /* Grazing */
                                        }
                                    }
                                }
                            }
                        }
                    } else {
                        if (f[12] <= -0.805668f) { /* ay_zcr */
                            if (f[35] <= 0.782148f) { /* gx_sum */
                                if (f[19] <= 4.287490f) { /* ay_dompsd */
                                    if (f[17] <= -0.598015f) { /* ay_aav */
                                        if (f[42] <= 0.596658f) { /* gy_sum */
                                            return 2; /* Resting */
                                        } else {
                                            return 3; /* Misc */
                                        }
                                    } else {
                                        return 3; /* Misc */
                                    }
                                } else {
                                    return 1; /* Grazing */
                                }
                            } else {
                                if (f[35] <= 0.872142f) { /* gx_sum */
                                    return 2; /* Resting */
                                } else {
                                    return 2; /* Resting */
                                }
                            }
                        } else {
                            if (f[53] <= 0.010102f) { /* gz_abssum */
                                return 3; /* Misc */
                            } else {
                                if (f[25] <= 0.406670f) { /* az_kurt */
                                    if (f[36] <= -0.050225f) { /* gx_abssum */
                                        return 3; /* Misc */
                                    } else {
                                        return 1; /* Grazing */
                                    }
                                } else {
                                    return 0; /* Walking */
                                }
                            }
                        }
                    }
                }
            } else {
                if (f[17] <= 0.477845f) { /* ay_aav */
                    if (f[14] <= -0.397648f) { /* ay_sum */
                        if (f[17] <= 0.237562f) { /* ay_aav */
                            if (f[6] <= -0.206696f) { /* ax_kurt */
                                if (f[30] <= 0.093734f) { /* amag_skew */
                                    if (f[24] <= 0.254392f) { /* az_aav */
                                        if (f[20] <= 0.205688f) { /* ay_avgpsd */
                                            return 2; /* Resting */
                                        } else {
                                            return 2; /* Resting */
                                        }
                                    } else {
                                        return 1; /* Grazing */
                                    }
                                } else {
                                    return 0; /* Walking */
                                }
                            } else {
                                if (f[5] <= 0.069948f) { /* ax_rms */
                                    if (f[58] <= 0.638494f) { /* gmag_rms */
                                        return 2; /* Resting */
                                    } else {
                                        return 1; /* Grazing */
                                    }
                                } else {
                                    return 3; /* Misc */
                                }
                            }
                        } else {
                            return 1; /* Grazing */
                        }
                    } else {
                        return 0; /* Walking */
                    }
                } else {
                    if (f[23] <= 0.787088f) { /* az_abssum */
                        if (f[2] <= -1.301268f) { /* ax_zcr */
                            if (f[34] <= 0.844430f) { /* gx_p2p */
                                return 2; /* Resting */
                            } else {
                                return 0; /* Walking */
                            }
                        } else {
                            if (f[18] <= -2.224664f) { /* ay_skew */
                                if (f[51] <= 0.983845f) { /* gz_p2p */
                                    return 2; /* Resting */
                                } else {
                                    return 1; /* Grazing */
                                }
                            } else {
                                return 1; /* Grazing */
                            }
                        }
                    } else {
                        return 0; /* Walking */
                    }
                }
            }
        }
    }
}

/* ── Logistic Regression (F1=0.9170) ──────────────────── */

static const float CC_LR_COEF[4][60] = {
    {0.39054108f, -0.65698618f, -0.26309496f, 0.39058879f, 0.40738791f, -0.96961325f, 0.00319059f, 0.04624583f, 0.16010858f, 0.99075466f, -2.27919388f, -5.72758532f, 0.15350015f, -0.94311386f, 0.99072772f, 8.93224907f, -8.79292965f, 1.37709868f, 0.04492383f, 1.69526744f, 4.53627872f, 0.27272519f, -11.71716213f, -10.06965065f, 1.67570102f, 0.41048837f, 0.88941580f, -0.33227372f, 0.00636451f, 0.00636451f, 0.46302933f, -0.95161182f, 1.02995753f, 0.42009845f, 0.39804578f, -1.45302474f, 2.54710340f, -3.02302194f, 0.09794236f, -0.34470338f, 0.11191180f, -0.00598353f, 0.11187492f, 3.61943698f, -4.22403097f, -0.20124236f, -0.02437216f, -0.06712135f, -2.89234734f, 0.77376413f, -0.60041296f, 0.30381244f, -2.89235091f, 1.28784728f, -5.65845394f, 0.48930004f, 6.97022438f, 6.97022438f, -13.62922192f, 0.07732534f},
    {0.94859159f, -0.88053519f, 0.61204839f, 0.94857842f, -2.44279099f, 0.80972743f, -0.07912686f, 0.05423311f, -0.53014600f, -0.26609126f, -0.26321077f, 4.83493280f, -0.35795805f, -0.93677306f, -0.26606274f, -1.71470654f, 1.34957242f, 8.26113033f, 0.20473999f, -1.54245234f, -8.23364449f, -0.26180151f, -0.97200054f, -6.06784916f, 1.89864564f, -0.43527514f, 3.85455847f, -1.01105464f, -0.57393014f, -0.57393014f, -0.48752344f, 0.47068065f, 0.52369177f, 1.85483634f, 0.73614019f, -2.50417066f, -1.02551723f, 1.74439132f, -0.48124278f, -0.13468283f, -3.21593785f, 6.09739590f, -3.21594548f, -1.35603559f, 1.50573027f, -0.75174105f, -0.03660154f, 0.32882926f, -0.83101892f, 0.78169215f, -0.99677926f, -0.15206301f, -0.83099133f, 1.56690109f, -0.90318847f, 0.03592484f, 0.42219692f, 0.42219692f, -0.55769390f, -0.20043400f},
    {-0.67000169f, 0.91450220f, -0.12564962f, -0.66999245f, 6.43677950f, -5.71396303f, -0.06436346f, 0.04355225f, 1.68077540f, 0.92379713f, 0.79283917f, 8.25255108f, 0.21014491f, 0.12322855f, 0.92380989f, -7.25627756f, 6.40754366f, -5.45651817f, -0.22166264f, -2.16683054f, 0.80749798f, -0.11343494f, 10.05210972f, 10.85362720f, -3.77189326f, 0.06073468f, -5.80908155f, 0.99192315f, -0.40963158f, -0.40963158f, 0.10747157f, 0.31514972f, -0.17819197f, -0.22121400f, -1.44518209f, 1.25832081f, -2.51047850f, 2.19308805f, -0.05455712f, 0.32069722f, 1.93737280f, -4.60297537f, 1.93732691f, -2.35249376f, 3.32269454f, 0.57574201f, 0.22710040f, -0.52786213f, 0.64180237f, 1.41356766f, 1.18489945f, 0.60652065f, 0.64176321f, 3.91735482f, -3.23937869f, -0.30221096f, -2.01909947f, -2.01909947f, 4.23645973f, 0.06207266f},
    {-0.66913098f, 0.62301922f, -0.22330381f, -0.66917479f, -4.40137625f, 5.87384892f, 0.14029974f, -0.14403118f, -1.31073797f, -1.64846051f, 1.74956548f, -7.35989809f, -0.00568700f, 1.75665843f, -1.64847481f, 0.03873524f, 1.03581393f, -4.18171072f, -0.02800118f, 2.01401544f, 2.88986802f, 0.10251123f, 2.63705277f, 5.28387308f, 0.19754663f, -0.03594790f, 1.06510723f, 0.35140526f, 0.97719723f, 0.97719723f, -0.08297747f, 0.16578145f, -1.37545729f, -2.05372071f, 0.31099609f, 2.69887447f, 0.98889256f, -0.91445750f, 0.43785754f, 0.15868898f, 1.16665328f, -1.48843729f, 1.16674352f, 0.08909225f, -0.60439396f, 0.37724137f, -0.16612670f, 0.26615423f, 3.08156371f, -2.96902394f, 0.41229278f, -0.75827014f, 3.08157897f, -6.77210331f, 9.80102062f, -0.22301391f, -5.37332201f, -5.37332201f, 9.95045567f, 0.06103601f}
};

static const float CC_LR_INTERCEPT[4] = {
    2.44090080f, 1.33174109f, -3.43709731f, -0.33554444f
};

static int cc_classify_lr(const float f[CC_NUM_SEL_FEAT]) {
    /* NOTE: input f[] must already be scaled! */
    float sc[4];
    int c, i, best = 0;
    for (c = 0; c < 4; c++) sc[c] = CC_LR_INTERCEPT[c];
    for (i = 0; i < CC_NUM_SEL_FEAT; i++) {
        for (c = 0; c < 4; c++) sc[c] += f[i] * CC_LR_COEF[c][i];
    }
    for (c = 1; c < 4; c++) if (sc[c] > sc[best]) best = c;
    return best;
}

/* ══════════════════════════════════════════════════════════════
 * Temporal Smoothing — Majority Vote
 * ══════════════════════════════════════════════════════════════ */

typedef struct {
    int history[CC_VOTE_WINDOW];
    int count;
    int head;
} CattleVoter;

static void cc_voter_init(CattleVoter* v) {
    memset(v->history, 0, sizeof(v->history));
    v->count = 0;
    v->head = 0;
}

static int cc_voter_add(CattleVoter* v, int prediction) {
    v->history[v->head] = prediction;
    v->head = (v->head + 1) % CC_VOTE_WINDOW;
    if (v->count < CC_VOTE_WINDOW) v->count++;

    int votes[CC_NUM_CLASSES] = {0};
    for (int i = 0; i < v->count; i++) votes[v->history[i]]++;
    int best = 0;
    for (int c = 1; c < CC_NUM_CLASSES; c++)
        if (votes[c] > votes[best]) best = c;
    return best;
}

/**
 * Full classification pipeline:
 *   1. Extract 112 features from 6-axis window
 *   2. Select 60 features
 *   3. Scale features (StandardScaler: subtract mean, divide by std)
 *   4. Decision Tree classify
 *   5. Majority vote smoothing
 *
 * raw_pred_out: if not NULL, receives the unsmoothed DT prediction
 */
static int cc_classify(
    const float ax[], const float ay[], const float az[],
    const float gx[], const float gy[], const float gz[],
    CattleVoter* voter, int* raw_pred_out)
{
    float feat_all[CC_TOTAL_FEAT];
    float feat_sel[CC_NUM_SEL_FEAT];

    /* 1. Extract all 112 features */
    cc_extract_all(ax, ay, az, gx, gy, gz,
                   CC_WIN_SAMPLES, (float)CC_SAMPLING_HZ, feat_all);

    /* 2. Select relevant features */
    cc_select_features(feat_all, feat_sel);

    /* 3. CRITICAL: Scale features before classification!
     *    Both DT and LR were trained on StandardScaler output. */
    cc_scale_features(feat_sel);

    /* 4. Classify with Decision Tree */
    int raw = cc_classify_dt(feat_sel);
    if (raw_pred_out) *raw_pred_out = raw;

    /* 5. Temporal smoothing */
    return cc_voter_add(voter, raw);
}

/* ══════════════════════════════════════════════════════════════
 * Self-Test Vectors
 * Pre-computed feature vectors (in RAW/unscaled space) that
 * should classify to each of the 4 classes.
 * Use cc_selftest() at startup to verify the pipeline.
 * ══════════════════════════════════════════════════════════════ */

static const float TEST_WALKING[CC_NUM_SEL_FEAT] = {
    -2.420068f, -1.274541f, 0.597845f, 185.618698f, 137.818051f, 3.201943f,
    4.134794f, 1.507084f, 25.102025f, -1.328548f, -1.410865f, 2.449772f,
    0.659641f, 10.280606f, 387.128492f, 170.055954f, 5.921951f, 0.582013f,
    0.336636f, 13.724956f, 6.458231f, 0.570575f, -465.105535f, 579.990814f,
    -0.416081f, -4.844143f, 2.615872f, 0.644367f, 484.115181f, 484.182946f,
    0.167552f, -3.292343f, 15.947929f, -9.478926f, 15.902506f, 1.506528f,
    198.819668f, 8.484137f, 0.945660f, -2.492638f, -18.583582f, 2.920453f,
    145.873083f, 350.682559f, 7.646881f, 0.721787f, -1.793062f, -54.624357f,
    -17.832787f, -12.930351f, 0.395944f, 16.184633f, -112.822091f, 490.502683f,
    11.221788f, 0.384322f, 1116.603611f, 1087.114882f, 23.085340f, 0.433310f
};

static const float TEST_GRAZING[CC_NUM_SEL_FEAT] = {
    3.228140f, 0.522262f, 0.581941f, 380.038833f, 116.358396f, 2.511816f,
    5.016879f, 3.484610f, 6.427885f, 3.152361f, -2.876114f, 0.337082f,
    0.535613f, -8.556436f, -524.511975f, 71.508136f, -0.108405f, 1.639278f,
    -0.990204f, -14.226050f, 17.748330f, 0.431318f, -383.126601f, 260.226430f,
    0.138380f, 1.550860f, -0.809822f, 0.586590f, 464.474107f, 469.428561f,
    -0.527403f, 10.781162f, 13.827088f, -16.285710f, 14.523225f, -946.130600f,
    628.107563f, -4.821663f, 0.200724f, 64.796453f, 12.860204f, 1.455529f,
    -217.399513f, 451.199172f, -1.978177f, 0.364693f, 0.148779f, 98.011645f,
    -7.336618f, -28.474501f, 0.399248f, 3.274251f, -871.121529f, 826.781671f,
    20.255321f, 1.181728f, 1027.016603f, 1084.871264f, 23.103980f, 0.762044f
};

static const float TEST_RESTING[CC_NUM_SEL_FEAT] = {
    -0.929650f, 0.320424f, 0.301866f, -199.228998f, 221.686357f, 5.634644f,
    0.186737f, 3.828163f, 21.695152f, -3.993482f, 2.041985f, 3.042943f,
    0.476561f, 15.469543f, -793.704635f, 305.368812f, 3.805165f, 0.601074f,
    0.086378f, -26.766790f, 3.846019f, 0.530195f, -252.592656f, 342.639909f,
    -0.178839f, -1.405939f, 2.255799f, 0.580070f, 465.610763f, 482.337475f,
    0.296441f, 6.258278f, -2.525521f, -3.227519f, 3.542726f, -1160.292742f,
    664.321465f, 13.214601f, 0.771175f, 26.626181f, -30.534017f, -10.536554f,
    -446.139215f, 206.463459f, 10.606122f, 0.786311f, 4.763879f, 43.354167f,
    -8.187211f, -11.536014f, -0.163256f, 5.762511f, -506.864531f, 1633.716213f,
    9.730462f, 0.922058f, 1114.835390f, 991.053124f, 24.874419f, 0.721268f
};

static const float TEST_MISC[CC_NUM_SEL_FEAT] = {
    4.482087f, -2.761694f, 0.702513f, -243.036596f, 198.977174f, 7.272691f,
    -2.500128f, 1.543861f, 16.882567f, -3.141260f, -9.359014f, 1.058585f,
    0.258357f, 7.932411f, -282.193658f, 428.370731f, 0.708475f, 0.562045f,
    0.863576f, -10.270686f, 7.534436f, 0.691351f, -538.154343f, 406.545235f,
    1.104370f, 4.788633f, -0.937345f, 0.350998f, 482.476579f, 478.869015f,
    0.477313f, 3.073559f, -2.002368f, 6.787550f, 9.736778f, -499.141425f,
    1315.770674f, 14.942736f, 0.259289f, 105.465478f, -21.655280f, 13.927744f,
    1066.235546f, 197.475775f, 21.350649f, 0.789586f, 2.671244f, 150.013888f,
    -13.157660f, -18.350054f, 0.094880f, 0.285244f, -574.725837f, 708.883939f,
    13.765825f, 1.138804f, 1120.043750f, 1277.290353f, 21.803965f, 1.080174f
};

static const int TEST_EXPECTED[4] = {0, 1, 2, 3};
static const float* TEST_VECTORS[4] = {TEST_WALKING, TEST_GRAZING, TEST_RESTING, TEST_MISC};

static int cc_selftest(void) {
    int pass = 0;
    for (int t = 0; t < 4; t++) {
        float f[CC_NUM_SEL_FEAT];
        memcpy(f, TEST_VECTORS[t], sizeof(f));
        cc_scale_features(f);
        int pred = cc_classify_dt(f);
        if (pred == TEST_EXPECTED[t]) {
            pass++;
        }
    }
    return pass; /* returns 4 if all pass */
}

#endif /* CATTLE_CLASSIFIER_H */
