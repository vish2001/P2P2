/**
 * Cattle Behavior Classifier -- ESP32 + BMI270
 * ============================================
 * Generated:    2026-02-22 04:29
 * Best trained: RF (Macro F1 = 0.9344)
 *
 * Embedded models (all pure C, no framework, no dynamic allocation):
 *   PRIMARY:  MLP   -- cc_classify_mlp()  F1=0.9327
 *             Architecture: 39 -> 32 -> 16 -> 4
 *             Flash (weights): ~7 KB
 *             Stack per call:  208 bytes
 *   FALLBACK: DT    -- cc_classify_dt()   F1=0.9110
 *             (compile with -DCC_NO_DT to exclude, saves ~32 KB)
 *   FALLBACK: LR    -- cc_classify_lr()   F1=0.8705
 *
 * DFT tables:  ~9 KB flash (precomputed, no trig at runtime)
 * Features:   39 selected from 112 (20 gyro, 19 accel/mag)
 *
 * Pipeline:   cc_extract_all() -> cc_select_features()
 *          -> cc_scale_features() -> cc_classify_mlp() -> cc_voter_add()
 *
 * IMPORTANT: features must be StandardScaler-normalised before inference:
 *   scaled[i] = (raw[i] - CC_FEAT_MEAN[i]) / CC_FEAT_SCALE[i]
 *   cc_scale_features() does this automatically.
 *
 * Window:  5.0s @ 10Hz = 50 samples, 50% overlap
 * BMI270:  +-8g accel, +-2000 dps gyro, 10 Hz ODR
 *   acc_ms2  = raw * (8.0f * 9.807f / 32768.0f)
 *   gyro_dps = raw * (2000.0f / 32768.0f)
 */

#ifndef CATTLE_CLASSIFIER_H
#define CATTLE_CLASSIFIER_H

#include <math.h>
#include <string.h>

/* -- Constants ----------------------------------------------- */
#define CC_NUM_CLASSES      4
#define CC_NUM_SEL_FEAT     39
#define CC_WIN_SAMPLES      50
#define CC_SAMPLING_HZ      10
#define CC_TOTAL_FEAT       112
#define CC_VOTE_WINDOW      3

enum CattleBehavior {
    BEH_WALKING = 0,
    BEH_GRAZING = 1,
    BEH_RESTING = 2,
    BEH_MISC    = 3
};

static const char* const BEH_NAMES[4] = {"Walking", "Grazing", "Resting", "Misc"};

static const int CC_SEL[CC_NUM_SEL_FEAT] = {
    4, 13, 14, 15, 16, 18, 19, 22, 27, 30, 32, 36, 40, 41, 44, 46, 50, 54, 55, 58, 59, 60, 68, 69, 70, 71, 72, 73, 74, 75, 78, 82, 83, 85, 86, 87, 88, 96, 97
};

/* Feature map (position -> original index -> signal_feature [type]):
 *   f[ 0] = feat[  4] = ax_p2p               [ACCEL]
 *   f[ 1] = feat[ 13] = ax_avgpsd            [ACCEL]
 *   f[ 2] = feat[ 14] = ay_mean              [ACCEL]
 *   f[ 3] = feat[ 15] = ay_median            [ACCEL]
 *   f[ 4] = feat[ 16] = ay_std               [ACCEL]
 *   f[ 5] = feat[ 18] = ay_p2p               [ACCEL]
 *   f[ 6] = feat[ 19] = ay_sum               [ACCEL]
 *   f[ 7] = feat[ 22] = ay_aav               [ACCEL]
 *   f[ 8] = feat[ 27] = ay_avgpsd            [ACCEL]
 *   f[ 9] = feat[ 30] = az_std               [ACCEL]
 *   f[10] = feat[ 32] = az_p2p               [ACCEL]
 *   f[11] = feat[ 36] = az_aav               [ACCEL]
 *   f[12] = feat[ 40] = az_dompsd            [ACCEL]
 *   f[13] = feat[ 41] = az_avgpsd            [ACCEL]
 *   f[14] = feat[ 44] = amag_std             [ACCEL]
 *   f[15] = feat[ 46] = amag_p2p             [ACCEL]
 *   f[16] = feat[ 50] = amag_aav             [ACCEL]
 *   f[17] = feat[ 54] = amag_dompsd          [ACCEL]
 *   f[18] = feat[ 55] = amag_avgpsd          [ACCEL]
 *   f[19] = feat[ 58] = gx_std               [GYRO]
 *   f[20] = feat[ 59] = gx_zcr               [GYRO]
 *   f[21] = feat[ 60] = gx_p2p               [GYRO]
 *   f[22] = feat[ 68] = gx_dompsd            [GYRO]
 *   f[23] = feat[ 69] = gx_avgpsd            [GYRO]
 *   f[24] = feat[ 70] = gy_mean              [GYRO]
 *   f[25] = feat[ 71] = gy_median            [GYRO]
 *   f[26] = feat[ 72] = gy_std               [GYRO]
 *   f[27] = feat[ 73] = gy_zcr               [GYRO]
 *   f[28] = feat[ 74] = gy_p2p               [GYRO]
 *   f[29] = feat[ 75] = gy_sum               [GYRO]
 *   f[30] = feat[ 78] = gy_aav               [GYRO]
 *   f[31] = feat[ 82] = gy_dompsd            [GYRO]
 *   f[32] = feat[ 83] = gy_avgpsd            [GYRO]
 *   f[33] = feat[ 85] = gz_median            [GYRO]
 *   f[34] = feat[ 86] = gz_std               [GYRO]
 *   f[35] = feat[ 87] = gz_zcr               [GYRO]
 *   f[36] = feat[ 88] = gz_p2p               [GYRO]
 *   f[37] = feat[ 96] = gz_dompsd            [GYRO]
 *   f[38] = feat[ 97] = gz_avgpsd            [GYRO]
 */

/* -- Precomputed DFT tables ----------------------------------- */
/* 25x50 cos + 25x50 sin = 9 KB flash */

static const float CC_COS_TABLE[25][50] = {
    { 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f },
    { 1.000000f, 0.992115f, 0.968583f, 0.929776f, 0.876307f, 0.809017f, 0.728969f, 0.637424f, 0.535827f, 0.425779f, 0.309017f, 0.187381f, 0.062791f, -0.062791f, -0.187381f, -0.309017f, -0.425779f, -0.535827f, -0.637424f, -0.728969f, -0.809017f, -0.876307f, -0.929776f, -0.968583f, -0.992115f, -1.000000f, -0.992115f, -0.968583f, -0.929776f, -0.876307f, -0.809017f, -0.728969f, -0.637424f, -0.535827f, -0.425779f, -0.309017f, -0.187381f, -0.062791f, 0.062791f, 0.187381f, 0.309017f, 0.425779f, 0.535827f, 0.637424f, 0.728969f, 0.809017f, 0.876307f, 0.929776f, 0.968583f, 0.992115f },
    { 1.000000f, 0.968583f, 0.876307f, 0.728969f, 0.535827f, 0.309017f, 0.062791f, -0.187381f, -0.425779f, -0.637424f, -0.809017f, -0.929776f, -0.992115f, -0.992115f, -0.929776f, -0.809017f, -0.637424f, -0.425779f, -0.187381f, 0.062791f, 0.309017f, 0.535827f, 0.728969f, 0.876307f, 0.968583f, 1.000000f, 0.968583f, 0.876307f, 0.728969f, 0.535827f, 0.309017f, 0.062791f, -0.187381f, -0.425779f, -0.637424f, -0.809017f, -0.929776f, -0.992115f, -0.992115f, -0.929776f, -0.809017f, -0.637424f, -0.425779f, -0.187381f, 0.062791f, 0.309017f, 0.535827f, 0.728969f, 0.876307f, 0.968583f },
    { 1.000000f, 0.929776f, 0.728969f, 0.425779f, 0.062791f, -0.309017f, -0.637424f, -0.876307f, -0.992115f, -0.968583f, -0.809017f, -0.535827f, -0.187381f, 0.187381f, 0.535827f, 0.809017f, 0.968583f, 0.992115f, 0.876307f, 0.637424f, 0.309017f, -0.062791f, -0.425779f, -0.728969f, -0.929776f, -1.000000f, -0.929776f, -0.728969f, -0.425779f, -0.062791f, 0.309017f, 0.637424f, 0.876307f, 0.992115f, 0.968583f, 0.809017f, 0.535827f, 0.187381f, -0.187381f, -0.535827f, -0.809017f, -0.968583f, -0.992115f, -0.876307f, -0.637424f, -0.309017f, 0.062791f, 0.425779f, 0.728969f, 0.929776f },
    { 1.000000f, 0.876307f, 0.535827f, 0.062791f, -0.425779f, -0.809017f, -0.992115f, -0.929776f, -0.637424f, -0.187381f, 0.309017f, 0.728969f, 0.968583f, 0.968583f, 0.728969f, 0.309017f, -0.187381f, -0.637424f, -0.929776f, -0.992115f, -0.809017f, -0.425779f, 0.062791f, 0.535827f, 0.876307f, 1.000000f, 0.876307f, 0.535827f, 0.062791f, -0.425779f, -0.809017f, -0.992115f, -0.929776f, -0.637424f, -0.187381f, 0.309017f, 0.728969f, 0.968583f, 0.968583f, 0.728969f, 0.309017f, -0.187381f, -0.637424f, -0.929776f, -0.992115f, -0.809017f, -0.425779f, 0.062791f, 0.535827f, 0.876307f },
    { 1.000000f, 0.809017f, 0.309017f, -0.309017f, -0.809017f, -1.000000f, -0.809017f, -0.309017f, 0.309017f, 0.809017f, 1.000000f, 0.809017f, 0.309017f, -0.309017f, -0.809017f, -1.000000f, -0.809017f, -0.309017f, 0.309017f, 0.809017f, 1.000000f, 0.809017f, 0.309017f, -0.309017f, -0.809017f, -1.000000f, -0.809017f, -0.309017f, 0.309017f, 0.809017f, 1.000000f, 0.809017f, 0.309017f, -0.309017f, -0.809017f, -1.000000f, -0.809017f, -0.309017f, 0.309017f, 0.809017f, 1.000000f, 0.809017f, 0.309017f, -0.309017f, -0.809017f, -1.000000f, -0.809017f, -0.309017f, 0.309017f, 0.809017f },
    { 1.000000f, 0.728969f, 0.062791f, -0.637424f, -0.992115f, -0.809017f, -0.187381f, 0.535827f, 0.968583f, 0.876307f, 0.309017f, -0.425779f, -0.929776f, -0.929776f, -0.425779f, 0.309017f, 0.876307f, 0.968583f, 0.535827f, -0.187381f, -0.809017f, -0.992115f, -0.637424f, 0.062791f, 0.728969f, 1.000000f, 0.728969f, 0.062791f, -0.637424f, -0.992115f, -0.809017f, -0.187381f, 0.535827f, 0.968583f, 0.876307f, 0.309017f, -0.425779f, -0.929776f, -0.929776f, -0.425779f, 0.309017f, 0.876307f, 0.968583f, 0.535827f, -0.187381f, -0.809017f, -0.992115f, -0.637424f, 0.062791f, 0.728969f },
    { 1.000000f, 0.637424f, -0.187381f, -0.876307f, -0.929776f, -0.309017f, 0.535827f, 0.992115f, 0.728969f, -0.062791f, -0.809017f, -0.968583f, -0.425779f, 0.425779f, 0.968583f, 0.809017f, 0.062791f, -0.728969f, -0.992115f, -0.535827f, 0.309017f, 0.929776f, 0.876307f, 0.187381f, -0.637424f, -1.000000f, -0.637424f, 0.187381f, 0.876307f, 0.929776f, 0.309017f, -0.535827f, -0.992115f, -0.728969f, 0.062791f, 0.809017f, 0.968583f, 0.425779f, -0.425779f, -0.968583f, -0.809017f, -0.062791f, 0.728969f, 0.992115f, 0.535827f, -0.309017f, -0.929776f, -0.876307f, -0.187381f, 0.637424f },
    { 1.000000f, 0.535827f, -0.425779f, -0.992115f, -0.637424f, 0.309017f, 0.968583f, 0.728969f, -0.187381f, -0.929776f, -0.809017f, 0.062791f, 0.876307f, 0.876307f, 0.062791f, -0.809017f, -0.929776f, -0.187381f, 0.728969f, 0.968583f, 0.309017f, -0.637424f, -0.992115f, -0.425779f, 0.535827f, 1.000000f, 0.535827f, -0.425779f, -0.992115f, -0.637424f, 0.309017f, 0.968583f, 0.728969f, -0.187381f, -0.929776f, -0.809017f, 0.062791f, 0.876307f, 0.876307f, 0.062791f, -0.809017f, -0.929776f, -0.187381f, 0.728969f, 0.968583f, 0.309017f, -0.637424f, -0.992115f, -0.425779f, 0.535827f },
    { 1.000000f, 0.425779f, -0.637424f, -0.968583f, -0.187381f, 0.809017f, 0.876307f, -0.062791f, -0.929776f, -0.728969f, 0.309017f, 0.992115f, 0.535827f, -0.535827f, -0.992115f, -0.309017f, 0.728969f, 0.929776f, 0.062791f, -0.876307f, -0.809017f, 0.187381f, 0.968583f, 0.637424f, -0.425779f, -1.000000f, -0.425779f, 0.637424f, 0.968583f, 0.187381f, -0.809017f, -0.876307f, 0.062791f, 0.929776f, 0.728969f, -0.309017f, -0.992115f, -0.535827f, 0.535827f, 0.992115f, 0.309017f, -0.728969f, -0.929776f, -0.062791f, 0.876307f, 0.809017f, -0.187381f, -0.968583f, -0.637424f, 0.425779f },
    { 1.000000f, 0.309017f, -0.809017f, -0.809017f, 0.309017f, 1.000000f, 0.309017f, -0.809017f, -0.809017f, 0.309017f, 1.000000f, 0.309017f, -0.809017f, -0.809017f, 0.309017f, 1.000000f, 0.309017f, -0.809017f, -0.809017f, 0.309017f, 1.000000f, 0.309017f, -0.809017f, -0.809017f, 0.309017f, 1.000000f, 0.309017f, -0.809017f, -0.809017f, 0.309017f, 1.000000f, 0.309017f, -0.809017f, -0.809017f, 0.309017f, 1.000000f, 0.309017f, -0.809017f, -0.809017f, 0.309017f, 1.000000f, 0.309017f, -0.809017f, -0.809017f, 0.309017f, 1.000000f, 0.309017f, -0.809017f, -0.809017f, 0.309017f },
    { 1.000000f, 0.187381f, -0.929776f, -0.535827f, 0.728969f, 0.809017f, -0.425779f, -0.968583f, 0.062791f, 0.992115f, 0.309017f, -0.876307f, -0.637424f, 0.637424f, 0.876307f, -0.309017f, -0.992115f, -0.062791f, 0.968583f, 0.425779f, -0.809017f, -0.728969f, 0.535827f, 0.929776f, -0.187381f, -1.000000f, -0.187381f, 0.929776f, 0.535827f, -0.728969f, -0.809017f, 0.425779f, 0.968583f, -0.062791f, -0.992115f, -0.309017f, 0.876307f, 0.637424f, -0.637424f, -0.876307f, 0.309017f, 0.992115f, 0.062791f, -0.968583f, -0.425779f, 0.809017f, 0.728969f, -0.535827f, -0.929776f, 0.187381f },
    { 1.000000f, 0.062791f, -0.992115f, -0.187381f, 0.968583f, 0.309017f, -0.929776f, -0.425779f, 0.876307f, 0.535827f, -0.809017f, -0.637424f, 0.728969f, 0.728969f, -0.637424f, -0.809017f, 0.535827f, 0.876307f, -0.425779f, -0.929776f, 0.309017f, 0.968583f, -0.187381f, -0.992115f, 0.062791f, 1.000000f, 0.062791f, -0.992115f, -0.187381f, 0.968583f, 0.309017f, -0.929776f, -0.425779f, 0.876307f, 0.535827f, -0.809017f, -0.637424f, 0.728969f, 0.728969f, -0.637424f, -0.809017f, 0.535827f, 0.876307f, -0.425779f, -0.929776f, 0.309017f, 0.968583f, -0.187381f, -0.992115f, 0.062791f },
    { 1.000000f, -0.062791f, -0.992115f, 0.187381f, 0.968583f, -0.309017f, -0.929776f, 0.425779f, 0.876307f, -0.535827f, -0.809017f, 0.637424f, 0.728969f, -0.728969f, -0.637424f, 0.809017f, 0.535827f, -0.876307f, -0.425779f, 0.929776f, 0.309017f, -0.968583f, -0.187381f, 0.992115f, 0.062791f, -1.000000f, 0.062791f, 0.992115f, -0.187381f, -0.968583f, 0.309017f, 0.929776f, -0.425779f, -0.876307f, 0.535827f, 0.809017f, -0.637424f, -0.728969f, 0.728969f, 0.637424f, -0.809017f, -0.535827f, 0.876307f, 0.425779f, -0.929776f, -0.309017f, 0.968583f, 0.187381f, -0.992115f, -0.062791f },
    { 1.000000f, -0.187381f, -0.929776f, 0.535827f, 0.728969f, -0.809017f, -0.425779f, 0.968583f, 0.062791f, -0.992115f, 0.309017f, 0.876307f, -0.637424f, -0.637424f, 0.876307f, 0.309017f, -0.992115f, 0.062791f, 0.968583f, -0.425779f, -0.809017f, 0.728969f, 0.535827f, -0.929776f, -0.187381f, 1.000000f, -0.187381f, -0.929776f, 0.535827f, 0.728969f, -0.809017f, -0.425779f, 0.968583f, 0.062791f, -0.992115f, 0.309017f, 0.876307f, -0.637424f, -0.637424f, 0.876307f, 0.309017f, -0.992115f, 0.062791f, 0.968583f, -0.425779f, -0.809017f, 0.728969f, 0.535827f, -0.929776f, -0.187381f },
    { 1.000000f, -0.309017f, -0.809017f, 0.809017f, 0.309017f, -1.000000f, 0.309017f, 0.809017f, -0.809017f, -0.309017f, 1.000000f, -0.309017f, -0.809017f, 0.809017f, 0.309017f, -1.000000f, 0.309017f, 0.809017f, -0.809017f, -0.309017f, 1.000000f, -0.309017f, -0.809017f, 0.809017f, 0.309017f, -1.000000f, 0.309017f, 0.809017f, -0.809017f, -0.309017f, 1.000000f, -0.309017f, -0.809017f, 0.809017f, 0.309017f, -1.000000f, 0.309017f, 0.809017f, -0.809017f, -0.309017f, 1.000000f, -0.309017f, -0.809017f, 0.809017f, 0.309017f, -1.000000f, 0.309017f, 0.809017f, -0.809017f, -0.309017f },
    { 1.000000f, -0.425779f, -0.637424f, 0.968583f, -0.187381f, -0.809017f, 0.876307f, 0.062791f, -0.929776f, 0.728969f, 0.309017f, -0.992115f, 0.535827f, 0.535827f, -0.992115f, 0.309017f, 0.728969f, -0.929776f, 0.062791f, 0.876307f, -0.809017f, -0.187381f, 0.968583f, -0.637424f, -0.425779f, 1.000000f, -0.425779f, -0.637424f, 0.968583f, -0.187381f, -0.809017f, 0.876307f, 0.062791f, -0.929776f, 0.728969f, 0.309017f, -0.992115f, 0.535827f, 0.535827f, -0.992115f, 0.309017f, 0.728969f, -0.929776f, 0.062791f, 0.876307f, -0.809017f, -0.187381f, 0.968583f, -0.637424f, -0.425779f },
    { 1.000000f, -0.535827f, -0.425779f, 0.992115f, -0.637424f, -0.309017f, 0.968583f, -0.728969f, -0.187381f, 0.929776f, -0.809017f, -0.062791f, 0.876307f, -0.876307f, 0.062791f, 0.809017f, -0.929776f, 0.187381f, 0.728969f, -0.968583f, 0.309017f, 0.637424f, -0.992115f, 0.425779f, 0.535827f, -1.000000f, 0.535827f, 0.425779f, -0.992115f, 0.637424f, 0.309017f, -0.968583f, 0.728969f, 0.187381f, -0.929776f, 0.809017f, 0.062791f, -0.876307f, 0.876307f, -0.062791f, -0.809017f, 0.929776f, -0.187381f, -0.728969f, 0.968583f, -0.309017f, -0.637424f, 0.992115f, -0.425779f, -0.535827f },
    { 1.000000f, -0.637424f, -0.187381f, 0.876307f, -0.929776f, 0.309017f, 0.535827f, -0.992115f, 0.728969f, 0.062791f, -0.809017f, 0.968583f, -0.425779f, -0.425779f, 0.968583f, -0.809017f, 0.062791f, 0.728969f, -0.992115f, 0.535827f, 0.309017f, -0.929776f, 0.876307f, -0.187381f, -0.637424f, 1.000000f, -0.637424f, -0.187381f, 0.876307f, -0.929776f, 0.309017f, 0.535827f, -0.992115f, 0.728969f, 0.062791f, -0.809017f, 0.968583f, -0.425779f, -0.425779f, 0.968583f, -0.809017f, 0.062791f, 0.728969f, -0.992115f, 0.535827f, 0.309017f, -0.929776f, 0.876307f, -0.187381f, -0.637424f },
    { 1.000000f, -0.728969f, 0.062791f, 0.637424f, -0.992115f, 0.809017f, -0.187381f, -0.535827f, 0.968583f, -0.876307f, 0.309017f, 0.425779f, -0.929776f, 0.929776f, -0.425779f, -0.309017f, 0.876307f, -0.968583f, 0.535827f, 0.187381f, -0.809017f, 0.992115f, -0.637424f, -0.062791f, 0.728969f, -1.000000f, 0.728969f, -0.062791f, -0.637424f, 0.992115f, -0.809017f, 0.187381f, 0.535827f, -0.968583f, 0.876307f, -0.309017f, -0.425779f, 0.929776f, -0.929776f, 0.425779f, 0.309017f, -0.876307f, 0.968583f, -0.535827f, -0.187381f, 0.809017f, -0.992115f, 0.637424f, 0.062791f, -0.728969f },
    { 1.000000f, -0.809017f, 0.309017f, 0.309017f, -0.809017f, 1.000000f, -0.809017f, 0.309017f, 0.309017f, -0.809017f, 1.000000f, -0.809017f, 0.309017f, 0.309017f, -0.809017f, 1.000000f, -0.809017f, 0.309017f, 0.309017f, -0.809017f, 1.000000f, -0.809017f, 0.309017f, 0.309017f, -0.809017f, 1.000000f, -0.809017f, 0.309017f, 0.309017f, -0.809017f, 1.000000f, -0.809017f, 0.309017f, 0.309017f, -0.809017f, 1.000000f, -0.809017f, 0.309017f, 0.309017f, -0.809017f, 1.000000f, -0.809017f, 0.309017f, 0.309017f, -0.809017f, 1.000000f, -0.809017f, 0.309017f, 0.309017f, -0.809017f },
    { 1.000000f, -0.876307f, 0.535827f, -0.062791f, -0.425779f, 0.809017f, -0.992115f, 0.929776f, -0.637424f, 0.187381f, 0.309017f, -0.728969f, 0.968583f, -0.968583f, 0.728969f, -0.309017f, -0.187381f, 0.637424f, -0.929776f, 0.992115f, -0.809017f, 0.425779f, 0.062791f, -0.535827f, 0.876307f, -1.000000f, 0.876307f, -0.535827f, 0.062791f, 0.425779f, -0.809017f, 0.992115f, -0.929776f, 0.637424f, -0.187381f, -0.309017f, 0.728969f, -0.968583f, 0.968583f, -0.728969f, 0.309017f, 0.187381f, -0.637424f, 0.929776f, -0.992115f, 0.809017f, -0.425779f, -0.062791f, 0.535827f, -0.876307f },
    { 1.000000f, -0.929776f, 0.728969f, -0.425779f, 0.062791f, 0.309017f, -0.637424f, 0.876307f, -0.992115f, 0.968583f, -0.809017f, 0.535827f, -0.187381f, -0.187381f, 0.535827f, -0.809017f, 0.968583f, -0.992115f, 0.876307f, -0.637424f, 0.309017f, 0.062791f, -0.425779f, 0.728969f, -0.929776f, 1.000000f, -0.929776f, 0.728969f, -0.425779f, 0.062791f, 0.309017f, -0.637424f, 0.876307f, -0.992115f, 0.968583f, -0.809017f, 0.535827f, -0.187381f, -0.187381f, 0.535827f, -0.809017f, 0.968583f, -0.992115f, 0.876307f, -0.637424f, 0.309017f, 0.062791f, -0.425779f, 0.728969f, -0.929776f },
    { 1.000000f, -0.968583f, 0.876307f, -0.728969f, 0.535827f, -0.309017f, 0.062791f, 0.187381f, -0.425779f, 0.637424f, -0.809017f, 0.929776f, -0.992115f, 0.992115f, -0.929776f, 0.809017f, -0.637424f, 0.425779f, -0.187381f, -0.062791f, 0.309017f, -0.535827f, 0.728969f, -0.876307f, 0.968583f, -1.000000f, 0.968583f, -0.876307f, 0.728969f, -0.535827f, 0.309017f, -0.062791f, -0.187381f, 0.425779f, -0.637424f, 0.809017f, -0.929776f, 0.992115f, -0.992115f, 0.929776f, -0.809017f, 0.637424f, -0.425779f, 0.187381f, 0.062791f, -0.309017f, 0.535827f, -0.728969f, 0.876307f, -0.968583f },
    { 1.000000f, -0.992115f, 0.968583f, -0.929776f, 0.876307f, -0.809017f, 0.728969f, -0.637424f, 0.535827f, -0.425779f, 0.309017f, -0.187381f, 0.062791f, 0.062791f, -0.187381f, 0.309017f, -0.425779f, 0.535827f, -0.637424f, 0.728969f, -0.809017f, 0.876307f, -0.929776f, 0.968583f, -0.992115f, 1.000000f, -0.992115f, 0.968583f, -0.929776f, 0.876307f, -0.809017f, 0.728969f, -0.637424f, 0.535827f, -0.425779f, 0.309017f, -0.187381f, 0.062791f, 0.062791f, -0.187381f, 0.309017f, -0.425779f, 0.535827f, -0.637424f, 0.728969f, -0.809017f, 0.876307f, -0.929776f, 0.968583f, -0.992115f }
};

static const float CC_SIN_TABLE[25][50] = {
    { 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f },
    { 0.000000f, 0.125333f, 0.248690f, 0.368125f, 0.481754f, 0.587785f, 0.684547f, 0.770513f, 0.844328f, 0.904827f, 0.951057f, 0.982287f, 0.998027f, 0.998027f, 0.982287f, 0.951057f, 0.904827f, 0.844328f, 0.770513f, 0.684547f, 0.587785f, 0.481754f, 0.368125f, 0.248690f, 0.125333f, 0.000000f, -0.125333f, -0.248690f, -0.368125f, -0.481754f, -0.587785f, -0.684547f, -0.770513f, -0.844328f, -0.904827f, -0.951057f, -0.982287f, -0.998027f, -0.998027f, -0.982287f, -0.951057f, -0.904827f, -0.844328f, -0.770513f, -0.684547f, -0.587785f, -0.481754f, -0.368125f, -0.248690f, -0.125333f },
    { 0.000000f, 0.248690f, 0.481754f, 0.684547f, 0.844328f, 0.951057f, 0.998027f, 0.982287f, 0.904827f, 0.770513f, 0.587785f, 0.368125f, 0.125333f, -0.125333f, -0.368125f, -0.587785f, -0.770513f, -0.904827f, -0.982287f, -0.998027f, -0.951057f, -0.844328f, -0.684547f, -0.481754f, -0.248690f, -0.000000f, 0.248690f, 0.481754f, 0.684547f, 0.844328f, 0.951057f, 0.998027f, 0.982287f, 0.904827f, 0.770513f, 0.587785f, 0.368125f, 0.125333f, -0.125333f, -0.368125f, -0.587785f, -0.770513f, -0.904827f, -0.982287f, -0.998027f, -0.951057f, -0.844328f, -0.684547f, -0.481754f, -0.248690f },
    { 0.000000f, 0.368125f, 0.684547f, 0.904827f, 0.998027f, 0.951057f, 0.770513f, 0.481754f, 0.125333f, -0.248690f, -0.587785f, -0.844328f, -0.982287f, -0.982287f, -0.844328f, -0.587785f, -0.248690f, 0.125333f, 0.481754f, 0.770513f, 0.951057f, 0.998027f, 0.904827f, 0.684547f, 0.368125f, 0.000000f, -0.368125f, -0.684547f, -0.904827f, -0.998027f, -0.951057f, -0.770513f, -0.481754f, -0.125333f, 0.248690f, 0.587785f, 0.844328f, 0.982287f, 0.982287f, 0.844328f, 0.587785f, 0.248690f, -0.125333f, -0.481754f, -0.770513f, -0.951057f, -0.998027f, -0.904827f, -0.684547f, -0.368125f },
    { 0.000000f, 0.481754f, 0.844328f, 0.998027f, 0.904827f, 0.587785f, 0.125333f, -0.368125f, -0.770513f, -0.982287f, -0.951057f, -0.684547f, -0.248690f, 0.248690f, 0.684547f, 0.951057f, 0.982287f, 0.770513f, 0.368125f, -0.125333f, -0.587785f, -0.904827f, -0.998027f, -0.844328f, -0.481754f, -0.000000f, 0.481754f, 0.844328f, 0.998027f, 0.904827f, 0.587785f, 0.125333f, -0.368125f, -0.770513f, -0.982287f, -0.951057f, -0.684547f, -0.248690f, 0.248690f, 0.684547f, 0.951057f, 0.982287f, 0.770513f, 0.368125f, -0.125333f, -0.587785f, -0.904827f, -0.998027f, -0.844328f, -0.481754f },
    { 0.000000f, 0.587785f, 0.951057f, 0.951057f, 0.587785f, 0.000000f, -0.587785f, -0.951057f, -0.951057f, -0.587785f, -0.000000f, 0.587785f, 0.951057f, 0.951057f, 0.587785f, 0.000000f, -0.587785f, -0.951057f, -0.951057f, -0.587785f, -0.000000f, 0.587785f, 0.951057f, 0.951057f, 0.587785f, 0.000000f, -0.587785f, -0.951057f, -0.951057f, -0.587785f, -0.000000f, 0.587785f, 0.951057f, 0.951057f, 0.587785f, 0.000000f, -0.587785f, -0.951057f, -0.951057f, -0.587785f, -0.000000f, 0.587785f, 0.951057f, 0.951057f, 0.587785f, 0.000000f, -0.587785f, -0.951057f, -0.951057f, -0.587785f },
    { 0.000000f, 0.684547f, 0.998027f, 0.770513f, 0.125333f, -0.587785f, -0.982287f, -0.844328f, -0.248690f, 0.481754f, 0.951057f, 0.904827f, 0.368125f, -0.368125f, -0.904827f, -0.951057f, -0.481754f, 0.248690f, 0.844328f, 0.982287f, 0.587785f, -0.125333f, -0.770513f, -0.998027f, -0.684547f, -0.000000f, 0.684547f, 0.998027f, 0.770513f, 0.125333f, -0.587785f, -0.982287f, -0.844328f, -0.248690f, 0.481754f, 0.951057f, 0.904827f, 0.368125f, -0.368125f, -0.904827f, -0.951057f, -0.481754f, 0.248690f, 0.844328f, 0.982287f, 0.587785f, -0.125333f, -0.770513f, -0.998027f, -0.684547f },
    { 0.000000f, 0.770513f, 0.982287f, 0.481754f, -0.368125f, -0.951057f, -0.844328f, -0.125333f, 0.684547f, 0.998027f, 0.587785f, -0.248690f, -0.904827f, -0.904827f, -0.248690f, 0.587785f, 0.998027f, 0.684547f, -0.125333f, -0.844328f, -0.951057f, -0.368125f, 0.481754f, 0.982287f, 0.770513f, 0.000000f, -0.770513f, -0.982287f, -0.481754f, 0.368125f, 0.951057f, 0.844328f, 0.125333f, -0.684547f, -0.998027f, -0.587785f, 0.248690f, 0.904827f, 0.904827f, 0.248690f, -0.587785f, -0.998027f, -0.684547f, 0.125333f, 0.844328f, 0.951057f, 0.368125f, -0.481754f, -0.982287f, -0.770513f },
    { 0.000000f, 0.844328f, 0.904827f, 0.125333f, -0.770513f, -0.951057f, -0.248690f, 0.684547f, 0.982287f, 0.368125f, -0.587785f, -0.998027f, -0.481754f, 0.481754f, 0.998027f, 0.587785f, -0.368125f, -0.982287f, -0.684547f, 0.248690f, 0.951057f, 0.770513f, -0.125333f, -0.904827f, -0.844328f, -0.000000f, 0.844328f, 0.904827f, 0.125333f, -0.770513f, -0.951057f, -0.248690f, 0.684547f, 0.982287f, 0.368125f, -0.587785f, -0.998027f, -0.481754f, 0.481754f, 0.998027f, 0.587785f, -0.368125f, -0.982287f, -0.684547f, 0.248690f, 0.951057f, 0.770513f, -0.125333f, -0.904827f, -0.844328f },
    { 0.000000f, 0.904827f, 0.770513f, -0.248690f, -0.982287f, -0.587785f, 0.481754f, 0.998027f, 0.368125f, -0.684547f, -0.951057f, -0.125333f, 0.844328f, 0.844328f, -0.125333f, -0.951057f, -0.684547f, 0.368125f, 0.998027f, 0.481754f, -0.587785f, -0.982287f, -0.248690f, 0.770513f, 0.904827f, 0.000000f, -0.904827f, -0.770513f, 0.248690f, 0.982287f, 0.587785f, -0.481754f, -0.998027f, -0.368125f, 0.684547f, 0.951057f, 0.125333f, -0.844328f, -0.844328f, 0.125333f, 0.951057f, 0.684547f, -0.368125f, -0.998027f, -0.481754f, 0.587785f, 0.982287f, 0.248690f, -0.770513f, -0.904827f },
    { 0.000000f, 0.951057f, 0.587785f, -0.587785f, -0.951057f, -0.000000f, 0.951057f, 0.587785f, -0.587785f, -0.951057f, -0.000000f, 0.951057f, 0.587785f, -0.587785f, -0.951057f, -0.000000f, 0.951057f, 0.587785f, -0.587785f, -0.951057f, -0.000000f, 0.951057f, 0.587785f, -0.587785f, -0.951057f, -0.000000f, 0.951057f, 0.587785f, -0.587785f, -0.951057f, -0.000000f, 0.951057f, 0.587785f, -0.587785f, -0.951057f, -0.000000f, 0.951057f, 0.587785f, -0.587785f, -0.951057f, -0.000000f, 0.951057f, 0.587785f, -0.587785f, -0.951057f, -0.000000f, 0.951057f, 0.587785f, -0.587785f, -0.951057f },
    { 0.000000f, 0.982287f, 0.368125f, -0.844328f, -0.684547f, 0.587785f, 0.904827f, -0.248690f, -0.998027f, -0.125333f, 0.951057f, 0.481754f, -0.770513f, -0.770513f, 0.481754f, 0.951057f, -0.125333f, -0.998027f, -0.248690f, 0.904827f, 0.587785f, -0.684547f, -0.844328f, 0.368125f, 0.982287f, -0.000000f, -0.982287f, -0.368125f, 0.844328f, 0.684547f, -0.587785f, -0.904827f, 0.248690f, 0.998027f, 0.125333f, -0.951057f, -0.481754f, 0.770513f, 0.770513f, -0.481754f, -0.951057f, 0.125333f, 0.998027f, 0.248690f, -0.904827f, -0.587785f, 0.684547f, 0.844328f, -0.368125f, -0.982287f },
    { 0.000000f, 0.998027f, 0.125333f, -0.982287f, -0.248690f, 0.951057f, 0.368125f, -0.904827f, -0.481754f, 0.844328f, 0.587785f, -0.770513f, -0.684547f, 0.684547f, 0.770513f, -0.587785f, -0.844328f, 0.481754f, 0.904827f, -0.368125f, -0.951057f, 0.248690f, 0.982287f, -0.125333f, -0.998027f, -0.000000f, 0.998027f, 0.125333f, -0.982287f, -0.248690f, 0.951057f, 0.368125f, -0.904827f, -0.481754f, 0.844328f, 0.587785f, -0.770513f, -0.684547f, 0.684547f, 0.770513f, -0.587785f, -0.844328f, 0.481754f, 0.904827f, -0.368125f, -0.951057f, 0.248690f, 0.982287f, -0.125333f, -0.998027f },
    { 0.000000f, 0.998027f, -0.125333f, -0.982287f, 0.248690f, 0.951057f, -0.368125f, -0.904827f, 0.481754f, 0.844328f, -0.587785f, -0.770513f, 0.684547f, 0.684547f, -0.770513f, -0.587785f, 0.844328f, 0.481754f, -0.904827f, -0.368125f, 0.951057f, 0.248690f, -0.982287f, -0.125333f, 0.998027f, 0.000000f, -0.998027f, 0.125333f, 0.982287f, -0.248690f, -0.951057f, 0.368125f, 0.904827f, -0.481754f, -0.844328f, 0.587785f, 0.770513f, -0.684547f, -0.684547f, 0.770513f, 0.587785f, -0.844328f, -0.481754f, 0.904827f, 0.368125f, -0.951057f, -0.248690f, 0.982287f, 0.125333f, -0.998027f },
    { 0.000000f, 0.982287f, -0.368125f, -0.844328f, 0.684547f, 0.587785f, -0.904827f, -0.248690f, 0.998027f, -0.125333f, -0.951057f, 0.481754f, 0.770513f, -0.770513f, -0.481754f, 0.951057f, 0.125333f, -0.998027f, 0.248690f, 0.904827f, -0.587785f, -0.684547f, 0.844328f, 0.368125f, -0.982287f, -0.000000f, 0.982287f, -0.368125f, -0.844328f, 0.684547f, 0.587785f, -0.904827f, -0.248690f, 0.998027f, -0.125333f, -0.951057f, 0.481754f, 0.770513f, -0.770513f, -0.481754f, 0.951057f, 0.125333f, -0.998027f, 0.248690f, 0.904827f, -0.587785f, -0.684547f, 0.844328f, 0.368125f, -0.982287f },
    { 0.000000f, 0.951057f, -0.587785f, -0.587785f, 0.951057f, 0.000000f, -0.951057f, 0.587785f, 0.587785f, -0.951057f, -0.000000f, 0.951057f, -0.587785f, -0.587785f, 0.951057f, 0.000000f, -0.951057f, 0.587785f, 0.587785f, -0.951057f, -0.000000f, 0.951057f, -0.587785f, -0.587785f, 0.951057f, 0.000000f, -0.951057f, 0.587785f, 0.587785f, -0.951057f, -0.000000f, 0.951057f, -0.587785f, -0.587785f, 0.951057f, -0.000000f, -0.951057f, 0.587785f, 0.587785f, -0.951057f, -0.000000f, 0.951057f, -0.587785f, -0.587785f, 0.951057f, -0.000000f, -0.951057f, 0.587785f, 0.587785f, -0.951057f },
    { 0.000000f, 0.904827f, -0.770513f, -0.248690f, 0.982287f, -0.587785f, -0.481754f, 0.998027f, -0.368125f, -0.684547f, 0.951057f, -0.125333f, -0.844328f, 0.844328f, 0.125333f, -0.951057f, 0.684547f, 0.368125f, -0.998027f, 0.481754f, 0.587785f, -0.982287f, 0.248690f, 0.770513f, -0.904827f, -0.000000f, 0.904827f, -0.770513f, -0.248690f, 0.982287f, -0.587785f, -0.481754f, 0.998027f, -0.368125f, -0.684547f, 0.951057f, -0.125333f, -0.844328f, 0.844328f, 0.125333f, -0.951057f, 0.684547f, 0.368125f, -0.998027f, 0.481754f, 0.587785f, -0.982287f, 0.248690f, 0.770513f, -0.904827f },
    { 0.000000f, 0.844328f, -0.904827f, 0.125333f, 0.770513f, -0.951057f, 0.248690f, 0.684547f, -0.982287f, 0.368125f, 0.587785f, -0.998027f, 0.481754f, 0.481754f, -0.998027f, 0.587785f, 0.368125f, -0.982287f, 0.684547f, 0.248690f, -0.951057f, 0.770513f, 0.125333f, -0.904827f, 0.844328f, 0.000000f, -0.844328f, 0.904827f, -0.125333f, -0.770513f, 0.951057f, -0.248690f, -0.684547f, 0.982287f, -0.368125f, -0.587785f, 0.998027f, -0.481754f, -0.481754f, 0.998027f, -0.587785f, -0.368125f, 0.982287f, -0.684547f, -0.248690f, 0.951057f, -0.770513f, -0.125333f, 0.904827f, -0.844328f },
    { 0.000000f, 0.770513f, -0.982287f, 0.481754f, 0.368125f, -0.951057f, 0.844328f, -0.125333f, -0.684547f, 0.998027f, -0.587785f, -0.248690f, 0.904827f, -0.904827f, 0.248690f, 0.587785f, -0.998027f, 0.684547f, 0.125333f, -0.844328f, 0.951057f, -0.368125f, -0.481754f, 0.982287f, -0.770513f, -0.000000f, 0.770513f, -0.982287f, 0.481754f, 0.368125f, -0.951057f, 0.844328f, -0.125333f, -0.684547f, 0.998027f, -0.587785f, -0.248690f, 0.904827f, -0.904827f, 0.248690f, 0.587785f, -0.998027f, 0.684547f, 0.125333f, -0.844328f, 0.951057f, -0.368125f, -0.481754f, 0.982287f, -0.770513f },
    { 0.000000f, 0.684547f, -0.998027f, 0.770513f, -0.125333f, -0.587785f, 0.982287f, -0.844328f, 0.248690f, 0.481754f, -0.951057f, 0.904827f, -0.368125f, -0.368125f, 0.904827f, -0.951057f, 0.481754f, 0.248690f, -0.844328f, 0.982287f, -0.587785f, -0.125333f, 0.770513f, -0.998027f, 0.684547f, -0.000000f, -0.684547f, 0.998027f, -0.770513f, 0.125333f, 0.587785f, -0.982287f, 0.844328f, -0.248690f, -0.481754f, 0.951057f, -0.904827f, 0.368125f, 0.368125f, -0.904827f, 0.951057f, -0.481754f, -0.248690f, 0.844328f, -0.982287f, 0.587785f, 0.125333f, -0.770513f, 0.998027f, -0.684547f },
    { 0.000000f, 0.587785f, -0.951057f, 0.951057f, -0.587785f, -0.000000f, 0.587785f, -0.951057f, 0.951057f, -0.587785f, -0.000000f, 0.587785f, -0.951057f, 0.951057f, -0.587785f, -0.000000f, 0.587785f, -0.951057f, 0.951057f, -0.587785f, -0.000000f, 0.587785f, -0.951057f, 0.951057f, -0.587785f, -0.000000f, 0.587785f, -0.951057f, 0.951057f, -0.587785f, -0.000000f, 0.587785f, -0.951057f, 0.951057f, -0.587785f, -0.000000f, 0.587785f, -0.951057f, 0.951057f, -0.587785f, -0.000000f, 0.587785f, -0.951057f, 0.951057f, -0.587785f, -0.000000f, 0.587785f, -0.951057f, 0.951057f, -0.587785f },
    { 0.000000f, 0.481754f, -0.844328f, 0.998027f, -0.904827f, 0.587785f, -0.125333f, -0.368125f, 0.770513f, -0.982287f, 0.951057f, -0.684547f, 0.248690f, 0.248690f, -0.684547f, 0.951057f, -0.982287f, 0.770513f, -0.368125f, -0.125333f, 0.587785f, -0.904827f, 0.998027f, -0.844328f, 0.481754f, -0.000000f, -0.481754f, 0.844328f, -0.998027f, 0.904827f, -0.587785f, 0.125333f, 0.368125f, -0.770513f, 0.982287f, -0.951057f, 0.684547f, -0.248690f, -0.248690f, 0.684547f, -0.951057f, 0.982287f, -0.770513f, 0.368125f, 0.125333f, -0.587785f, 0.904827f, -0.998027f, 0.844328f, -0.481754f },
    { 0.000000f, 0.368125f, -0.684547f, 0.904827f, -0.998027f, 0.951057f, -0.770513f, 0.481754f, -0.125333f, -0.248690f, 0.587785f, -0.844328f, 0.982287f, -0.982287f, 0.844328f, -0.587785f, 0.248690f, 0.125333f, -0.481754f, 0.770513f, -0.951057f, 0.998027f, -0.904827f, 0.684547f, -0.368125f, 0.000000f, 0.368125f, -0.684547f, 0.904827f, -0.998027f, 0.951057f, -0.770513f, 0.481754f, -0.125333f, -0.248690f, 0.587785f, -0.844328f, 0.982287f, -0.982287f, 0.844328f, -0.587785f, 0.248690f, 0.125333f, -0.481754f, 0.770513f, -0.951057f, 0.998027f, -0.904827f, 0.684547f, -0.368125f },
    { 0.000000f, 0.248690f, -0.481754f, 0.684547f, -0.844328f, 0.951057f, -0.998027f, 0.982287f, -0.904827f, 0.770513f, -0.587785f, 0.368125f, -0.125333f, -0.125333f, 0.368125f, -0.587785f, 0.770513f, -0.904827f, 0.982287f, -0.998027f, 0.951057f, -0.844328f, 0.684547f, -0.481754f, 0.248690f, 0.000000f, -0.248690f, 0.481754f, -0.684547f, 0.844328f, -0.951057f, 0.998027f, -0.982287f, 0.904827f, -0.770513f, 0.587785f, -0.368125f, 0.125333f, 0.125333f, -0.368125f, 0.587785f, -0.770513f, 0.904827f, -0.982287f, 0.998027f, -0.951057f, 0.844328f, -0.684547f, 0.481754f, -0.248690f },
    { 0.000000f, 0.125333f, -0.248690f, 0.368125f, -0.481754f, 0.587785f, -0.684547f, 0.770513f, -0.844328f, 0.904827f, -0.951057f, 0.982287f, -0.998027f, 0.998027f, -0.982287f, 0.951057f, -0.904827f, 0.844328f, -0.770513f, 0.684547f, -0.587785f, 0.481754f, -0.368125f, 0.248690f, -0.125333f, -0.000000f, 0.125333f, -0.248690f, 0.368125f, -0.481754f, 0.587785f, -0.684547f, 0.770513f, -0.844328f, 0.904827f, -0.951057f, 0.982287f, -0.998027f, 0.998027f, -0.982287f, 0.951057f, -0.904827f, 0.844328f, -0.770513f, 0.684547f, -0.587785f, 0.481754f, -0.368125f, 0.248690f, -0.125333f }
};

/* -- StandardScaler ------------------------------------------- */
/* MUST be applied before any classifier. cc_scale_features() handles this. */

static const float CC_FEAT_MEAN[39] = {
    4.08424711f, 5.03264236f, -0.11202764f, -0.11290148f, 0.96599799f, 4.66076851f,
    -5.60138178f, 1.10727596f, 5.65810537f, 0.76444054f, 3.74663281f, 0.79222894f,
    12.32595921f, 4.66522598f, 0.89774555f, 4.44545507f, 1.03126287f, 14.14763546f,
    5.44848156f, 1.87467337f, 0.28425050f, 7.08739471f, 47.38012314f, 8.56678581f,
    -2.01797795f, -2.01578069f, 1.35130715f, 0.29584229f, 5.24435186f, -100.89889526f,
    0.63473570f, 32.54226685f, 6.46393585f, -10.78923798f, 1.47422147f, 0.31796876f,
    5.94650221f, 34.21327591f, 7.35694933f
};

static const float CC_FEAT_SCALE[39] = {
    3.64205265f, 4.37240839f, 4.01109409f, 3.97512126f, 0.90025818f, 4.60542583f,
    200.55470276f, 1.12862682f, 5.49937344f, 0.77388185f, 4.05418539f, 0.80072194f,
    12.44369125f, 4.81689835f, 0.98903990f, 4.97526264f, 1.15098143f, 15.83275986f,
    6.04854584f, 1.87950850f, 0.17949161f, 6.02668619f, 58.98005676f, 6.92472935f,
    13.43160057f, 13.50428772f, 1.34444737f, 0.16823721f, 4.39258003f, 671.58001709f,
    0.25009352f, 41.28779984f, 5.13129425f, 6.68741131f, 1.32415366f, 0.16719882f,
    4.62628651f, 40.43940353f, 5.26609278f
};

static void cc_scale_features(float f[CC_NUM_SEL_FEAT]) {
    int i;
    for (i = 0; i < CC_NUM_SEL_FEAT; i++)
        f[i] = (f[i] - CC_FEAT_MEAN[i]) / CC_FEAT_SCALE[i];
}

/* -- Feature Extraction --------------------------------------- */
#define CC_HALF_N 25

static void cc_feat14(const float* x, int n, float fs, float* out) {
    float s=0, as=0, ss=0, mn=x[0], mx=x[0];
    int i;
    for (i=0; i<n; i++) {
        s  += x[i];
        as += fabsf(x[i]);
        ss += x[i]*x[i];
        if (x[i] < mn) mn = x[i];
        if (x[i] > mx) mx = x[i];
    }
    float mean = s/n;
    float rms  = sqrtf(ss/n);
    float var  = 0.0f;
    for (i=0; i<n; i++) var += (x[i]-mean)*(x[i]-mean);
    var /= n;
    float std = sqrtf(var + 1e-12f);

    /* median via insertion sort on local copy */
    float buf[CC_WIN_SAMPLES];
    for (i=0; i<n; i++) buf[i] = x[i];
    for (i=1; i<n; i++) {
        float k = buf[i]; int j = i-1;
        while (j >= 0 && buf[j] > k) { buf[j+1] = buf[j]; j--; }
        buf[j+1] = k;
    }
    float med = (n%2) ? buf[n/2] : 0.5f*(buf[n/2-1]+buf[n/2]);

    int zc = 0;
    for (i=1; i<n; i++)
        if ((x[i]-mean)*(x[i-1]-mean) < 0) zc++;
    float zcr = (float)zc / n;

    float aav = 0.0f;
    for (i=1; i<n; i++) aav += fabsf(x[i]-x[i-1]);
    aav /= (n-1);

    float m3=0, m4=0;
    for (i=0; i<n; i++) {
        float d = x[i]-mean;
        m3 += d*d*d; m4 += d*d*d*d;
    }
    m3 /= n; m4 /= n;
    float skw = (std > 1e-10f) ? m3/(std*std*std)     : 0.0f;
    float krt = (std > 1e-10f) ? m4/(var*var) - 3.0f  : 0.0f;

    /* Frequency features: DFT on zero-meaned signal via precomputed tables */
    float df=0, dpsd=0, apsd=0, best=-1.0f;
    int k;
    for (k=1; k<CC_HALF_N; k++) {
        float re=0, im=0;
        for (i=0; i<n; i++) {
            float xc = x[i] - mean;
            re += xc * CC_COS_TABLE[k][i];
            im -= xc * CC_SIN_TABLE[k][i];
        }
        float mag = sqrtf(re*re + im*im);
        apsd += mag;
        if (mag > best) { best=mag; dpsd=mag; df=(float)k*fs/n; }
    }
    apsd /= (CC_HALF_N - 1);

    out[0]=mean; out[1]=med;  out[2]=std;  out[3]=zcr; out[4]=mx-mn;
    out[5]=s;    out[6]=as;   out[7]=rms;  out[8]=aav; out[9]=skw;
    out[10]=krt; out[11]=df; out[12]=dpsd; out[13]=apsd;
}

static void cc_extract_all(
    const float ax[], const float ay[], const float az[],
    const float gx[], const float gy[], const float gz[],
    int n, float fs, float out[CC_TOTAL_FEAT])
{
    float amag[CC_WIN_SAMPLES], gmag[CC_WIN_SAMPLES];
    int i;
    for (i=0; i<n; i++) {
        amag[i] = sqrtf(ax[i]*ax[i] + ay[i]*ay[i] + az[i]*az[i]);
        gmag[i] = sqrtf(gx[i]*gx[i] + gy[i]*gy[i] + gz[i]*gz[i]);
    }
    cc_feat14(ax,   n, fs, out + 0);
    cc_feat14(ay,   n, fs, out + 14);
    cc_feat14(az,   n, fs, out + 28);
    cc_feat14(amag, n, fs, out + 42);
    cc_feat14(gx,   n, fs, out + 56);   /* gyroscope signals start here */
    cc_feat14(gy,   n, fs, out + 70);
    cc_feat14(gz,   n, fs, out + 84);
    cc_feat14(gmag, n, fs, out + 98);
}

static void cc_select_features(
    const float all[CC_TOTAL_FEAT], float sel[CC_NUM_SEL_FEAT])
{
    int i;
    for (i=0; i<CC_NUM_SEL_FEAT; i++) sel[i] = all[CC_SEL[i]];
}

/* -- MLP Classifier (PRIMARY) --------------------------------- */
/* F1=0.9327  Architecture: 39->32->16->4 */
/* Flash (weights only): ~7 KB */

/* MLP weights -- 7504 bytes flash */
#define CC_MLP_L1  32
#define CC_MLP_L2  16

static const float CC_MLP_W1[32][39] = {
    { -0.03428526f, -0.25205356f, -0.22001313f, -0.08872592f, -0.31642541f, -0.15878972f, 0.14009626f, -0.09024223f, 0.20233342f, -0.04236525f, 0.03369267f, 0.29868087f, 0.22808790f, -0.03221008f, 0.05129924f, 0.09099770f, 0.46364501f, 0.20694391f, -0.08023543f, 0.02634923f, -0.22197261f, -0.17138740f, -0.26391026f, -0.03332353f, 0.08390399f, 0.30542162f, -0.19722395f, -0.01508076f, -0.05680587f, 0.25330374f, -0.09834922f, -0.15640563f, 0.29222614f, -0.00350177f, 0.21835454f, 0.23514706f, 0.03874303f, -0.33645850f, -0.26849261f },
    { 0.32016280f, 0.37945330f, -0.15859060f, -0.24147926f, 0.06806447f, 0.10439675f, -0.10603865f, -0.05733151f, 0.16729268f, 0.16007708f, 0.18665791f, -0.11167125f, 0.26193637f, 0.01209772f, -0.13600737f, 0.19760409f, 0.31214830f, 0.02590760f, 0.34670568f, 0.06615943f, -0.21095708f, -0.00583009f, 0.21732502f, 0.15254383f, 0.49986184f, 0.11272123f, -0.24162725f, -0.05906937f, 0.19010605f, 0.17236498f, 0.09459350f, -0.01307418f, -0.04743841f, -0.13261975f, -0.20235687f, 0.21024142f, 0.04037654f, 0.26322740f, 0.04007951f },
    { 0.27506173f, 0.34370816f, -0.69857204f, -0.75555521f, -0.07032925f, 0.02887732f, -0.58340681f, 0.49066779f, 0.02660207f, -0.35752895f, -0.04926806f, -0.28086343f, -0.17531972f, 0.01376379f, 0.21093564f, -0.04008541f, -0.22885334f, -0.22424814f, 0.06771906f, -0.19226317f, -0.05027041f, -0.01760732f, -0.01333145f, 0.04032436f, -0.01565491f, 0.25150943f, 0.03236775f, -0.10305477f, -0.25648686f, 0.00104467f, -0.07829054f, -0.03956584f, 0.23189135f, -0.52325332f, 0.22997856f, 0.11137791f, -0.06101350f, 0.11667661f, 0.00687867f },
    { 0.07758725f, 0.18506919f, 0.56250477f, 0.14548016f, -0.14154686f, 0.02899871f, 0.29919693f, -0.15298136f, -0.25113264f, -0.36309254f, -0.23447324f, -0.03172880f, -0.25614494f, 0.03968712f, -0.03745107f, -0.01607246f, -0.35458243f, 0.02699286f, -0.21403427f, 0.13897993f, -0.21479332f, 0.31624490f, 0.16228843f, -0.12391742f, 0.28587991f, 0.14257187f, -0.01922902f, -0.15182430f, -0.27683014f, 0.27918178f, -0.04724262f, -0.17108417f, 0.20642304f, 0.24419025f, 0.03388865f, -0.05555974f, 0.00206011f, -0.19446814f, -0.26882601f },
    { -0.25877661f, -0.12460936f, -0.18315284f, -0.20813797f, -0.14826337f, -0.16506688f, 0.19553009f, 0.27131534f, 0.12894295f, 0.16587460f, 0.26338056f, -0.34691289f, 0.20721933f, 0.10262286f, -0.16787602f, -0.05294489f, -0.15184070f, -0.08390871f, -0.16654786f, -0.08550412f, -0.12882499f, -0.46163809f, -0.22894809f, -0.27177316f, -0.23730659f, -0.06669965f, 0.21333930f, 0.17703152f, -0.22428752f, 0.26086077f, -0.21653637f, 0.20027822f, -0.14146119f, 0.36136484f, 0.09560405f, 0.22682390f, -0.13388962f, -0.11552820f, 0.27883384f },
    { -0.19709627f, -0.20913863f, 0.47718066f, 0.29562446f, -0.04622114f, 0.23408324f, 0.42499050f, 0.30899689f, 0.34057662f, -0.18224028f, 0.01036660f, -0.03479991f, 0.13970411f, 0.04338139f, 0.08074375f, 0.07807076f, 0.09105859f, 0.00781192f, 0.12181248f, -0.30909881f, 0.25823420f, -0.20910531f, 0.11584451f, -0.29071993f, 0.01039373f, 0.20430377f, -0.11405737f, 0.32926989f, -0.37319875f, 0.08504036f, -0.02743528f, -0.25579247f, 0.15646796f, 0.18317893f, -0.10678575f, 0.02471440f, 0.07218941f, -0.00436222f, -0.33085245f },
    { -0.30536854f, -0.03318071f, 0.15121609f, -0.14261740f, 0.00832718f, -0.24173258f, 0.21797645f, -0.12061965f, -0.37415856f, -0.31073594f, -0.10695489f, 0.35753313f, 0.08131232f, -0.28893307f, -0.11201158f, -0.29133376f, 0.33553025f, 0.16911294f, 0.11145554f, 0.26871228f, 0.03631268f, 0.39392245f, 0.17768057f, 0.22640653f, 0.15734972f, 0.23147234f, 0.03304740f, 0.00559080f, -0.13062142f, -0.20634472f, 0.23503654f, 0.24805450f, -0.25656354f, 0.36502317f, -0.14698192f, -0.27079639f, 0.24146420f, -0.30617589f, 0.04962705f },
    { 0.14122935f, 0.03164580f, -0.10531370f, 0.08407768f, 0.09916250f, -0.04943458f, 0.23253067f, 0.22707817f, 0.22075002f, 0.02999575f, -0.02953004f, 0.08374865f, 0.10329911f, -0.03670034f, -0.05093209f, -0.23755434f, -0.03416326f, 0.16634308f, -0.15733077f, 0.27353781f, 0.08795652f, 0.20129374f, 0.09444527f, 0.07354701f, -0.54316592f, -0.07211250f, 0.13596730f, -0.08427668f, 0.03666033f, -0.47201231f, -0.24951872f, 0.03931937f, 0.06479250f, 0.08414005f, -0.30639690f, 0.04253203f, -0.35351953f, -0.06819506f, 0.09120434f },
    { -0.03628897f, -0.27133057f, -0.09120523f, 0.44657555f, 0.08496013f, -0.17132613f, 0.27880621f, -0.00645462f, 0.30098033f, 0.12928566f, 0.01220281f, -0.13344733f, -0.10474866f, -0.29681498f, -0.32649228f, 0.29855517f, 0.01872676f, -0.01895714f, 0.03136881f, -0.22897382f, 0.26930654f, 0.20810331f, -0.00982269f, -0.09441074f, -0.28297153f, -0.15447669f, -0.32671317f, 0.14708292f, -0.11495648f, -0.40555346f, 0.09363139f, -0.25125617f, -0.19837610f, 0.10756471f, -0.06312640f, -0.00515502f, 0.33605793f, -0.06000448f, 0.08447522f },
    { 0.10712861f, -0.08467282f, -0.06664671f, -0.38654524f, 0.15168248f, 0.09897922f, -0.49179706f, -0.06565684f, 0.11643608f, -0.17877550f, -0.03270239f, 0.00356194f, 0.08174461f, 0.04261938f, -0.07592315f, 0.29600179f, -0.19443560f, -0.07204678f, -0.18896113f, -0.10358752f, 0.01681504f, -0.10261732f, -0.03733529f, 0.25543863f, 0.36951083f, 0.01236655f, 0.05338281f, -0.06142806f, 0.24853465f, 0.48115936f, -0.06016723f, 0.01495664f, -0.28036314f, 0.27317438f, -0.32498497f, -0.09037827f, -0.31808200f, -0.03436929f, -0.06730207f },
    { -0.29945168f, -0.26416638f, 0.09051215f, -0.07026536f, -0.00535148f, 0.16717939f, -0.22645296f, -0.14263883f, 0.15776648f, -0.01511935f, -0.14587711f, -0.11117075f, -0.16633627f, -0.13108307f, -0.34848213f, -0.07542283f, 0.21712278f, 0.11357955f, -0.34035030f, 0.11053501f, -0.17485861f, -0.28118345f, -0.11112899f, -0.18435794f, 0.08060051f, 0.22734454f, -0.23950110f, -0.25354367f, 0.10171195f, -0.26954094f, -0.08637863f, 0.18062545f, -0.31341866f, 0.03993496f, 0.13943763f, 0.19292091f, -0.13021478f, -0.29866177f, -0.09501579f },
    { 0.38076451f, 0.29556572f, 0.26857787f, 0.27399036f, 0.33167058f, -0.17373808f, 0.36712706f, 0.11749408f, 0.17410241f, -0.17188194f, 0.24992374f, 0.17085756f, 0.30921936f, 0.29327285f, -0.15341242f, 0.15559900f, 0.22868776f, 0.02819156f, -0.15405649f, 0.20551053f, 0.01262862f, 0.20467895f, 0.30802739f, 0.06813374f, 0.23337415f, 0.33732566f, 0.20916468f, -0.11905012f, -0.16156431f, 0.19580711f, 0.36580017f, 0.08055525f, 0.03805681f, -0.01200473f, -0.02429496f, -0.03417551f, 0.21411268f, 0.20146002f, -0.00632152f },
    { 0.26677370f, -0.18198113f, 0.14226228f, -0.14765179f, 0.48226413f, 0.15166573f, 0.04644011f, -0.59200090f, -0.17578559f, -0.25530946f, 0.03572832f, -0.25653607f, 0.23008706f, -0.12580776f, -0.54189116f, 0.07635500f, -0.32032564f, -0.68576688f, -0.49201900f, -0.13804206f, 0.08799420f, 0.29998118f, 0.26926038f, 0.15019587f, 0.11479719f, -0.24638703f, -0.07052746f, -0.05098570f, 0.06541613f, -0.12930360f, -0.12804660f, 0.22278471f, 0.09654255f, 0.27099049f, -0.24968770f, -0.23488189f, -0.22500034f, 0.30489486f, 0.25396565f },
    { -0.33347780f, -0.07332357f, -0.07546540f, -0.08509062f, -0.26741728f, -0.24114382f, -0.11316180f, -0.56420493f, -0.29799989f, -0.08252766f, -0.16433041f, -0.28359663f, -0.20237187f, -0.31530091f, -0.08339459f, -0.15309533f, -0.21024302f, -0.53162742f, -0.35093737f, -0.19063567f, 0.17006537f, -0.01677041f, 0.31798810f, -0.08813062f, -0.18853013f, 0.02619515f, 0.04699194f, 0.07565135f, 0.05741317f, -0.18187170f, -0.30278566f, 0.16796851f, 0.21564536f, -0.16529071f, 0.21722209f, 0.03517698f, 0.11470284f, 0.19157159f, -0.08882028f },
    { -0.23688453f, -0.08659158f, -0.49616295f, -0.55383474f, -0.05030257f, -0.01307883f, -0.64556015f, 0.39122614f, 0.16207157f, 0.06592718f, -0.32920909f, 0.22026877f, 0.22067450f, -0.15928288f, 0.29047248f, 0.06197726f, 0.17135723f, 0.21142296f, -0.04351666f, -0.00033554f, -0.30632257f, 0.07492166f, -0.14339580f, -0.10621877f, -0.18267141f, 0.16837393f, -0.21087812f, -0.10962101f, 0.02033134f, 0.04963093f, -0.26374716f, 0.23277275f, -0.27074456f, -0.14539845f, 0.17626144f, -0.04863363f, 0.10750410f, 0.18090956f, 0.11945590f },
    { -0.34969094f, -0.25507769f, -0.14858471f, -0.14236861f, -0.44949499f, -0.46738169f, 0.16977981f, -0.46683761f, -0.10535726f, 0.04901456f, -0.27169678f, 0.25779632f, 0.00332274f, 0.17511818f, 0.07336764f, -0.07117645f, -0.18319370f, 0.07930863f, 0.12581882f, -0.06343672f, -0.04199854f, -0.14914742f, 0.03188907f, 0.28061002f, -0.02102810f, 0.08152869f, 0.24688703f, -0.10503920f, -0.09691267f, 0.26037988f, -0.19459461f, 0.16861002f, -0.11152159f, -0.22813897f, 0.10519475f, -0.08311640f, -0.13382518f, -0.38332641f, -0.23257099f },
    { -0.23412757f, -0.06320783f, 0.46753746f, 0.50529689f, -0.27675322f, -0.03176802f, -0.03127198f, 0.53456825f, 0.16718169f, 0.11989928f, 0.13614853f, -0.04421382f, -0.25595289f, 0.08474305f, 0.37851924f, 0.09036506f, -0.05829828f, 0.25160778f, -0.07343669f, 0.05918843f, -0.22247243f, 0.09210931f, 0.23723070f, 0.10268110f, -0.03102203f, 0.22237326f, 0.04734860f, -0.19264951f, 0.01749248f, -0.01659148f, -0.02525543f, -0.00576566f, -0.00294828f, -0.27841809f, 0.26149032f, 0.07326104f, -0.36394504f, 0.12622066f, -0.19211289f },
    { -0.09229404f, -0.35219204f, 0.15753312f, 0.27341035f, -0.34007001f, -0.10543057f, -0.11129351f, 0.05794668f, 0.12523714f, 0.18785992f, 0.14892353f, -0.39822957f, 0.07003608f, -0.29269484f, -0.19727503f, -0.24049337f, 0.04849525f, -0.36964577f, -0.18796861f, -0.00722703f, -0.08883699f, -0.09767021f, -0.10745814f, 0.00665823f, 0.35231537f, 0.04891819f, -0.00042681f, 0.03813104f, -0.09519321f, -0.16938588f, -0.40106815f, -0.03492372f, 0.10553533f, -0.04417601f, -0.38309935f, 0.05037290f, -0.34729540f, -0.40428099f, -0.51985097f },
    { -0.02516495f, 0.31644040f, 0.04843838f, 0.24645141f, -0.08924153f, 0.07735231f, 0.17506373f, 0.45435545f, -0.10152992f, 0.03933625f, -0.07702003f, -0.17081408f, 0.06066468f, -0.21012765f, -0.04430659f, 0.29772511f, 0.36482379f, -0.10723963f, 0.30618203f, 0.02606581f, -0.24530500f, -0.10205308f, -0.12655857f, -0.23271032f, 0.19378035f, -0.11100179f, -0.14538436f, -0.34693748f, 0.08379006f, -0.06578646f, -0.04124722f, -0.03122419f, 0.00027042f, 0.17654261f, -0.05958965f, -0.23135015f, 0.02559827f, -0.21886615f, 0.04366451f },
    { 0.02189263f, 0.33824685f, -0.17968002f, 0.32573974f, -0.14354993f, -0.37334603f, 0.18560839f, 0.17518803f, -0.09146617f, 0.09322690f, -0.07934794f, -0.46667281f, 0.40904540f, 0.30993882f, 0.28222379f, 0.54393101f, 0.30676907f, -0.30716127f, 0.09388904f, 0.15148431f, -0.01056568f, -0.04460657f, 0.12665096f, 0.17346348f, -0.10497367f, -0.15302621f, 0.03773673f, -0.14187437f, -0.18753132f, 0.18522194f, -0.02602779f, 0.16289066f, -0.01987090f, -0.00349587f, 0.11882369f, 0.11035182f, 0.24004452f, -0.05354818f, -0.17234877f },
    { 0.10258079f, 0.38749787f, -0.22941346f, 0.06479997f, 0.01069265f, 0.03795006f, -0.03118964f, 0.01105357f, 0.37183651f, 0.05265643f, -0.33056870f, -0.22346301f, 0.02101501f, -0.46302789f, -0.28896156f, -0.26572281f, 0.28862917f, -0.01778387f, -0.10415278f, -0.35986519f, -0.18525752f, -0.09278162f, -0.01437522f, -0.03694249f, 0.30854127f, 0.51025707f, -0.25864798f, 0.06853555f, -0.27165529f, 0.54799205f, 0.08270317f, 0.16175194f, 0.15243693f, -0.25271928f, 0.18377951f, -0.10157879f, 0.20309168f, 0.04274704f, 0.28629827f },
    { -0.32958779f, 0.22010092f, -0.56763375f, -0.69231552f, -0.24976538f, -0.44925445f, -0.62629944f, 0.57290977f, -0.02287051f, -0.17045318f, -0.15022451f, -0.04624568f, 0.17796291f, 0.18480603f, 0.40040714f, 0.07107855f, 0.29726389f, -0.00431489f, -0.00863567f, -0.20981734f, 0.10950895f, -0.18257880f, 0.10270061f, 0.02538150f, 0.34673250f, -0.17587574f, 0.28048658f, -0.11132394f, 0.26534119f, 0.14334957f, 0.08229593f, -0.16025889f, 0.08478202f, 0.22862521f, -0.16052137f, -0.03895143f, -0.17017229f, 0.25121409f, -0.00966865f },
    { -0.05223115f, 0.15965244f, 0.44932520f, 0.58023721f, 0.26807946f, 0.20795245f, 0.43919390f, 0.33801386f, 0.16442122f, -0.08228154f, -0.26969776f, -0.13409105f, -0.06647477f, 0.04362759f, -0.39665499f, -0.26897332f, 0.24422522f, -0.09317165f, -0.32000110f, 0.12750044f, -0.02021485f, -0.27772471f, -0.15527177f, 0.19920973f, -0.19374578f, -0.08010808f, -0.09008294f, 0.05969372f, 0.11914064f, 0.06621603f, -0.16275167f, 0.22905152f, -0.12887309f, -0.00590284f, 0.03721416f, 0.03789835f, -0.06687350f, -0.00763530f, 0.08004377f },
    { -0.15467384f, 0.23163445f, 0.05472109f, 0.01044120f, -0.01239112f, 0.34374830f, -0.17797589f, 0.39946079f, 0.28150871f, -0.27753288f, -0.07479922f, -0.09890833f, -0.27956226f, -0.29315481f, 0.19922230f, 0.12255682f, 0.26990905f, -0.11791789f, -0.34860945f, 0.23672803f, -0.18464938f, 0.06590696f, 0.18178415f, 0.19246705f, -0.12770399f, -0.23080048f, -0.25768715f, -0.12643565f, -0.28823128f, -0.08189040f, -0.41313329f, 0.17817810f, -0.37642545f, 0.65603578f, -0.23978180f, 0.04019582f, -0.03662595f, -0.12785560f, -0.25049776f },
    { -0.18783177f, -0.37008101f, 0.14222166f, 0.07820058f, -0.16958699f, -0.11376943f, -0.18438371f, 0.17142911f, 0.23310927f, -0.34814423f, -0.09792864f, 0.09119119f, 0.18105078f, -0.32082507f, -0.32977748f, 0.08305319f, 0.12892593f, 0.15385041f, -0.25801414f, 0.07468955f, -0.07660297f, -0.10358027f, -0.03899281f, -0.27125224f, -0.14815670f, -0.11592831f, -0.16344693f, -0.13052347f, 0.36482629f, -0.34029675f, 0.33078274f, -0.13658692f, 0.35385689f, 0.79864579f, -0.17066643f, -0.11372891f, 0.13911037f, -0.12249158f, 0.17853835f },
    { 0.28077242f, -0.18084022f, -0.06860930f, 0.17443626f, -0.13064148f, 0.02698515f, 0.09084374f, 0.01383025f, -0.21475740f, 0.28666896f, 0.19987908f, -0.33706751f, -0.29074189f, 0.33368561f, 0.20802461f, -0.10117975f, -0.27941898f, -0.15693600f, -0.12609424f, 0.07923070f, -0.09908446f, 0.12190089f, -0.16029108f, -0.02168349f, 0.04603010f, 0.22412807f, -0.31980133f, -0.04310712f, -0.16314244f, 0.22215530f, -0.01984283f, -0.24214530f, -0.52316475f, -0.53938949f, -0.11429339f, 0.24410391f, -0.39584088f, 0.21101646f, 0.01582783f },
    { 0.05275997f, -0.06997469f, -0.28815967f, -0.16687226f, 0.45567235f, 0.37175617f, 0.01994061f, -0.09123589f, 0.09910574f, 0.25553980f, 0.14320460f, 0.34036434f, -0.09464407f, -0.00478732f, 0.14592807f, 0.31356138f, 0.03652921f, 0.18722932f, -0.07623959f, -0.12054154f, -0.20263429f, -0.10580712f, -0.05056223f, -0.08126540f, -0.36525196f, -0.21812256f, 0.02677592f, 0.03973674f, 0.24302375f, -0.13235162f, 0.15612330f, 0.21979626f, 0.20527625f, -0.11701784f, 0.04154235f, 0.10902116f, 0.13858718f, -0.09183086f, 0.17114958f },
    { -0.07119761f, -0.12992664f, 0.02018271f, -0.32831162f, -0.02653117f, 0.13600606f, 0.09922747f, 0.05141477f, -0.13938153f, 0.05760478f, -0.35760117f, -0.26807812f, 0.34847918f, -0.20197397f, 0.13511792f, 0.05137810f, -0.32819879f, 0.05315070f, -0.41756764f, -0.17439197f, -0.07874317f, -0.21838035f, 0.11500143f, -0.09883122f, 0.19237188f, -0.11632656f, -0.20610958f, 0.23684850f, 0.11215095f, -0.09189960f, 0.05024520f, -0.18436942f, -0.01988714f, 0.12872908f, 0.11349016f, 0.00042639f, 0.03614700f, 0.08930006f, 0.18424542f },
    { 0.08837543f, -0.01662458f, 0.04376046f, -0.24501716f, 0.14680541f, 0.02584268f, -0.01621468f, 0.31277639f, 0.07361197f, -0.12995374f, -0.15120006f, -0.31360242f, 0.24884564f, 0.07594699f, -0.41558155f, 0.12684000f, 0.14148520f, -0.22475894f, -0.39146975f, -0.02983986f, -0.16186643f, -0.10398182f, 0.12240165f, -0.38104710f, 0.40619421f, 0.28721747f, 0.15075357f, 0.09686579f, -0.11368078f, 0.16599219f, -0.02093199f, 0.07753241f, 0.29551065f, 0.09628201f, -0.33555546f, 0.16841528f, 0.15065233f, -0.26864851f, 0.01206011f },
    { -0.29517353f, -0.16714743f, -0.08268198f, -0.15217951f, 0.20816502f, -0.09569380f, -0.07859441f, -0.16941647f, -0.19645089f, -0.27473944f, -0.04332552f, 0.20681666f, 0.02728705f, 0.15455522f, -0.06309048f, -0.08845098f, 0.05172450f, 0.09364322f, -0.13400266f, -0.17558901f, -0.11179219f, -0.31440771f, 0.01645991f, 0.03766027f, -0.19583927f, -0.27498597f, 0.04727139f, -0.28663433f, -0.20213808f, -0.49707773f, 0.08238189f, -0.01283664f, 0.14742704f, -0.40204513f, 0.17495298f, 0.12762979f, -0.03300907f, 0.02289831f, 0.09965617f },
    { 0.26135498f, 0.28742853f, 0.08828314f, 0.10000263f, -0.22759828f, -0.16761917f, -0.30544865f, -0.84153736f, -0.12439544f, -0.17898330f, 0.05907770f, 0.37142766f, 0.08456109f, 0.28595427f, 0.15300328f, -0.12193888f, -0.26605803f, 0.17205827f, -0.30358911f, -0.15685911f, -0.15134044f, -0.02527793f, -0.10123951f, 0.13080204f, 0.06461501f, -0.20489721f, -0.05127722f, -0.08668490f, -0.05868223f, -0.24370281f, 0.35984895f, 0.13562119f, 0.27690896f, 0.11470126f, -0.19001979f, -0.01396570f, 0.14789088f, -0.09056675f, -0.12617835f },
    { -0.27357820f, -0.12536998f, 0.02992469f, 0.22710620f, 0.30491653f, 0.37793091f, -0.04336382f, 0.03955667f, 0.14302854f, -0.25643104f, 0.13114262f, 0.16987717f, -0.08938007f, 0.01338435f, -0.02633263f, -0.13634634f, 0.07383030f, 0.30154279f, -0.15663180f, -0.08518256f, 0.07900736f, -0.17777008f, 0.22456163f, 0.18709053f, 0.66183984f, 0.39644393f, -0.07640787f, -0.35547489f, -0.00770378f, 0.55460948f, 0.16201927f, 0.19621772f, -0.10956331f, -0.47111949f, -0.25510612f, 0.11482719f, 0.19233818f, -0.19007073f, -0.30586234f }
};
static const float CC_MLP_B1[32] = { 0.37564796f, 0.21172255f, 0.32887396f, -0.07556552f, -0.27280617f, -0.28570804f, 0.23179859f, -0.01223783f, -0.14040749f, 0.13450797f, -0.28926295f, 0.07928844f, -0.29229233f, 0.07863472f, -0.01256908f, 0.28524995f, -0.30329308f, -0.06364442f, -0.02028443f, -0.06772453f, 0.02100994f, -0.07937106f, 0.28785053f, 0.12355956f, 0.13227242f, 0.02250101f, 0.13080502f, -0.47687840f, -0.31129292f, 0.45263994f, 0.26523376f, 0.03464966f };

static const float CC_MLP_W2[16][32] = {
    { 0.09167481f, -0.25936782f, -0.22595109f, 0.37615746f, 0.13729219f, 0.29185048f, 0.00707868f, -0.15635380f, 0.17305113f, 0.54439598f, 0.37702629f, 0.12842458f, 0.55244482f, -0.01272003f, -0.28489903f, -0.32660761f, -0.24042647f, 0.25562418f, 0.02258682f, 0.34286502f, -0.42858425f, 0.26477820f, 0.10644747f, 0.30956537f, 0.58346683f, -0.05938059f, -0.34023705f, 0.12027445f, 0.27277103f, -0.33618715f, 0.05910830f, 0.32363117f },
    { 0.18632311f, -0.41196689f, 0.38024974f, 0.15138102f, -0.18823555f, -0.29777655f, 0.13779980f, -0.26138544f, 0.25138640f, 0.39624819f, -0.23013228f, 0.01196418f, -0.08671299f, 0.07777157f, -0.21867055f, 0.46765345f, 0.05136964f, 0.30334339f, -0.10789348f, -0.39388648f, -0.50578111f, 0.17316483f, 0.07532126f, 0.09421249f, 0.31108180f, 0.44786882f, -0.31557879f, -0.17832667f, -0.17592531f, -0.04172641f, 0.31494308f, -0.13189076f },
    { 0.28655007f, 0.16462640f, 0.28824121f, 0.04650038f, -0.02770150f, 0.13000810f, 0.08674840f, -0.07648388f, -0.68738300f, -0.16460459f, 0.00767764f, -0.18173629f, -0.30813983f, -0.06802591f, 0.28765106f, 0.12987892f, 0.00270023f, -0.29221800f, 0.27455732f, 0.44867429f, -0.12362534f, 0.61118948f, 0.52673930f, 0.00575111f, -0.45868230f, 0.02252234f, 0.23668122f, -0.50457299f, 0.03068748f, -0.35435736f, -0.51584041f, -0.20540006f },
    { -0.60894740f, 0.22751975f, -0.00353402f, 0.29582188f, 0.10321222f, 0.01428029f, -0.01159406f, 0.16689606f, -0.32009128f, 0.40003616f, 0.04434178f, 0.14416324f, 0.27264905f, 0.18252677f, -0.08420655f, -0.35391325f, 0.03850092f, -0.33985838f, -0.23927584f, -0.01488635f, -0.11029026f, 0.05634359f, -0.32185313f, -0.31704754f, 0.44345939f, 0.34401435f, 0.13815649f, 0.47566435f, 0.07784589f, -0.20343032f, 0.22654165f, 0.18055600f },
    { -0.01319550f, -0.38721809f, 0.39909628f, 0.01682171f, 0.26144394f, 0.18924683f, -0.01583011f, 0.00551200f, -0.25096661f, 0.40931585f, 0.25310290f, 0.00825979f, 0.19320135f, -0.08278839f, 0.15492637f, 0.33115339f, 0.46792161f, 0.17808980f, 0.05519308f, -0.00078621f, -0.60595614f, -0.06779373f, -0.10408869f, -0.40343511f, -0.41545433f, 0.11646600f, 0.37525061f, -0.49463814f, -0.23164132f, 0.15588926f, -0.36320248f, -0.43566045f },
    { 0.26346344f, 0.40670070f, 0.10872126f, 0.41364330f, -0.13301717f, -0.31375182f, -0.14635211f, -0.30777922f, 0.13240059f, 0.42576900f, -0.53994262f, 0.17136481f, 0.32043016f, -0.50211370f, 0.16587481f, -0.14185786f, -0.41665533f, -0.39578000f, 0.09457432f, 0.01675461f, 0.06444988f, -0.52048063f, -0.55108631f, -0.20396076f, 0.12430260f, 0.31827056f, 0.10575217f, 0.06474609f, -0.17661661f, -0.15304375f, 0.03819405f, 0.38553900f },
    { -0.40448442f, -0.48202837f, -0.77423251f, 0.22696756f, 0.40932614f, 0.38039893f, 0.09260131f, 0.47414139f, 0.10773176f, 0.00321164f, 0.22866067f, -0.38453868f, 0.39856547f, 0.05288325f, 0.08187963f, -0.45378357f, -0.04082303f, 0.27724147f, -0.00760850f, 0.17360321f, 0.02609464f, -0.47800273f, 0.51616859f, -0.04997721f, 0.04755205f, 0.19273089f, -0.15071225f, 0.52164167f, 0.20915100f, 0.05379310f, -0.04523475f, 0.34334695f },
    { -0.14642987f, -0.06390905f, -0.75576729f, 0.07778578f, 0.20716469f, 0.42424616f, -0.33362842f, 0.35374114f, 0.36364940f, 0.04163573f, 0.29781863f, 0.10138781f, 0.21025470f, 0.11081135f, -0.00690872f, -0.30714414f, -0.24575567f, 0.31754738f, -0.30605054f, 0.38263947f, 0.44427782f, 0.11158292f, 0.42880985f, 0.45937845f, 0.35598078f, -0.06393851f, -0.00177418f, -0.05117063f, 0.66402709f, -0.20630182f, 0.10894833f, 0.18516135f },
    { -0.20205413f, 0.21449451f, -0.03210817f, 0.06773348f, -0.07710559f, -0.26259753f, 0.25254685f, -0.41288027f, -0.14854854f, 0.11623871f, 0.39818063f, 0.39754644f, 0.25421879f, 0.28158736f, 0.09503338f, 0.35730904f, 0.48478669f, 0.04534493f, -0.19757508f, -0.10127349f, -0.41675258f, -0.22527733f, -0.08618028f, 0.05309837f, 0.45573744f, 0.20941488f, -0.01280597f, -0.36653918f, -0.30032015f, -0.50759006f, 0.07383716f, 0.08599766f },
    { -0.14808033f, 0.25982597f, -0.28045967f, 0.24495263f, -0.27142853f, 0.05541633f, 0.24156794f, -0.05223311f, -0.21633102f, -0.05108539f, -0.00705523f, -0.18615299f, -0.35146973f, -0.46402234f, -0.31072682f, 0.01498543f, -0.27634269f, -0.30598840f, -0.25637296f, -0.67148489f, 0.25161946f, 0.23959261f, 0.44259319f, -0.27935961f, 0.46935338f, -0.03060346f, -0.05565058f, -0.31797150f, -0.20741285f, 0.20521699f, 0.16509092f, 0.52112329f },
    { -0.02921925f, 0.18428683f, 0.27740276f, -0.05697152f, -0.15378740f, 0.46711120f, 0.49380320f, -0.25253224f, -0.13588525f, -0.42578650f, -0.06273555f, 0.35599893f, -0.15887979f, -0.16537823f, -0.06029587f, -0.04794840f, 0.30153242f, 0.12727293f, 0.10602413f, 0.11146576f, 0.43965670f, -0.12105674f, -0.05499026f, 0.00693946f, 0.30175838f, -0.47526243f, 0.16362464f, -0.26530042f, -0.03991665f, 0.32886118f, -0.07560617f, 0.34284151f },
    { -0.28234598f, 0.08712853f, -0.00395526f, -0.63125676f, 0.39473674f, -0.14393662f, -0.24935970f, 0.58904260f, 0.41511551f, -1.01886749f, 0.14499219f, -0.09484178f, -0.19376387f, 0.28494868f, -0.34455016f, 0.06191480f, 0.04639239f, -0.14257495f, 0.12697533f, 0.10740811f, -0.04807357f, -0.66898751f, 0.12540692f, 0.06829719f, 0.00660288f, -0.19986337f, -0.20048918f, -0.14680822f, -0.20888460f, 0.46567392f, 0.19617850f, -0.09163390f },
    { 0.13662513f, 0.00741128f, 0.25414807f, -0.11785328f, 0.49204400f, 0.28414625f, 0.29340941f, 0.42073649f, 0.02021520f, -0.12192294f, 0.42538455f, 0.35613972f, 0.05758581f, 0.08808292f, 0.02455023f, 0.19427831f, -0.39689371f, 0.34218881f, -0.29981738f, -0.31452316f, 0.12070190f, -0.65289462f, -0.30576077f, 0.15526661f, -0.24838735f, 0.08694965f, 0.33488306f, 0.36788395f, 0.25370353f, 0.68486834f, 0.58089685f, -0.16498074f },
    { 0.15559210f, 0.21101393f, -0.03154393f, 0.05019556f, -0.12255698f, 0.19322757f, 0.14306435f, 0.11254381f, -0.03494135f, -0.06139771f, -0.02327991f, 0.19393562f, -0.39206350f, -0.17928211f, 0.47153050f, -0.24887744f, 0.13467586f, -0.06438226f, 0.02409896f, -0.32387668f, 0.13296196f, 0.11125602f, 0.29632783f, 0.15508953f, 0.14488360f, -0.44720256f, 0.10534036f, -0.18849921f, 0.23429774f, 0.05793993f, 0.14754973f, 0.13034505f },
    { 0.33676079f, -0.24993744f, 0.22575797f, 0.29136643f, -0.49036825f, 0.12826550f, 0.14515437f, 0.46047604f, -0.30180588f, -0.52560157f, -0.32814139f, 0.17011280f, -0.12505652f, -0.54236943f, 0.36487141f, 0.00244074f, 0.47228590f, 0.01129841f, 0.28292602f, -0.14811672f, 0.14917299f, 0.67958981f, 0.22895722f, 0.55424130f, -0.08438159f, -0.41843218f, -0.20595568f, -0.02703908f, 0.16853227f, 0.01653881f, 0.09316482f, -0.05892333f },
    { -0.20329781f, 0.30643576f, 0.27090016f, 0.08695489f, 0.34738627f, 0.29543385f, -0.35647416f, 0.31597987f, -0.11318800f, 0.40075967f, 0.44788072f, 0.18851514f, 0.26750728f, -0.07787464f, 0.43476579f, -0.26917556f, 0.20386042f, -0.14534496f, 0.13099973f, 0.52206343f, 0.19708070f, 0.16176727f, 0.49636140f, 0.24487707f, 0.21787433f, -0.29990670f, -0.39810389f, 0.47572988f, -0.06214979f, -0.06043388f, -0.36815640f, 0.23965888f }
};
static const float CC_MLP_B2[16] = { 0.03570320f, 0.19031553f, -0.31015328f, -0.34946960f, 0.30831450f, -0.23724487f, -0.43309844f, -0.41750336f, 0.41551253f, 0.50418794f, -0.05943345f, -0.07981372f, 0.25553966f, 0.31925508f, 0.38269612f, -0.34514678f };

static const float CC_MLP_W3[4][16] = {
    { -0.61870056f, -0.15512457f, -0.63899088f, -0.71122158f, 0.59602547f, 0.53297925f, -0.10303835f, -0.77381420f, -0.22500163f, 1.05190992f, 0.41163254f, 0.55029380f, 0.61810589f, 0.42474553f, 0.70631665f, -0.64917141f },
    { -0.50571859f, -0.72412211f, 0.76093709f, -0.47541058f, 0.08150809f, -0.59589815f, 0.01065354f, -0.22397743f, -0.07443243f, -0.92591321f, 0.19807179f, 0.11020871f, -0.47786912f, 0.19425470f, 0.84316701f, 0.39042714f },
    { 0.29641670f, -0.57920223f, 0.01980069f, 0.19172497f, -1.43002927f, 0.75734025f, 0.63859427f, 0.75900590f, -0.22337550f, -0.69256222f, -0.39868227f, 0.91418749f, 0.37574983f, -0.51054865f, -0.79053605f, 0.43917915f },
    { 0.31335413f, 0.66751939f, -0.46394482f, 0.50649816f, 0.46838775f, 0.23341520f, 0.02089232f, -0.44205597f, 0.29609355f, -0.26672593f, 0.35770562f, -0.78553861f, 0.28620970f, -0.02583492f, -0.89472312f, -0.51650828f }
};
static const float CC_MLP_B3[4] = { 0.21205480f, 0.30774343f, 0.18212387f, 0.04443799f };

static int cc_classify_mlp(const float f[CC_NUM_SEL_FEAT]) {
    float h1[CC_MLP_L1], h2[CC_MLP_L2], out[CC_NUM_CLASSES];
    int i, j;

    /* Layer 1: linear + ReLU */
    for (j=0; j<CC_MLP_L1; j++) {
        h1[j] = CC_MLP_B1[j];
        for (i=0; i<CC_NUM_SEL_FEAT; i++) h1[j] += f[i] * CC_MLP_W1[j][i];
        if (h1[j] < 0.0f) h1[j] = 0.0f;
    }

    /* Layer 2: linear + ReLU */
    for (j=0; j<CC_MLP_L2; j++) {
        h2[j] = CC_MLP_B2[j];
        for (i=0; i<CC_MLP_L1; i++) h2[j] += h1[i] * CC_MLP_W2[j][i];
        if (h2[j] < 0.0f) h2[j] = 0.0f;
    }

    /* Output layer: linear + argmax (no softmax needed for argmax) */
    int best = 0;
    for (j=0; j<CC_NUM_CLASSES; j++) {
        out[j] = CC_MLP_B3[j];
        for (i=0; i<CC_MLP_L2; i++) out[j] += h2[i] * CC_MLP_W3[j][i];
        if (out[j] > out[best]) best = j;
    }
    return best;
}

#ifndef CC_NO_DT
/* -- Decision Tree Fallback ----------------------------------- */
/* F1=0.9110  depth=12, 221 leaves */
/* Estimated compiled size: ~32 KB */
/* Define CC_NO_DT to exclude and save flash. */

static int cc_classify_dt(const float f[CC_NUM_SEL_FEAT]) {
    if (f[4] <= -0.366135f) { /* ay_std */
        if (f[26] <= -0.593056f) { /* ay_dompsd */
            if (f[33] <= -0.807538f) { /* az_sum */
                if (f[29] <= -0.240328f) { /* az_median */
                    if (f[2] <= 0.001068f) { /* ax_std */
                        if (f[29] <= -0.324758f) { /* az_median */
                            return 0; /* Walking */
                        } else {
                            return 0; /* Walking */
                        }
                    } else {
                        if (f[3] <= 0.648188f) { /* ax_zcr */
                            return 2; /* Resting */
                        } else {
                            return 3; /* Misc */
                        }
                    }
                } else {
                    return 3; /* Misc */
                }
            } else {
                if (f[6] <= -0.472621f) { /* ax_abssum */
                    if (f[25] <= -1.102684f) { /* ay_domfreq */
                        if (f[3] <= -1.282242f) { /* ax_zcr */
                            return 3; /* Misc */
                        } else {
                            return 2; /* Resting */
                        }
                    } else {
                        if (f[25] <= -0.885739f) { /* ay_domfreq */
                            if (f[7] <= -0.725586f) { /* ay_aav */
                                return 0; /* Walking */
                            } else {
                                return 0; /* Walking */
                            }
                        } else {
                            if (f[2] <= -0.950942f) { /* ax_std */
                                return 0; /* Walking */
                            } else {
                                if (f[6] <= -0.576317f) { /* ax_abssum */
                                    return 3; /* Misc */
                                } else {
                                    if (f[0] <= -0.723028f) { /* ax_mean */
                                        return 2; /* Resting */
                                    } else {
                                        return 3; /* Misc */
                                    }
                                }
                            }
                        }
                    }
                } else {
                    if (f[7] <= -0.839076f) { /* ax_rms */
                        if (f[4] <= -0.830133f) { /* ay_std */
                            if (f[4] <= -0.845292f) { /* ay_std */
                                if (f[7] <= -0.408791f) { /* ay_aav */
                                    if (f[8] <= 1.986229f) { /* ay_avgpsd */
                                        return 2; /* Resting */
                                    } else {
                                        if (f[8] <= -0.966954f) { /* ax_aav */
                                            return 3; /* Misc */
                                        } else {
                                            return 2; /* Resting */
                                        }
                                    }
                                } else {
                                    if (f[26] <= -0.646095f) { /* ay_dompsd */
                                        return 2; /* Resting */
                                    } else {
                                        return 3; /* Misc */
                                    }
                                }
                            } else {
                                if (f[8] <= -0.950936f) { /* ax_aav */
                                    if (f[24] <= -0.662752f) { /* ay_kurt */
                                        return 2; /* Resting */
                                    } else {
                                        if (f[2] <= 0.712258f) { /* ax_std */
                                            if (f[11] <= -0.923610f) { /* ax_domfreq */
                                                return 2; /* Resting */
                                            } else {
                                                return 3; /* Misc */
                                            }
                                        } else {
                                            return 2; /* Resting */
                                        }
                                    }
                                } else {
                                    return 2; /* Resting */
                                }
                            }
                        } else {
                            if (f[29] <= -1.147476f) { /* az_median */
                                return 2; /* Resting */
                            } else {
                                if (f[24] <= 1.717608f) { /* ay_kurt */
                                    if (f[5] <= -0.730239f) { /* ax_sum */
                                        if (f[33] <= 1.284798f) { /* az_sum */
                                            if (f[11] <= -0.878819f) { /* ax_domfreq */
                                                if (f[7] <= -0.635041f) { /* ay_aav */
                                                    return 2; /* Resting */
                                                } else {
                                                    return 3; /* Misc */
                                                }
                                            } else {
                                                if (f[6] <= 0.708915f) { /* ax_abssum */
                                                    return 3; /* Misc */
                                                } else {
                                                    return 3; /* Misc */
                                                }
                                            }
                                        } else {
                                            return 2; /* Resting */
                                        }
                                    } else {
                                        return 2; /* Resting */
                                    }
                                } else {
                                    return 2; /* Resting */
                                }
                            }
                        }
                    } else {
                        if (f[5] <= -0.510304f) { /* ay_p2p */
                            if (f[0] <= -0.279942f) { /* ax_mean */
                                if (f[35] <= 2.225083f) { /* az_rms */
                                    if (f[34] <= -0.405006f) { /* az_abssum */
                                        if (f[6] <= -0.332918f) { /* ax_abssum */
                                            if (f[24] <= -0.686972f) { /* ay_kurt */
                                                return 2; /* Resting */
                                            } else {
                                                return 3; /* Misc */
                                            }
                                        } else {
                                            if (f[1] <= -0.473213f) { /* ax_avgpsd */
                                                if (f[5] <= -0.853972f) { /* ax_sum */
                                                    return 2; /* Resting */
                                                } else {
                                                    return 2; /* Resting */
                                                }
                                            } else {
                                                if (f[7] <= -0.737769f) { /* ax_rms */
                                                    return 3; /* Misc */
                                                } else {
                                                    return 2; /* Resting */
                                                }
                                            }
                                        }
                                    } else {
                                        if (f[31] <= -0.648790f) { /* az_zcr */
                                            if (f[37] <= -0.346768f) { /* az_skew */
                                                return 3; /* Misc */
                                            } else {
                                                return 2; /* Resting */
                                            }
                                        } else {
                                            return 2; /* Resting */
                                        }
                                    }
                                } else {
                                    return 3; /* Misc */
                                }
                            } else {
                                if (f[6] <= -0.222696f) { /* ay_sum */
                                    return 2; /* Resting */
                                } else {
                                    if (f[34] <= -0.270780f) { /* az_abssum */
                                        return 3; /* Misc */
                                    } else {
                                        return 3; /* Misc */
                                    }
                                }
                            }
                        } else {
                            if (f[7] <= -0.716381f) { /* ax_rms */
                                return 3; /* Misc */
                            } else {
                                if (f[23] <= -0.187215f) { /* ay_skew */
                                    return 2; /* Resting */
                                } else {
                                    return 0; /* Walking */
                                }
                            }
                        }
                    }
                }
            }
        } else {
            if (f[29] <= -0.396283f) { /* az_median */
                if (f[2] <= -0.663801f) { /* ax_std */
                    if (f[29] <= -1.065500f) { /* az_median */
                        if (f[33] <= 1.293925f) { /* az_sum */
                            return 2; /* Resting */
                        } else {
                            if (f[9] <= -0.318902f) { /* ax_skew */
                                return 3; /* Misc */
                            } else {
                                return 3; /* Misc */
                            }
                        }
                    } else {
                        return 3; /* Misc */
                    }
                } else {
                    if (f[33] <= -0.814383f) { /* az_sum */
                        if (f[3] <= 0.041653f) { /* ax_zcr */
                            if (f[12] <= -0.701925f) { /* ax_dompsd */
                                if (f[20] <= 0.087745f) { /* ay_abssum */
                                    return 0; /* Walking */
                                } else {
                                    if (f[8] <= -0.272486f) { /* ay_avgpsd */
                                        return 0; /* Walking */
                                    } else {
                                        return 0; /* Walking */
                                    }
                                }
                            } else {
                                if (f[38] <= -0.304105f) { /* az_kurt */
                                    return 0; /* Walking */
                                } else {
                                    return 3; /* Misc */
                                }
                            }
                        } else {
                            if (f[8] <= -0.460202f) { /* ax_aav */
                                if (f[12] <= -0.889376f) { /* ax_dompsd */
                                    return 3; /* Misc */
                                } else {
                                    return 3; /* Misc */
                                }
                            } else {
                                if (f[6] <= 0.386437f) { /* ax_abssum */
                                    if (f[10] <= -0.478849f) { /* ax_kurt */
                                        return 2; /* Resting */
                                    } else {
                                        return 2; /* Resting */
                                    }
                                } else {
                                    return 0; /* Walking */
                                }
                            }
                        }
                    } else {
                        if (f[21] <= -0.345548f) { /* ay_rms */
                            if (f[2] <= -0.497811f) { /* ax_std */
                                return 0; /* Walking */
                            } else {
                                if (f[0] <= -0.428514f) { /* ax_mean */
                                    if (f[0] <= -0.773205f) { /* ax_p2p */
                                        if (f[5] <= -0.823818f) { /* ax_sum */
                                            return 2; /* Resting */
                                        } else {
                                            if (f[37] <= -0.556637f) { /* az_skew */
                                                return 2; /* Resting */
                                            } else {
                                                return 3; /* Misc */
                                            }
                                        }
                                    } else {
                                        return 2; /* Resting */
                                    }
                                } else {
                                    if (f[9] <= -0.528322f) { /* az_std */
                                        return 3; /* Misc */
                                    } else {
                                        if (f[2] <= -0.471840f) { /* ay_mean */
                                            return 2; /* Resting */
                                        } else {
                                            return 0; /* Walking */
                                        }
                                    }
                                }
                            }
                        } else {
                            if (f[0] <= -0.690110f) { /* ax_p2p */
                                if (f[3] <= -0.829149f) { /* ay_median */
                                    return 2; /* Resting */
                                } else {
                                    if (f[7] <= -0.651267f) { /* ax_rms */
                                        if (f[5] <= -0.606507f) { /* ax_sum */
                                            if (f[29] <= -1.139660f) { /* az_median */
                                                return 2; /* Resting */
                                            } else {
                                                if (f[0] <= -0.086666f) { /* ax_mean */
                                                    return 3; /* Misc */
                                                } else {
                                                    return 2; /* Resting */
                                                }
                                            }
                                        } else {
                                            return 2; /* Resting */
                                        }
                                    } else {
                                        return 2; /* Resting */
                                    }
                                }
                            } else {
                                if (f[2] <= -0.295265f) { /* ax_std */
                                    if (f[28] <= 1.098773f) { /* az_mean */
                                        if (f[29] <= -1.234633f) { /* az_median */
                                            return 2; /* Resting */
                                        } else {
                                            if (f[5] <= -0.283140f) { /* ax_sum */
                                                return 0; /* Walking */
                                            } else {
                                                return 0; /* Walking */
                                            }
                                        }
                                    } else {
                                        return 3; /* Misc */
                                    }
                                } else {
                                    if (f[3] <= 0.539168f) { /* ax_zcr */
                                        if (f[17] <= -0.203771f) { /* ay_zcr */
                                            if (f[33] <= -0.718551f) { /* az_sum */
                                                return 3; /* Misc */
                                            } else {
                                                if (f[37] <= -0.037176f) { /* az_skew */
                                                    return 2; /* Resting */
                                                } else {
                                                    return 2; /* Resting */
                                                }
                                            }
                                        } else {
                                            return 0; /* Walking */
                                        }
                                    } else {
                                        if (f[23] <= 0.390249f) { /* ay_skew */
                                            return 2; /* Resting */
                                        } else {
                                            if (f[3] <= 0.750581f) { /* ax_zcr */
                                                if (f[5] <= -0.454772f) { /* ay_p2p */
                                                    return 3; /* Misc */
                                                } else {
                                                    return 3; /* Misc */
                                                }
                                            } else {
                                                return 1; /* Grazing */
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            } else {
                if (f[12] <= -0.919424f) { /* ax_dompsd */
                    return 2; /* Resting */
                } else {
                    if (f[3] <= 0.779492f) { /* ax_zcr */
                        if (f[33] <= 1.437673f) { /* az_sum */
                            if (f[24] <= 1.017628f) { /* ay_kurt */
                                if (f[2] <= -0.976155f) { /* ax_std */
                                    if (f[33] <= -0.805256f) { /* az_sum */
                                        return 3; /* Misc */
                                    } else {
                                        if (f[38] <= -0.164860f) { /* az_kurt */
                                            return 0; /* Walking */
                                        } else {
                                            return 3; /* Misc */
                                        }
                                    }
                                } else {
                                    if (f[0] <= 0.295941f) { /* ax_mean */
                                        if (f[24] <= -0.293858f) { /* ay_kurt */
                                            if (f[33] <= -0.887398f) { /* az_sum */
                                                if (f[2] <= -0.509432f) { /* ay_mean */
                                                    return 0; /* Walking */
                                                } else {
                                                    return 3; /* Misc */
                                                }
                                            } else {
                                                if (f[3] <= 0.718659f) { /* ax_zcr */
                                                    return 3; /* Misc */
                                                } else {
                                                    return 2; /* Resting */
                                                }
                                            }
                                        } else {
                                            if (f[23] <= -0.824655f) { /* ay_skew */
                                                if (f[7] <= -0.672502f) { /* ay_aav */
                                                    return 3; /* Misc */
                                                } else {
                                                    return 0; /* Walking */
                                                }
                                            } else {
                                                if (f[8] <= 0.411986f) { /* ax_aav */
                                                    return 3; /* Misc */
                                                } else {
                                                    return 3; /* Misc */
                                                }
                                            }
                                        }
                                    } else {
                                        if (f[33] <= -1.304953f) { /* az_sum */
                                            if (f[10] <= -0.536725f) { /* ax_kurt */
                                                return 0; /* Walking */
                                            } else {
                                                return 0; /* Walking */
                                            }
                                        } else {
                                            if (f[12] <= 0.061397f) { /* ax_dompsd */
                                                if (f[10] <= 0.690896f) { /* az_p2p */
                                                    return 2; /* Resting */
                                                } else {
                                                    return 3; /* Misc */
                                                }
                                            } else {
                                                return 2; /* Resting */
                                            }
                                        }
                                    }
                                }
                            } else {
                                if (f[23] <= -0.415170f) { /* ay_skew */
                                    if (f[33] <= -0.109332f) { /* az_sum */
                                        return 3; /* Misc */
                                    } else {
                                        return 2; /* Resting */
                                    }
                                } else {
                                    if (f[1] <= 0.036032f) { /* ax_median */
                                        if (f[10] <= -0.643026f) { /* ax_kurt */
                                            if (f[33] <= 0.303659f) { /* az_sum */
                                                if (f[7] <= -0.234761f) { /* ay_aav */
                                                    return 2; /* Resting */
                                                } else {
                                                    return 3; /* Misc */
                                                }
                                            } else {
                                                return 2; /* Resting */
                                            }
                                        } else {
                                            if (f[3] <= -0.236079f) { /* ay_median */
                                                if (f[24] <= 1.027897f) { /* ay_kurt */
                                                    return 3; /* Misc */
                                                } else {
                                                    return 3; /* Misc */
                                                }
                                            } else {
                                                return 3; /* Misc */
                                            }
                                        }
                                    } else {
                                        if (f[28] <= 1.008455f) { /* az_mean */
                                            if (f[0] <= 0.248608f) { /* ax_mean */
                                                return 3; /* Misc */
                                            } else {
                                                return 2; /* Resting */
                                            }
                                        } else {
                                            return 0; /* Walking */
                                        }
                                    }
                                }
                            }
                        } else {
                            if (f[37] <= -0.640520f) { /* az_skew */
                                return 2; /* Resting */
                            } else {
                                return 2; /* Resting */
                            }
                        }
                    } else {
                        if (f[2] <= -0.358024f) { /* ay_mean */
                            if (f[33] <= 0.125685f) { /* az_sum */
                                if (f[31] <= 2.011830f) { /* az_zcr */
                                    return 1; /* Grazing */
                                } else {
                                    return 3; /* Misc */
                                }
                            } else {
                                if (f[33] <= 1.111388f) { /* az_sum */
                                    return 2; /* Resting */
                                } else {
                                    return 3; /* Misc */
                                }
                            }
                        } else {
                            if (f[11] <= -0.268704f) { /* ax_domfreq */
                                if (f[3] <= 1.405301f) { /* ax_zcr */
                                    if (f[1] <= -0.422931f) { /* ax_avgpsd */
                                        return 0; /* Walking */
                                    } else {
                                        return 0; /* Walking */
                                    }
                                } else {
                                    return 0; /* Walking */
                                }
                            } else {
                                return 1; /* Grazing */
                            }
                        }
                    }
                }
            }
        }
    } else {
        if (f[7] <= 0.468754f) { /* ax_rms */
            if (f[3] <= -1.177438f) { /* ax_zcr */
                if (f[3] <= -1.282242f) { /* ax_zcr */
                    if (f[10] <= 2.143291f) { /* ax_kurt */
                        if (f[11] <= -0.008499f) { /* ax_domfreq */
                            if (f[20] <= -0.747949f) { /* ay_abssum */
                                if (f[29] <= 0.046862f) { /* az_median */
                                    return 1; /* Grazing */
                                } else {
                                    return 1; /* Grazing */
                                }
                            } else {
                                return 0; /* Walking */
                            }
                        } else {
                            return 1; /* Grazing */
                        }
                    } else {
                        return 2; /* Resting */
                    }
                } else {
                    if (f[25] <= 0.076955f) { /* ay_domfreq */
                        if (f[28] <= -0.381050f) { /* az_mean */
                            return 1; /* Grazing */
                        } else {
                            if (f[11] <= 2.771513f) { /* az_aav */
                                return 0; /* Walking */
                            } else {
                                return 1; /* Grazing */
                            }
                        }
                    } else {
                        return 1; /* Grazing */
                    }
                }
            } else {
                if (f[2] <= 1.479845f) { /* ax_std */
                    if (f[26] <= 3.003567f) { /* ay_dompsd */
                        if (f[7] <= -0.545889f) { /* ax_rms */
                            if (f[17] <= -0.134357f) { /* ay_zcr */
                                if (f[26] <= -0.565113f) { /* ay_dompsd */
                                    return 2; /* Resting */
                                } else {
                                    if (f[7] <= -0.775954f) { /* ax_rms */
                                        return 3; /* Misc */
                                    } else {
                                        return 3; /* Misc */
                                    }
                                }
                            } else {
                                if (f[3] <= 0.156127f) { /* ay_median */
                                    if (f[3] <= -0.070024f) { /* ay_median */
                                        return 0; /* Walking */
                                    } else {
                                        return 0; /* Walking */
                                    }
                                } else {
                                    if (f[25] <= -0.095923f) { /* ay_domfreq */
                                        return 2; /* Resting */
                                    } else {
                                        return 3; /* Misc */
                                    }
                                }
                            }
                        } else {
                            if (f[5] <= 1.079016f) { /* ay_p2p */
                                if (f[6] <= 2.895417f) { /* ay_sum */
                                    if (f[33] <= 1.595112f) { /* az_sum */
                                        if (f[12] <= -0.488362f) { /* ax_dompsd */
                                            if (f[29] <= 0.043363f) { /* az_median */
                                                return 2; /* Resting */
                                            } else {
                                                return 3; /* Misc */
                                            }
                                        } else {
                                            if (f[0] <= 1.212134f) { /* ax_p2p */
                                                if (f[3] <= 1.247493f) { /* ax_zcr */
                                                    return 0; /* Walking */
                                                } else {
                                                    return 0; /* Walking */
                                                }
                                            } else {
                                                return 3; /* Misc */
                                            }
                                        }
                                    } else {
                                        if (f[20] <= -0.859374f) { /* ay_abssum */
                                            return 1; /* Grazing */
                                        } else {
                                            return 1; /* Grazing */
                                        }
                                    }
                                } else {
                                    if (f[20] <= -1.305078f) { /* ay_abssum */
                                        if (f[7] <= -0.057443f) { /* ax_rms */
                                            if (f[34] <= 2.479927f) { /* az_abssum */
                                                return 3; /* Misc */
                                            } else {
                                                return 3; /* Misc */
                                            }
                                        } else {
                                            return 1; /* Grazing */
                                        }
                                    } else {
                                        return 0; /* Walking */
                                    }
                                }
                            } else {
                                if (f[3] <= -0.217344f) { /* ax_zcr */
                                    if (f[29] <= 0.601202f) { /* az_median */
                                        return 1; /* Grazing */
                                    } else {
                                        return 1; /* Grazing */
                                    }
                                } else {
                                    if (f[34] <= 1.187148f) { /* az_abssum */
                                        return 0; /* Walking */
                                    } else {
                                        if (f[28] <= 1.793526f) { /* az_mean */
                                            return 3; /* Misc */
                                        } else {
                                            return 3; /* Misc */
                                        }
                                    }
                                }
                            }
                        }
                    } else {
                        if (f[23] <= 1.116503f) { /* ay_skew */
                            if (f[10] <= 3.552658f) { /* az_p2p */
                                if (f[7] <= -0.309504f) { /* ax_rms */
                                    return 3; /* Misc */
                                } else {
                                    if (f[8] <= -1.580163f) { /* ay_avgpsd */
                                        return 1; /* Grazing */
                                    } else {
                                        return 1; /* Grazing */
                                    }
                                }
                            } else {
                                return 0; /* Walking */
                            }
                        } else {
                            if (f[7] <= 0.363722f) { /* ax_rms */
                                if (f[7] <= 4.632270f) { /* ay_aav */
                                    if (f[10] <= 2.871312f) { /* az_p2p */
                                        return 3; /* Misc */
                                    } else {
                                        if (f[12] <= 2.682876f) { /* ax_dompsd */
                                            return 3; /* Misc */
                                        } else {
                                            return 3; /* Misc */
                                        }
                                    }
                                } else {
                                    return 2; /* Resting */
                                }
                            } else {
                                if (f[0] <= 2.049887f) { /* ax_mean */
                                    return 1; /* Grazing */
                                } else {
                                    return 1; /* Grazing */
                                }
                            }
                        }
                    }
                } else {
                    if (f[35] <= 0.550430f) { /* az_rms */
                        return 1; /* Grazing */
                    } else {
                        return 1; /* Grazing */
                    }
                }
            }
        } else {
            if (f[9] <= 3.134907f) { /* az_std */
                if (f[7] <= 0.756400f) { /* ax_rms */
                    if (f[0] <= 0.707392f) { /* ax_p2p */
                        if (f[11] <= 2.107559f) { /* ax_domfreq */
                            if (f[26] <= -0.253321f) { /* ay_dompsd */
                                if (f[23] <= 1.720311f) { /* ay_skew */
                                    if (f[35] <= 0.191576f) { /* az_rms */
                                        return 1; /* Grazing */
                                    } else {
                                        return 1; /* Grazing */
                                    }
                                } else {
                                    return 0; /* Walking */
                                }
                            } else {
                                if (f[34] <= -0.555181f) { /* az_abssum */
                                    if (f[6] <= 0.778768f) { /* ay_sum */
                                        return 1; /* Grazing */
                                    } else {
                                        return 1; /* Grazing */
                                    }
                                } else {
                                    return 1; /* Grazing */
                                }
                            }
                        } else {
                            return 0; /* Walking */
                        }
                    } else {
                        if (f[8] <= 0.712661f) { /* ax_aav */
                            return 0; /* Walking */
                        } else {
                            if (f[3] <= 0.577837f) { /* ay_median */
                                if (f[3] <= 1.525765f) { /* ax_zcr */
                                    if (f[17] <= 0.229199f) { /* ay_zcr */
                                        if (f[35] <= -0.526133f) { /* az_rms */
                                            return 1; /* Grazing */
                                        } else {
                                            return 3; /* Misc */
                                        }
                                    } else {
                                        if (f[37] <= 1.470245f) { /* az_skew */
                                            return 0; /* Walking */
                                        } else {
                                            return 1; /* Grazing */
                                        }
                                    }
                                } else {
                                    return 1; /* Grazing */
                                }
                            } else {
                                if (f[10] <= 1.601146f) { /* ax_kurt */
                                    if (f[20] <= 0.143458f) { /* ay_abssum */
                                        if (f[26] <= 3.060060f) { /* ay_dompsd */
                                            return 1; /* Grazing */
                                        } else {
                                            return 3; /* Misc */
                                        }
                                    } else {
                                        return 0; /* Walking */
                                    }
                                } else {
                                    if (f[9] <= 0.734259f) { /* az_std */
                                        return 1; /* Grazing */
                                    } else {
                                        if (f[5] <= 1.216206f) { /* ax_sum */
                                            return 0; /* Walking */
                                        } else {
                                            return 0; /* Walking */
                                        }
                                    }
                                }
                            }
                        }
                    }
                } else {
                    if (f[26] <= 4.377616f) { /* ay_dompsd */
                        if (f[23] <= -0.426688f) { /* ay_skew */
                            if (f[33] <= -0.668353f) { /* az_sum */
                                if (f[12] <= 1.102942f) { /* ax_dompsd */
                                    return 1; /* Grazing */
                                } else {
                                    return 0; /* Walking */
                                }
                            } else {
                                if (f[5] <= 1.832789f) { /* ax_sum */
                                    if (f[38] <= 2.381580f) { /* az_kurt */
                                        return 1; /* Grazing */
                                    } else {
                                        return 0; /* Walking */
                                    }
                                } else {
                                    if (f[35] <= -0.645751f) { /* az_rms */
                                        return 0; /* Walking */
                                    } else {
                                        return 1; /* Grazing */
                                    }
                                }
                            }
                        } else {
                            if (f[1] <= 3.304382f) { /* ax_median */
                                if (f[20] <= -0.413671f) { /* ay_abssum */
                                    if (f[21] <= 3.482640f) { /* ay_rms */
                                        if (f[28] <= 3.078819f) { /* az_mean */
                                            if (f[12] <= 3.138340f) { /* ax_dompsd */
                                                if (f[5] <= 0.461912f) { /* ay_p2p */
                                                    return 1; /* Grazing */
                                                } else {
                                                    return 1; /* Grazing */
                                                }
                                            } else {
                                                if (f[12] <= 3.281787f) { /* ax_dompsd */
                                                    return 0; /* Walking */
                                                } else {
                                                    return 1; /* Grazing */
                                                }
                                            }
                                        } else {
                                            if (f[2] <= -0.353763f) { /* ax_std */
                                                return 1; /* Grazing */
                                            } else {
                                                return 0; /* Walking */
                                            }
                                        }
                                    } else {
                                        if (f[1] <= 1.286443f) { /* ax_median */
                                            return 1; /* Grazing */
                                        } else {
                                            return 0; /* Walking */
                                        }
                                    }
                                } else {
                                    if (f[3] <= 0.790514f) { /* ay_median */
                                        if (f[11] <= 1.343176f) { /* ax_domfreq */
                                            if (f[8] <= 1.583397f) { /* ax_aav */
                                                return 1; /* Grazing */
                                            } else {
                                                return 1; /* Grazing */
                                            }
                                        } else {
                                            if (f[3] <= 0.589762f) { /* ax_zcr */
                                                if (f[7] <= 1.285542f) { /* ax_rms */
                                                    return 0; /* Walking */
                                                } else {
                                                    return 0; /* Walking */
                                                }
                                            } else {
                                                return 1; /* Grazing */
                                            }
                                        }
                                    } else {
                                        if (f[12] <= 0.402453f) { /* ax_dompsd */
                                            return 2; /* Resting */
                                        } else {
                                            if (f[7] <= 0.997636f) { /* ax_rms */
                                                if (f[11] <= 2.220818f) { /* ax_domfreq */
                                                    return 1; /* Grazing */
                                                } else {
                                                    return 0; /* Walking */
                                                }
                                            } else {
                                                if (f[1] <= 2.799876f) { /* ax_median */
                                                    return 1; /* Grazing */
                                                } else {
                                                    return 1; /* Grazing */
                                                }
                                            }
                                        }
                                    }
                                }
                            } else {
                                if (f[4] <= 2.061051f) { /* ay_std */
                                    return 3; /* Misc */
                                } else {
                                    return 1; /* Grazing */
                                }
                            }
                        }
                    } else {
                        return 0; /* Walking */
                    }
                }
            } else {
                if (f[33] <= -1.389376f) { /* az_sum */
                    if (f[5] <= 0.970557f) { /* ay_p2p */
                        return 3; /* Misc */
                    } else {
                        return 1; /* Grazing */
                    }
                } else {
                    if (f[23] <= 1.126451f) { /* ay_skew */
                        if (f[21] <= 0.925451f) { /* ay_rms */
                            return 0; /* Walking */
                        } else {
                            return 0; /* Walking */
                        }
                    } else {
                        if (f[1] <= 1.908412f) { /* ax_avgpsd */
                            return 0; /* Walking */
                        } else {
                            return 3; /* Misc */
                        }
                    }
                }
            }
        }
    }
}
#else
static int cc_classify_dt(const float f[CC_NUM_SEL_FEAT]) {
    return cc_classify_mlp(f); /* DT excluded, fall through to MLP */
}
#endif /* CC_NO_DT */

/* -- Logistic Regression Fallback ----------------------------- */
/* F1=0.8705  Inference: 1 matrix multiply. */

static const float CC_LR_COEF[4][39] = {
    {0.36186785f, -1.16428137f, 0.78701019f, -2.19942594f, 0.84361982f, -1.23457372f, 0.78700250f, -1.56483293f, 1.60972404f, -1.09966111f, -0.78592330f, 2.08768344f, 0.30907694f, -0.64534676f, 4.32998657f, -4.76020002f, -0.51205230f, 2.06058717f, 3.38383818f, -0.04960225f, -0.05318937f, 0.25805321f, -0.46303108f, 0.19749999f, -0.04950062f, 0.14798532f, 0.14687122f, -0.03123291f, 0.41684571f, -0.04949611f, 0.07776830f, 0.09926916f, -0.72123820f, -0.80997145f, 0.12386090f, -0.12944846f, 0.21102856f, -0.57913905f, 0.42087713f},
    {-0.58851367f, -0.90266460f, -1.34715843f, 2.34841847f, -6.18890953f, -2.25203991f, -1.34715378f, 9.11150837f, 1.92680800f, 0.02312449f, -2.96392250f, -3.72247672f, 0.58931917f, 4.31796503f, 1.26185739f, -1.42035699f, 1.58346903f, 2.22414613f, 5.66791153f, 0.87228239f, -0.55058616f, -0.24199137f, -0.74454266f, 0.23813453f, -0.78497040f, 1.55221021f, 0.85919213f, -0.51592582f, 0.56975502f, -0.78496760f, -0.76371825f, -0.26585740f, -1.01021838f, -0.87246549f, -0.22933540f, -0.90968674f, -0.24416366f, 0.24696365f, 0.03330226f},
    {-1.20473719f, 3.84724212f, -0.11646774f, 2.28691149f, 2.57157326f, 1.82560420f, -0.11645915f, -3.87647557f, 1.79701221f, 1.52184939f, 3.61621714f, 1.05685198f, 0.09758881f, -5.44390774f, -8.68066406f, 7.20154762f, 3.78172183f, -2.18942928f, -14.34884357f, -1.15838134f, 0.23818710f, -0.64537197f, 1.82389390f, -0.37673050f, 0.25011405f, -1.13894010f, 1.48735571f, 0.80516827f, -1.78533542f, 0.25007761f, -0.02570295f, -1.23978412f, 1.00346112f, 1.85238898f, -1.33094370f, 0.65940028f, 1.23249280f, 0.41623029f, -0.13251811f},
    {1.43138301f, -1.78029633f, 0.67661589f, -2.43590379f, 2.77371645f, 1.66100943f, 0.67661047f, -3.67019963f, -5.33354425f, -0.44531271f, 0.13362873f, 0.57794130f, -0.99598491f, 1.77128935f, 3.08881998f, -1.02099097f, -4.85313845f, -2.09530425f, 5.29709387f, 0.33570117f, 0.36558843f, 0.62931013f, -0.61632019f, -0.05890402f, 0.58435696f, -0.56125551f, -2.49341917f, -0.25800952f, 0.79873472f, 0.58438611f, 0.71165293f, 1.40637243f, 0.72799551f, -0.16995203f, 1.43641818f, 0.37973490f, -1.19935763f, -0.08405493f, -0.32166126f}
};
static const float CC_LR_INTERCEPT[4] = {3.27808571f, 1.24966359f, -4.67119169f, 0.14344218f};

static int cc_classify_lr(const float f[CC_NUM_SEL_FEAT]) {
    float sc[CC_NUM_CLASSES]; int i, c;
    for (c = 0; c < CC_NUM_CLASSES; c++) sc[c] = CC_LR_INTERCEPT[c];
    for (i = 0; i < CC_NUM_SEL_FEAT; i++)
        for (c = 0; c < CC_NUM_CLASSES; c++)
            sc[c] += f[i] * CC_LR_COEF[c][i];
    int b = 0;
    for (c = 1; c < CC_NUM_CLASSES; c++) if (sc[c] > sc[b]) b = c;
    return b;
}

/* -- Temporal Majority-Vote Smoother -------------------------- */
/* Smooths over CC_VOTE_WINDOW consecutive predictions.         */
/* Reduces single-window noise, especially at behavior edges.   */

typedef struct {
    int history[CC_VOTE_WINDOW];
    int count;
    int head;
} CattleVoter;

static void cc_voter_init(CattleVoter* v) {
    memset(v->history, 0, sizeof(v->history));
    v->count = 0;
    v->head  = 0;
}

static int cc_voter_add(CattleVoter* v, int cls) {
    int votes[CC_NUM_CLASSES], i, b;
    v->history[v->head] = cls;
    v->head = (v->head + 1) % CC_VOTE_WINDOW;
    if (v->count < CC_VOTE_WINDOW) v->count++;
    memset(votes, 0, sizeof(votes));
    for (i=0; i<v->count; i++) votes[v->history[i]]++;
    b = 0;
    for (i=1; i<CC_NUM_CLASSES; i++) if (votes[i] > votes[b]) b = i;
    return b;
}

/* -- Full Inference Pipeline ---------------------------------- */
/*                                                               */
/* Inputs: 50-sample arrays at 10 Hz (5-second window)          */
/*   ax/ay/az : body-frame acceleration [m/s2]                  */
/*   gx/gy/gz : gyroscope [deg/s]                               */
/*   voter    : persistent voter struct (cc_voter_init at boot)  */
/*   raw_out  : if not NULL, receives unsmoothed class index     */
/*                                                               */
/* Returns: smoothed class index (majority vote, 0-3)           */
/*          use BEH_NAMES[return_value] for string label         */

static int cc_classify(
    const float ax[], const float ay[], const float az[],
    const float gx[], const float gy[], const float gz[],
    CattleVoter* voter, int* raw_out)
{
    float feat_all[CC_TOTAL_FEAT];
    float feat_sel[CC_NUM_SEL_FEAT];

    cc_extract_all(ax, ay, az, gx, gy, gz,
                   CC_WIN_SAMPLES, (float)CC_SAMPLING_HZ, feat_all);
    cc_select_features(feat_all, feat_sel);
    cc_scale_features(feat_sel);

    int raw = cc_classify_mlp(feat_sel);   /* MLP is primary */
    if (raw_out) *raw_out = raw;
    return cc_voter_add(voter, raw);
}

/* -- Self-test vectors (raw/unscaled) ------------------------- */
/* cc_selftest() returns 4 if all 4 class vectors classify correctly.
 * Call at boot to verify the model is intact in flash. */

static const float CC_TEST_WALKING[CC_NUM_SEL_FEAT] = {
    5.008850f, 5.868412f, 1.012687f, 0.905040f, 0.711168f, 2.930600f,
    50.634338f, 0.709100f, 4.167806f, 1.033384f, 4.826880f, 1.291546f,
    20.695827f, 6.107052f, 0.985470f, 4.736506f, 1.238494f, 19.645000f,
    5.826729f, 3.559668f, 0.040000f, 12.634270f, 106.702438f, 11.808736f,
    16.549072f, 16.723635f, 1.046321f, 0.280000f, 4.699700f, 827.453552f,
    0.779755f, 20.592705f, 5.865124f, -13.305665f, 1.385056f, 0.300000f,
    4.821780f, 34.727711f, 6.938282f
};

static const float CC_TEST_GRAZING[CC_NUM_SEL_FEAT] = {
    6.953010f, 9.969549f, -7.137083f, -6.981740f, 2.174790f, 10.544440f,
    -356.854156f, 2.969501f, 13.849990f, 1.496006f, 6.100640f, 1.849758f,
    19.123955f, 9.385121f, 2.215040f, 11.584818f, 2.725964f, 28.783922f,
    14.451583f, 1.496953f, 0.100000f, 6.591800f, 30.351496f, 7.315867f,
    -3.732910f, -3.967290f, 1.376928f, 0.140000f, 6.103520f, -186.645523f,
    0.591667f, 31.613844f, 7.026942f, -13.732910f, 2.321983f, 0.180000f,
    10.131840f, 53.305225f, 12.314572f
};

static const float CC_TEST_RESTING[CC_NUM_SEL_FEAT] = {
    1.254610f, 1.626781f, 0.697216f, 0.761385f, 0.333042f, 1.321650f,
    34.860790f, 0.397939f, 1.592118f, 0.150908f, 0.660820f, 0.172974f,
    2.348816f, 0.837150f, 0.199734f, 0.801475f, 0.238169f, 4.335603f,
    1.084257f, 0.471616f, 0.500000f, 2.136230f, 6.985001f, 2.955857f,
    12.569579f, 12.573240f, 0.485283f, 0.500000f, 2.136230f, 628.479004f,
    0.546825f, 5.923862f, 3.242631f, -5.920410f, 0.607079f, 0.460000f,
    2.624510f, 8.192507f, 3.938923f
};

static const float CC_TEST_MISC[CC_NUM_SEL_FEAT] = {
    1.982470f, 2.379342f, -2.266528f, -2.260210f, 0.728318f, 6.378380f,
    -113.326424f, 0.580688f, 4.488004f, 0.260807f, 1.474880f, 0.217929f,
    3.091655f, 1.724398f, 0.296905f, 2.368867f, 0.282482f, 3.918905f,
    1.785822f, 0.531389f, 0.340000f, 2.441410f, 10.358872f, 3.229032f,
    3.760986f, 3.906250f, 0.637562f, 0.280000f, 2.624510f, 188.049286f,
    0.523157f, 10.130281f, 3.903615f, -18.798830f, 0.550970f, 0.440000f,
    2.563480f, 6.277542f, 3.533466f
};

static const int   CC_TEST_EXPECTED[4] = {0, 1, 2, 3};
static const float* const CC_TEST_VECTORS[4] = {CC_TEST_WALKING, CC_TEST_GRAZING, CC_TEST_RESTING, CC_TEST_MISC};

static int cc_selftest(void) {
    int pass = 0, t;
    for (t = 0; t < CC_NUM_CLASSES; t++) {
        float f[CC_NUM_SEL_FEAT];
        memcpy(f, CC_TEST_VECTORS[t], sizeof(f));
        cc_scale_features(f);
        if (cc_classify_mlp(f) == CC_TEST_EXPECTED[t]) pass++;
    }
    return pass; /* 4 = all pass */
}

#endif /* CATTLE_CLASSIFIER_H */
